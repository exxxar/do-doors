import{_ as L}from"./AuthenticatedLayout-gKnwWaJx.js";import{m as w,o,c as l,b as t,g as m,v as C,f as a,e as d,F as _,r as f,t as r,d as p,q as A,a as b,w as k,u as O,s as y,p as I,h as T,Z as E}from"./app-DTYMgNlX.js";import{P as D}from"./Pagination-Bf_DsY1E.js";import{_ as M}from"./CalcPreview-BPhrKc0f.js";import{D as V}from"./DownloadDocumentForm-ZULBYAss.js";import{_ as B}from"./ClientForm-BoJ5tOug.js";import{E as j}from"./main-aRTHuLq_.js";import"./ApplicationLogo-gT3C7cLy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IndividualDataForm-BkyJwhId.js";import"./vue-the-mask-8R9iGHhM.js";import"./DoorItemEditor-B-A48RsV.js";import"./RalColorSelector-DKoYYQlo.js";import"./HandleDetail-ChF9ly91.js";import"./UserTable-DFAEcMZ6.js";import"./RoleTable-Ba6_nzkk.js";import"./PermissionTable-CjpqJGjk.js";const P={class:"row"},z={class:"col-12"},F={class:"input-group mb-3"},S={class:"form-floating"},U=t("label",{for:"search-orderDetails"},"Поиск по деталям заказа",-1),N=t("i",{class:"fa-solid fa-magnifying-glass"},null,-1),R=[N],q={class:"d-flex scrollable-area"},K={key:0,class:"table"},G={key:0},Z=t("i",{class:"fa-solid fa-caret-down"},null,-1),H=[Z],J={key:1},Q=t("i",{class:"fa-solid fa-caret-up"},null,-1),W=[Q],X={key:0},Y=t("i",{class:"fa-solid fa-caret-down"},null,-1),x=[Y],ee={key:1},te=t("i",{class:"fa-solid fa-caret-up"},null,-1),se=[te],oe={key:0},ne=t("i",{class:"fa-solid fa-caret-down"},null,-1),le=[ne],de={key:1},ie=t("i",{class:"fa-solid fa-caret-up"},null,-1),ae=[ie],re={key:0},ce=t("i",{class:"fa-solid fa-caret-down"},null,-1),ue=[ce],_e={key:1},he=t("i",{class:"fa-solid fa-caret-up"},null,-1),pe=[he],me={key:0},fe=t("i",{class:"fa-solid fa-caret-down"},null,-1),be=[fe],ke={key:1},ve=t("i",{class:"fa-solid fa-caret-up"},null,-1),ge=[ve],$e={key:0},ye=t("i",{class:"fa-solid fa-caret-down"},null,-1),we=[ye],Ce={key:1},Oe=t("i",{class:"fa-solid fa-caret-up"},null,-1),De=[Oe],je={key:0},Le=t("i",{class:"fa-solid fa-caret-down"},null,-1),Ae=[Le],Ie={key:1},Te=t("i",{class:"fa-solid fa-caret-up"},null,-1),Ee=[Te],Me={key:0},Ve=t("i",{class:"fa-solid fa-caret-down"},null,-1),Be=[Ve],Pe={key:1},ze=t("i",{class:"fa-solid fa-caret-up"},null,-1),Fe=[ze],Se=t("th",{scope:"col",class:"text-center"},"Действие",-1),Ue={scope:"row"},Ne=["onClick"],Re={class:"text-center"},qe={class:"text-center"},Ke={class:"text-center"},Ge={class:"text-center"},Ze={class:"text-center"},He={class:"text-center"},Je={class:"text-center"},Qe={class:"dropdown"},We=t("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-bars"})],-1),Xe={class:"dropdown-menu"},Ye=["onClick"],xe=t("i",{class:"fa-solid fa-pen mr-2"},null,-1),et=["onClick"],tt=t("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),st={key:0,class:"alert alert-success",role:"alert"},ot=t("h4",{class:"alert-heading"},"Детали заказа",-1),nt=t("p",null,"К сожалению,в данном заказе нет деталей заказа",-1),lt=[ot,nt],dt={key:1,class:"row mb-3"},it={class:"col-12"},at={props:["orderId"],data(){return{sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...w(["getOrderDetails","getOrderDetailsPaginateObject"])},mounted(){this.loadOrderDetails()},methods:{sortAndLoad(i){this.sort.column=i,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadOrderDetails(this.current_page)},loadOrderDetails(i=0){this.current_page=i,this.$store.dispatch("loadOrderDetails",{dataObject:{order_id:this.orderId,search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(e=>{this.items=this.getOrderDetails,this.paginate_object=this.getOrderDetailsPaginateObject}).catch(()=>{this.loading=!1})},selectItem(i){this.$emit("select",i)},duplicateItem(i){this.$store.dispatch("duplicateOrderDetail",{orderDetailId:i}).then(()=>{this.sortAndLoad("id")})},removeItem(i){this.$store.dispatch("removeOrderDetail",{orderDetailId:i}).then(()=>{this.sortAndLoad("id")})}}},rt=Object.assign(at,{__name:"OrderDetailTable",setup(i){return(e,n)=>(o(),l(_,null,[t("form",P,[t("div",z,[t("div",F,[t("div",S,[m(t("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=s=>e.search=s),class:"form-control",id:"search-orderDetails"},null,512),[[C,e.search]]),U]),t("button",{type:"button",onClick:n[1]||(n[1]=s=>e.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},R)])])]),t("div",q,[e.items.length>0?(o(),l("table",K,[t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"cursor-pointer",onClick:n[2]||(n[2]=s=>e.sortAndLoad("id"))},[a("# "),e.sort.direction==="desc"&&e.sort.column==="id"?(o(),l("span",G,H)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="id"?(o(),l("span",J,W)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[3]||(n[3]=s=>e.sortAndLoad("door_type"))},[a("Тип двери "),e.sort.direction==="desc"&&e.sort.column==="door_type"?(o(),l("span",X,x)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="door_type"?(o(),l("span",ee,se)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[4]||(n[4]=s=>e.sortAndLoad("count"))},[a("Кол-во "),e.sort.direction==="desc"&&e.sort.column==="count"?(o(),l("span",oe,le)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="count"?(o(),l("span",de,ae)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[5]||(n[5]=s=>e.sortAndLoad("price"))},[a("Цена "),e.sort.direction==="desc"&&e.sort.column==="price"?(o(),l("span",re,ue)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="price"?(o(),l("span",_e,pe)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[6]||(n[6]=s=>e.sortAndLoad("comment"))},[a("Комментарий "),e.sort.direction==="desc"&&e.sort.column==="comment"?(o(),l("span",me,be)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="comment"?(o(),l("span",ke,ge)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[7]||(n[7]=s=>e.sortAndLoad("purpose"))},[a("Назначение двери "),e.sort.direction==="desc"&&e.sort.column==="purpose"?(o(),l("span",$e,we)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="purpose"?(o(),l("span",Ce,De)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[8]||(n[8]=s=>e.sortAndLoad("door"))},[a("Параметры двери "),e.sort.direction==="desc"&&e.sort.column==="door"?(o(),l("span",je,Ae)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="door"?(o(),l("span",Ie,Ee)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[9]||(n[9]=s=>e.sortAndLoad("updated_at"))},[a(" Дата изменения "),e.sort.direction==="desc"&&e.sort.column==="updated_at"?(o(),l("span",Me,Be)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="updated_at"?(o(),l("span",Pe,Fe)):d("",!0)]),Se])]),t("tbody",null,[(o(!0),l(_,null,f(e.items,(s,c)=>(o(),l("tr",null,[t("th",Ue,r(s.id||c),1),t("td",{class:"text-center",onClick:h=>e.selectItem(s)},r(s.door_type||"-"),9,Ne),t("td",Re,r(s.count||0),1),t("td",qe,r(s.price||0),1),t("td",Ke,r(s.comment||"-"),1),t("td",Ge,r(s.purpose||"-"),1),t("td",Ze,r(s.door||"-"),1),t("td",He,r(s.updated_at||"-"),1),t("td",Je,[t("div",Qe,[We,t("ul",Xe,[t("li",null,[t("a",{class:"dropdown-item",onClick:h=>e.selectItem(s),href:"javascript:void(0)"},[xe,a("Редактировать")],8,Ye)]),t("li",null,[t("a",{class:"dropdown-item text-danger",onClick:h=>e.removeItem(s.id),href:"javascript:void(0)"},[tt,a("Удалить")],8,et)])])])])]))),256))])])):d("",!0)]),e.items.length===0?(o(),l("div",st,lt)):d("",!0),e.items.length>0?(o(),l("div",dt,[t("div",it,[e.paginate_object?(o(),p(D,{key:0,onPagination_page:e.loadOrderDetails,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0)],64))}}),ct={class:"row"},ut={class:"col-12"},_t={class:"input-group mb-3"},ht={class:"form-floating"},pt=t("label",{for:"search-orders"},"Поиск по заказам",-1),mt={class:"dropdown"},ft=t("button",{class:"btn btn-outline-secondary rounded-0 h-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-up-right-and-down-left-from-center"})],-1),bt={class:"dropdown-menu"},kt=t("i",{class:"fa-solid fa-magnifying-glass"},null,-1),vt=t("i",{class:"fa-regular fa-file-excel"},null,-1),gt={class:"col-12"},$t={class:"action-row"},yt=["onClick"],wt=["onClick"],Ct={class:"col-12 mb-2"},Ot=["onClick"],Dt=t("i",{class:"fa-solid fa-retweet"},null,-1),jt=[Dt],Lt=t("i",{class:"fa-solid fa-xmark"},null,-1),At=[Lt],It={class:"col-12"},Tt={class:"my-3"},Et=["onClick"],Mt=t("i",{class:"fa-solid fa-xmark"},null,-1),Vt=[Mt],Bt={class:"d-flex flex-wrap"},Pt={key:1,class:"my-2 small italic"},zt={class:"d-flex scrollable-area"},Ft={key:0,class:"table"},St={key:0},Ut=t("i",{class:"fa-solid fa-caret-down"},null,-1),Nt=[Ut],Rt={key:1},qt=t("i",{class:"fa-solid fa-caret-up"},null,-1),Kt=[qt],Gt=t("th",{scope:"col",class:"text-center"},"Действие",-1),Zt={key:0},Ht=t("i",{class:"fa-solid fa-caret-down"},null,-1),Jt=[Ht],Qt={key:1},Wt=t("i",{class:"fa-solid fa-caret-up"},null,-1),Xt=[Wt],Yt={key:0},xt=t("i",{class:"fa-solid fa-caret-down"},null,-1),es=[xt],ts={key:1},ss=t("i",{class:"fa-solid fa-caret-up"},null,-1),os=[ss],ns={key:0},ls=t("i",{class:"fa-solid fa-caret-down"},null,-1),ds=[ls],is={key:1},as=t("i",{class:"fa-solid fa-caret-up"},null,-1),rs=[as],cs={key:0},us=t("i",{class:"fa-solid fa-caret-down"},null,-1),_s=[us],hs={key:1},ps=t("i",{class:"fa-solid fa-caret-up"},null,-1),ms=[ps],fs={key:0},bs=t("i",{class:"fa-solid fa-caret-down"},null,-1),ks=[bs],vs={key:1},gs=t("i",{class:"fa-solid fa-caret-up"},null,-1),$s=[gs],ys={key:0},ws=t("i",{class:"fa-solid fa-caret-down"},null,-1),Cs=[ws],Os={key:1},Ds=t("i",{class:"fa-solid fa-caret-up"},null,-1),js=[Ds],Ls={key:0},As=t("i",{class:"fa-solid fa-caret-down"},null,-1),Is=[As],Ts={key:1},Es=t("i",{class:"fa-solid fa-caret-up"},null,-1),Ms=[Es],Vs={key:0},Bs=t("i",{class:"fa-solid fa-caret-down"},null,-1),Ps=[Bs],zs={key:1},Fs=t("i",{class:"fa-solid fa-caret-up"},null,-1),Ss=[Fs],Us={key:0},Ns=t("i",{class:"fa-solid fa-caret-down"},null,-1),Rs=[Ns],qs={key:1},Ks=t("i",{class:"fa-solid fa-caret-up"},null,-1),Gs=[Ks],Zs={key:0},Hs=t("i",{class:"fa-solid fa-caret-down"},null,-1),Js=[Hs],Qs={key:1},Ws=t("i",{class:"fa-solid fa-caret-up"},null,-1),Xs=[Ws],Ys={key:0},xs=t("i",{class:"fa-solid fa-caret-down"},null,-1),eo=[xs],to={key:1},so=t("i",{class:"fa-solid fa-caret-up"},null,-1),oo=[so],no={key:0},lo=t("i",{class:"fa-solid fa-caret-down"},null,-1),io=[lo],ao={key:1},ro=t("i",{class:"fa-solid fa-caret-up"},null,-1),co=[ro],uo={key:0},_o=t("i",{class:"fa-solid fa-caret-down"},null,-1),ho=[_o],po={key:1},mo=t("i",{class:"fa-solid fa-caret-up"},null,-1),fo=[mo],bo={scope:"row"},ko={class:"form-check"},vo=["value","id"],go=["for"],$o={class:"text-center"},yo={class:"dropdown"},wo=t("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-bars"})],-1),Co={class:"dropdown-menu"},Oo=["onClick"],Do=t("i",{class:"fa-solid fa-pen mr-2"},null,-1),jo=t("li",null,[t("hr",{class:"dropdown-divider"})],-1),Lo=["onClick"],Ao=t("i",{class:"fa-solid fa-paper-plane mr-2"},null,-1),Io=["onClick"],To=t("i",{class:"fa-solid fa-square-arrow-up-right mr-2"},null,-1),Eo=["onClick"],Mo=t("i",{class:"fa-solid fa-envelope mr-2"},null,-1),Vo=t("li",null,[t("hr",{class:"dropdown-divider"})],-1),Bo=["href"],Po=t("i",{class:"fa-regular fa-file-excel mr-2"},null,-1),zo=["onClick"],Fo=t("i",{class:"fa-solid fa-file-signature mr-2"},null,-1),So=t("li",null,[t("hr",{class:"dropdown-divider"})],-1),Uo=["onClick"],No=t("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Ro=["onClick"],qo=["onClick"],Ko={key:2,class:"text-center"},Go={key:3,class:"text-center"},Zo=["onClick"],Ho={key:0},Jo={key:4,class:"text-center"},Qo={key:0},Wo={key:1},Xo={key:5,class:"text-center"},Yo={key:6,class:"text-center"},xo={key:7,class:"text-center"},en={key:8,class:"text-center"},tn={key:9,class:"text-center"},sn={key:10,class:"text-center"},on={key:11,class:"text-center"},nn={key:12,class:"text-center"},ln={key:2,class:"alert alert-success rounded-0",role:"alert"},dn=t("h4",{class:"alert-heading"},"Заказы",-1),an=t("p",null,"К сожалению, раздел заказов пуст.",-1),rn=[dn,an],cn={key:3,class:"row mb-3"},un={class:"col-12"},_n={class:"modal fade",id:"client-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},hn={class:"modal-dialog modal-lg"},pn={class:"modal-content rounded-0"},mn={class:"modal-body"},fn={class:"modal fade",id:"order-details",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},bn={class:"modal-dialog modal-fullscreen"},kn={class:"modal-content"},vn=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Детали заказа"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},[t("i",{class:"fa-solid fa-xmark"})])],-1),gn={class:"modal-body"},$n=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary rounded-0","data-bs-dismiss":"modal"},"Закрыть ")],-1),yn={class:"modal fade",id:"confirm-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},wn={class:"modal-dialog modal-dialog-centered"},Cn={class:"modal-content rounded-0"},On={class:"modal-body"},Dn=t("div",{class:"d-flex justify-center p-3"},[t("img",{src:"/images/logo.png",style:{width:"100px"},alt:""})],-1),jn={class:"font-bold text-center py-3"},Ln={class:"text-center pb-3"},An={class:"row mb-3"},In={class:"col-md-6 d-flex justify-center"},Tn={class:"form-check"},En=t("label",{class:"form-check-label",for:"work-with-nds"}," Работаю с НДС ",-1),Mn={class:"col-md-6 d-flex justify-center"},Vn={class:"form-check"},Bn=t("label",{class:"form-check-label",for:"work-without-nds"}," Работаю без НДС ",-1),Pn={class:"row"},zn={class:"col-6"},Fn={class:"col-6"},Sn={class:"modal fade",id:"order-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Un={class:"modal-dialog modal-xl"},Nn={class:"modal-content rounded-0"},Rn={class:"modal-body"},qn={components:{VueDatePicker:j},data(){return{selected_client_item:null,editor_modal:null,selected_orders:[],selected_item:null,organization_forms:{individual:"ИП",legal_entity:"ООО",phys:"ФЛ"},table:{contract_number:{title:"Номер договора",value:!0},contract_date:{title:"Дата договора",value:!0},completion_at:{title:"Дата закрытия",value:!0},client_id:{title:"Идентификатор клиента",value:!0},status:{title:"Статус",value:!0},source:{title:"Источник",value:!0},contact_person:{title:"Контактное лицо",value:!0},phone:{title:"Номер телефона",value:!0},organizational_form:{title:"Организационная форма",value:!0},contract_amount:{title:"Сумма договора",value:!0},paid:{title:"Оплачено",value:!0},debt:{title:"Остаток",value:!0},profit:{title:"Доход",value:!0}},sort:{column:null,date:null,direction:"desc"},selected_order:null,order_detail_modal:null,order_status:["Новый заказ","В работе","Завершен"],search:null,current_page:0,paginate_object:null,loading:!1,confirm_modal:null,confirm:{title:null,message:null,work_with_nds:1,item:null},items:[{id:null,contract_number:null,contract_date:null,completion_at:null,client_id:null,status:null,source:null,contact_person:null,phone:null,organizational_form:null,contract_amount:null,paid:null,debt:null,profit:null}]}},computed:{...w(["getOrders","getOrdersPaginateObject"])},mounted(){this.loadOrders(),this.order_detail_modal=new bootstrap.Modal(document.getElementById("order-details"),{}),this.confirm_modal=new bootstrap.Modal(document.getElementById("confirm-modal"),{}),this.editor_modal=new bootstrap.Modal(document.getElementById("order-editor-modal"),{}),this.client_editor_modal=new bootstrap.Modal(document.getElementById("client-editor-modal"),{})},methods:{selectClient(i){if(i==null){this.selected_client_item=null,this.client_editor_modal.hide();return}this.selected_client_item=null,this.$nextTick(()=>{this.selected_client_item=i,this.client_editor_modal.show()})},getStatusByOrgForm(i){let e=this.organization_forms[i]||!1;return e||"Новый клиент"},selectOrder(i){let e=this.selected_orders.findIndex(n=>n===i);e===-1?this.selected_orders.push(i):this.selected_orders.splice(e,1)},resetColumns(){Object.keys(this.table).forEach(i=>{this.table[i].value=!0})},changeColumns(i){i?this.table[i].value=!this.table[i].value:Object.keys(this.table).forEach(e=>{this.table[e].value=!this.table[e].value})},openConfirmModal(i,e,n){this.confirm.title=i||null,this.confirm.message=e||null,this.confirm.item=n||null,this.confirm_modal.show()},sortAndLoad(i){this.sort.column=i,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadOrders(this.current_page)},downloadSelectedOrders(){let i=this.sort,e=(i.date||[]).length>0?new Date(i.date[0]).getTime():null,n=(i.date||[]).length>1?new Date(i.date[1]).getTime():null,s=`/orders/download-filtered-orders?order=id&ids=${this.selected_orders.join(",")}&type=multiply`;e&&n&&(s+=`&df=${e}&dt=${n}`),this.search&&(s+=`&search=${this.search||null}`),window.open(s,"_blank").focus()},filteredDownload(){let i=this.sort,e=(i.date||[]).length>0?new Date(i.date[0]).getTime():null,n=(i.date||[]).length>1?new Date(i.date[1]).getTime():null,s="/orders/download-filtered-orders?order=id";e&&n&&(s+=`&df=${e}&dt=${n}`),this.search&&(s+=`&search=${this.search||null}`),window.open(s,"_blank").focus()},sendOrder(i,e=!1,n=!1,s=!1){this.$store.dispatch("sendOrderToBitrix",{order_id:i.id,send_to_telegram:n,send_to_email:e,send_to_bitrix:s}).then(()=>{this.$notify({title:"DoDoors",text:"Информация успешно отправлена в Битрикс",type:"success"})}).catch(()=>{this.$notify({title:"DoDoors",text:"Ошибка отправки информации в Битрикс",type:"error"})})},sendToBitrix(i){this.sendOrder(i,!1,!1,!0)},sendToTelegram(i){this.sendOrder(i,!1,!0,!1)},sendToEmail(i){this.sendOrder(i,!0,!1,!1)},downloadDocument(i){window.open(`/orders/download-contract?id=${i.id}`,"_blank").focus()},loadOrders(i=0){this.current_page=i;let e=this.sort,n=(e.date||[]).length>0?e.date[0]:null,s=(e.date||[]).length>1?e.date[1]:null;this.$store.dispatch("loadOrders",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction,df:n||null,dt:s||null},page:this.current_page}).then(c=>{this.items=this.getOrders,this.paginate_object=this.getOrdersPaginateObject}).catch(()=>{this.loading=!1})},selectItemForEdit(i){if(i==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=i,this.editor_modal.show()})},selectItem(i){this.loading=!0,this.selected_order=i,this.$nextTick(()=>{this.loading=!1,this.order_detail_modal.show()})},duplicateItem(i){this.$store.dispatch("duplicateOrder",{materialId:i}).then(()=>{this.sortAndLoad("id")})},removeItem(i){this.$store.dispatch("removeOrder",{materialId:i}).then(()=>{this.sortAndLoad("id")})}}},Kn=Object.assign(qn,{__name:"OrderTable",setup(i){return(e,n)=>(o(),l(_,null,[t("div",ct,[t("div",ut,[t("div",_t,[t("div",ht,[m(t("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=s=>e.search=s),onKeydown:n[1]||(n[1]=A(s=>e.sortAndLoad("id"),["enter"])),class:"form-control",id:"search-orders"},null,544),[[C,e.search]]),pt]),t("div",mt,[ft,t("ul",bt,[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:n[2]||(n[2]=s=>e.sortAndLoad("id"))},[kt,a(" Искать")])]),t("li",null,[t("a",{class:"dropdown-item",onClick:n[3]||(n[3]=(...s)=>e.filteredDownload&&e.filteredDownload(...s)),href:"javascript:void(0)"},[vt,a(" Скачать в Excel ")])])])])])]),t("div",gt,[b(O(j),{class:"rounded-0",locale:"ru",range:"","multi-calendars":"",modelValue:e.sort.date,"onUpdate:modelValue":n[4]||(n[4]=s=>e.sort.date=s)},{"action-row":k(({internalModelValue:s,selectDate:c,closePicker:h})=>[t("div",$t,[t("button",{class:"btn btn-dark rounded-0 mr-2",onClick:c},"Выбрать",8,yt),t("button",{class:"btn btn-outline-secondary rounded-0",onClick:h},"Закрыть",8,wt)])]),_:1},8,["modelValue"])]),t("div",Ct,[(o(!0),l(_,null,f(Object.keys(e.table),s=>(o(),l("span",{class:I(["badge mr-1 rounded-0 cursor-pointer",{"bg-dark":e.table[s].value===!0,"bg-secondary":e.table[s].value===!1}]),onClick:c=>e.changeColumns(s)},r(e.table[s].title||"-"),11,Ot))),256)),t("span",{onClick:n[5]||(n[5]=s=>e.changeColumns(null)),class:"badge mr-1 bg-danger rounded-0 cursor-pointer"},jt),t("span",{onClick:n[6]||(n[6]=(...s)=>e.resetColumns&&e.resetColumns(...s)),class:"badge mr-1 bg-secondary rounded-0 cursor-pointer"},At)]),t("div",It,[b(V,null,{name:k(()=>[a(" Скачать договор по номеру заказа ")]),_:1})])]),e.selected_orders.length>0?(o(),l(_,{key:0},[t("p",Tt,[a("Выбрано "),t("span",null,"("+r(e.selected_orders.length)+")",1),a(" элементов: "),(o(!0),l(_,null,f(e.selected_orders,s=>(o(),l("span",{onClick:c=>e.selectOrder(s),class:"badge mr-1 bg-dark rounded-0 cursor-pointer"},r(s),9,Et))),256)),t("span",{onClick:n[7]||(n[7]=s=>e.selected_orders=[]),class:"badge mr-1 bg-secondary rounded-0 cursor-pointer"},Vt)]),t("div",Bt,[t("button",{onClick:n[8]||(n[8]=(...s)=>e.downloadSelectedOrders&&e.downloadSelectedOrders(...s)),type:"button",class:"btn btn-dark rounded-0 mr-2"},"Скачать эксель ")])],64)):d("",!0),e.paginate_object?(o(),l("p",Pt,[a("Найдено результатов "),t("strong",null,r(e.paginate_object.meta.total),1)])):d("",!0),t("div",zt,[e.items.length>0?(o(),l("table",Ft,[t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"cursor-pointer",onClick:n[9]||(n[9]=s=>e.sortAndLoad("id"))},[a("# "),e.sort.direction==="desc"&&e.sort.column==="id"?(o(),l("span",St,Nt)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="id"?(o(),l("span",Rt,Kt)):d("",!0)]),Gt,e.table.contract_number.value?(o(),l("th",{key:0,scope:"col",class:"text-center cursor-pointer",onClick:n[10]||(n[10]=s=>e.sortAndLoad("contract_number"))},[a("Номер договора "),e.sort.direction==="desc"&&e.sort.column==="contract_number"?(o(),l("span",Zt,Jt)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contract_number"?(o(),l("span",Qt,Xt)):d("",!0)])):d("",!0),e.table.contract_date.value?(o(),l("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:n[11]||(n[11]=s=>e.sortAndLoad("contract_date"))},[a("Дата договора "),e.sort.direction==="desc"&&e.sort.column==="contract_date"?(o(),l("span",Yt,es)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contract_date"?(o(),l("span",ts,os)):d("",!0)])):d("",!0),e.table.completion_at.value?(o(),l("th",{key:2,scope:"col",class:"text-center cursor-pointer",onClick:n[12]||(n[12]=s=>e.sortAndLoad("completion_at"))},[a("Дата закрытия "),e.sort.direction==="desc"&&e.sort.column==="completion_at"?(o(),l("span",ns,ds)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="completion_at"?(o(),l("span",is,rs)):d("",!0)])):d("",!0),e.table.client_id.value?(o(),l("th",{key:3,scope:"col",class:"text-center cursor-pointer",onClick:n[13]||(n[13]=s=>e.sortAndLoad("client_id"))},[a("Клиент "),e.sort.direction==="desc"&&e.sort.column==="client_id"?(o(),l("span",cs,_s)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="client_id"?(o(),l("span",hs,ms)):d("",!0)])):d("",!0),e.table.status.value?(o(),l("th",{key:4,scope:"col",class:"text-center cursor-pointer",onClick:n[14]||(n[14]=s=>e.sortAndLoad("status"))},[a("Статус заказа "),e.sort.direction==="desc"&&e.sort.column==="status"?(o(),l("span",fs,ks)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="status"?(o(),l("span",vs,$s)):d("",!0)])):d("",!0),e.table.source.value?(o(),l("th",{key:5,scope:"col",class:"text-center cursor-pointer",onClick:n[15]||(n[15]=s=>e.sortAndLoad("source"))},[a("Источник "),e.sort.direction==="desc"&&e.sort.column==="source"?(o(),l("span",ys,Cs)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="source"?(o(),l("span",Os,js)):d("",!0)])):d("",!0),e.table.contact_person.value?(o(),l("th",{key:6,scope:"col",class:"text-center cursor-pointer",onClick:n[16]||(n[16]=s=>e.sortAndLoad("contact_person"))},[a("Контактное лицо "),e.sort.direction==="desc"&&e.sort.column==="contact_person"?(o(),l("span",Ls,Is)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contact_person"?(o(),l("span",Ts,Ms)):d("",!0)])):d("",!0),e.table.phone.value?(o(),l("th",{key:7,scope:"col",class:"text-center cursor-pointer",onClick:n[17]||(n[17]=s=>e.sortAndLoad("phone"))},[a("Телефон "),e.sort.direction==="desc"&&e.sort.column==="phone"?(o(),l("span",Vs,Ps)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="phone"?(o(),l("span",zs,Ss)):d("",!0)])):d("",!0),e.table.organizational_form.value?(o(),l("th",{key:8,scope:"col",class:"text-center cursor-pointer",onClick:n[18]||(n[18]=s=>e.sortAndLoad("organizational_form"))},[a("На ип\\ооо "),e.sort.direction==="desc"&&e.sort.column==="organizational_form"?(o(),l("span",Us,Rs)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="organizational_form"?(o(),l("span",qs,Gs)):d("",!0)])):d("",!0),e.table.contract_amount.value?(o(),l("th",{key:9,scope:"col",class:"text-center cursor-pointer",onClick:n[19]||(n[19]=s=>e.sortAndLoad("contract_amount"))},[a("Сумма договора "),e.sort.direction==="desc"&&e.sort.column==="contract_amount"?(o(),l("span",Zs,Js)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contract_amount"?(o(),l("span",Qs,Xs)):d("",!0)])):d("",!0),e.table.paid.value?(o(),l("th",{key:10,scope:"col",class:"text-center cursor-pointer",onClick:n[20]||(n[20]=s=>e.sortAndLoad("paid"))},[a("Оплачено "),e.sort.direction==="desc"&&e.sort.column==="paid"?(o(),l("span",Ys,eo)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="paid"?(o(),l("span",to,oo)):d("",!0)])):d("",!0),e.table.debt.value?(o(),l("th",{key:11,scope:"col",class:"text-center cursor-pointer",onClick:n[21]||(n[21]=s=>e.sortAndLoad("debt"))},[a("Задолженность "),e.sort.direction==="desc"&&e.sort.column==="debt"?(o(),l("span",no,io)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="debt"?(o(),l("span",ao,co)):d("",!0)])):d("",!0),e.table.profit.value?(o(),l("th",{key:12,scope:"col",class:"text-center cursor-pointer",onClick:n[22]||(n[22]=s=>e.sortAndLoad("profit"))},[a("Прибыль "),e.sort.direction==="desc"&&e.sort.column==="profit"?(o(),l("span",uo,ho)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="profit"?(o(),l("span",po,fo)):d("",!0)])):d("",!0)])]),t("tbody",null,[(o(!0),l(_,null,f(e.items,(s,c)=>{var h,v,g,$;return o(),l("tr",null,[t("th",bo,[t("div",ko,[m(t("input",{value:s.id,"onUpdate:modelValue":n[23]||(n[23]=u=>e.selected_orders=u),class:"form-check-input",type:"checkbox",id:"order-check-"+c},null,8,vo),[[T,e.selected_orders]]),t("label",{class:"form-check-label",for:"order-check-"+c},r(s.id||c),9,go)])]),t("td",$o,[t("div",yo,[wo,t("ul",Co,[t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.selectItemForEdit(s),href:"javascript:void(0)"},[Do,a("Редактор заказа")],8,Oo)]),jo,t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.sendToTelegram(s),href:"javascript:void(0)"},[Ao,a(" Отправить в телеграм ")],8,Lo)]),t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.sendToBitrix(s),href:"javascript:void(0)"},[To,a(" Отправить в Битрикс ")],8,Io)]),t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.sendToEmail(s),href:"javascript:void(0)"},[Mo,a(" Отправить на почту клиента ")],8,Eo)]),Vo,t("li",null,[t("a",{class:"dropdown-item",target:"_blank",href:"/orders/download-order-excel/"+s.id},[Po,a("Скачать Excel-документ по заказу")],8,Bo)]),t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.downloadDocument(s),href:"javascript:void(0)"},[Fo,a("Скачать договор")],8,zo)]),So,t("li",null,[t("a",{class:"dropdown-item text-danger",onClick:u=>e.removeItem(s.id),href:"javascript:void(0)"},[No,a("Удалить")],8,Uo)])])])]),e.table.contract_number.value?(o(),l("td",{key:0,class:"text-center",onClick:u=>e.selectItem(s)},r(s.contract_number||"-"),9,Ro)):d("",!0),e.table.contract_date.value?(o(),l("td",{key:1,class:"text-center",onClick:u=>e.selectItem(s)},r(s.contract_date||"-"),9,qo)):d("",!0),e.table.completion_at.value?(o(),l("td",Ko,r(s.completion_at||"-"),1)):d("",!0),e.table.client_id.value?(o(),l("td",Go,[t("a",{class:"btn btn-link",onClick:u=>e.selectClient(s.client),href:"javascript:void(0)"},[a(r(((h=s.client)==null?void 0:h.title)||"-")+" ",1),((v=s.client)==null?void 0:v.title)!==((g=s.client)==null?void 0:g.fio)?(o(),l("span",Ho," ( "+r((($=s.client)==null?void 0:$.fio)||"-")+") ",1)):d("",!0)],8,Zo)])):d("",!0),e.table.status.value?(o(),l("td",Jo,[(s.status||0)<=2?(o(),l("span",Qo,r(e.order_status[s.status]),1)):(o(),l("span",Wo,"Не указан"))])):d("",!0),e.table.source.value?(o(),l("td",Xo,r(s.source||"-"),1)):d("",!0),e.table.contact_person.value?(o(),l("td",Yo,r(s.contact_person||"-"),1)):d("",!0),e.table.phone.value?(o(),l("td",xo,r(s.phone||"-"),1)):d("",!0),e.table.organizational_form.value?(o(),l("td",en,r(e.getStatusByOrgForm(s.organizational_form||"-")),1)):d("",!0),e.table.contract_amount.value?(o(),l("td",tn,r(s.contract_amount||0),1)):d("",!0),e.table.paid.value?(o(),l("td",sn,r(s.paid||0),1)):d("",!0),e.table.debt.value?(o(),l("td",on,r(s.debt||0),1)):d("",!0),e.table.profit.value?(o(),l("td",nn,r(s.profit||0),1)):d("",!0)])}),256))])])):d("",!0)]),e.items.length===0?(o(),l("div",ln,rn)):d("",!0),e.items.length>0?(o(),l("div",cn,[t("div",un,[e.paginate_object?(o(),p(D,{key:0,onPagination_page:e.loadOrders,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0),t("div",_n,[t("div",hn,[t("div",pn,[t("div",mn,[e.selected_client_item?(o(),p(B,{key:0,item:e.selected_client_item,onCallback:n[24]||(n[24]=s=>e.selectClient(null))},null,8,["item"])):d("",!0)])])])]),t("div",fn,[t("div",bn,[t("div",kn,[vn,t("div",gn,[e.selected_order&&!e.loading?(o(),p(rt,{key:0,"order-id":e.selected_order.id},null,8,["order-id"])):d("",!0)]),$n])])]),t("div",yn,[t("div",wn,[t("div",Cn,[t("div",On,[Dn,t("h3",jn,r(e.confirm.title||"-"),1),t("p",Ln,r(e.confirm.message||"-"),1),t("div",An,[t("div",In,[t("div",Tn,[m(t("input",{class:"form-check-input",type:"radio",value:"1","onUpdate:modelValue":n[25]||(n[25]=s=>e.confirm.work_with_nds=s),name:"flexRadioDefault",id:"work-with-nds"},null,512),[[y,e.confirm.work_with_nds]]),En])]),t("div",Mn,[t("div",Vn,[m(t("input",{class:"form-check-input",type:"radio",value:"0",name:"flexRadioDefault","onUpdate:modelValue":n[26]||(n[26]=s=>e.confirm.work_with_nds=s),id:"work-without-nds"},null,512),[[y,e.confirm.work_with_nds]]),Bn])])]),t("div",Pn,[t("div",zn,[t("button",{class:"btn btn-dark rounded-0 w-100",type:"button",onClick:n[27]||(n[27]=(...s)=>e.downloadDocument&&e.downloadDocument(...s))},"Скачать договор ")]),t("div",Fn,[t("button",{class:"btn btn-outline-secondary rounded-0 w-100",onClick:n[28]||(n[28]=s=>e.confirm_modal.hide())}," Закрыть ")])])])])])]),t("div",Sn,[t("div",Un,[t("div",Nn,[t("div",Rn,[e.selected_item?(o(),p(M,{key:0,"can-edit":!0,doors:e.selected_item.details,order:e.selected_item},null,8,["doors","order"])):d("",!0)])])])])],64))}}),Gn=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Заказы",-1),Zn={class:"py-12"},Hn={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Jn={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Qn={class:"p-6 text-gray-900"},Wn={data(){return{loading:!1,selectedOrder:null}},methods:{selectOrder(i){this.selectedOrder=i,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackOrderForm(){this.loading=!0,this.selectedOrder=null,this.$nextTick(()=>{this.loading=!1})}}},pl=Object.assign(Wn,{__name:"OrdersPage",setup(i){return(e,n)=>(o(),l(_,null,[b(O(E),{title:"Заказы"}),b(L,null,{header:k(()=>[Gn]),default:k(()=>[t("div",Zn,[t("div",Hn,[t("div",Jn,[t("div",Qn,[e.loading?d("",!0):(o(),p(Kn,{key:0,onSelect:e.selectOrder},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{pl as default};
