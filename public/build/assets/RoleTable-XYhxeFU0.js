import{o,c as l,b as e,g as m,v as h,F as _,r as f,e as a,f as r,j as g,t as d,m as b,d as p}from"./app-CMMLTdCu.js";import{P as k}from"./Pagination-Dj4uErmk.js";import"./RalColorSelector-D3spJvK_.js";import{E as v}from"./main-BjxWdgMs.js";const y={class:"form-floating mb-3"},$=e("label",{for:"role-code"},"Название роли",-1),C={class:"form-floating mb-3"},w=e("label",{for:"role-code"},"Программный идентификатор роли",-1),R={class:"row"},j={class:"col-12"},F={class:"alert alert-danger alert-dismissible fade show",role:"alert"},I=e("strong",null,"Внимание!",-1),L=["onClick"],A={class:"row mt-5"},D={class:"col-12 d-flex justify-content-center"},P=["disabled"],S={key:0,class:"fa-regular fa-floppy-disk mr-1"},V={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},M=e("i",{class:"fa-solid fa-xmark mr-1"},null,-1),B={props:["item"],components:{VueDatePicker:v},data(){return{messages:[],loading:!1,form:{id:null,name:null,slug:null}}},computed:{needClearForm(){return this.form.id||this.form.name||this.form.slug}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,slug:this.item.slug||null,name:this.item.name||null}})},methods:{alert(i){this.messages.push(i)},resetForm(){this.form.id=null,this.form.name=null,this.form.slug=0,this.$emit("callback")},removeMessage(i){this.messages.splice(i,1)},submit(){this.$store.dispatch("storeRole",{roleForm:this.form}).then(i=>{this.$notify({title:"DoDoors",text:"Роль успешно добавлена",type:"success"}),this.$emit("callback"),this.resetForm()}).catch(i=>{this.$notify({title:"DoDoors",text:"Ошибка добавления роли",type:"error"})})}}},O=Object.assign(B,{__name:"RoleForm",setup(i){return(s,n)=>(o(),l("form",{action:"",onSubmit:n[3]||(n[3]=g((...t)=>s.submit&&s.submit(...t),["prevent"]))},[e("div",y,[m(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=t=>s.form.name=t),class:"form-control",id:"role-name",required:""},null,512),[[h,s.form.name]]),$]),e("div",C,[m(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=t=>s.form.slug=t),class:"form-control",id:"role-slug",required:""},null,512),[[h,s.form.slug]]),w]),e("div",R,[e("div",j,[s.messages.length>0?(o(!0),l(_,{key:0},f(s.messages,(t,u)=>(o(),l("div",F,[I,r(" "+d(t||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:c=>s.removeMessage(u)},null,8,L)]))),256)):a("",!0)])]),e("div",A,[e("div",D,[e("button",{disabled:!s.needClearForm,class:"btn btn-dark rounded-0"},[s.loading?(o(),l("span",V)):(o(),l("i",S)),r(" Сохранить роль ")],8,P),s.needClearForm&&!s.loading?(o(),l("button",{key:0,type:"button",onClick:n[2]||(n[2]=(...t)=>s.resetForm&&s.resetForm(...t)),class:"btn btn-outline-secondary rounded-0 ml-2"},[M,r(" Очистить форму ")])):a("",!0)])])],32))}}),T={class:"row"},E={class:"col-12"},N={class:"input-group mb-3"},U={class:"form-floating"},q=e("label",{for:"search-roles"},"Поиск по ролям",-1),G=e("i",{class:"fa-solid fa-magnifying-glass"},null,-1),z=[G],H={style:{"overflow-y":"auto"}},J={key:0,class:"table"},K={key:0},Q=e("i",{class:"fa-solid fa-caret-down"},null,-1),W=[Q],X={key:1},Y=e("i",{class:"fa-solid fa-caret-up"},null,-1),Z=[Y],x={key:0,scope:"col",class:"text-center"},ee={key:0},se=e("i",{class:"fa-solid fa-caret-down"},null,-1),te=[se],oe={key:1},le=e("i",{class:"fa-solid fa-caret-up"},null,-1),ne=[le],ie={key:0},ae=e("i",{class:"fa-solid fa-caret-down"},null,-1),re=[ae],de={key:1},ce=e("i",{class:"fa-solid fa-caret-up"},null,-1),ue=[ce],me={key:0},he=e("i",{class:"fa-solid fa-caret-down"},null,-1),_e=[he],pe={key:1},fe=e("i",{class:"fa-solid fa-caret-up"},null,-1),ge=[fe],be={scope:"row"},ke={key:0,class:"text-center"},ve={class:"dropdown"},ye=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),$e={class:"dropdown-menu"},Ce=["onClick"],we=e("i",{class:"fa-solid fa-pen mr-2"},null,-1),Re=["onClick"],je=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Fe=["onClick"],Ie=["onClick"],Le={key:1,class:"text-center"},Ae={key:0,class:"alert alert-success rounded-0",role:"alert"},De=e("h4",{class:"alert-heading"},"Роли пользователей",-1),Pe=e("p",null,"К сожалению, раздел ролей пуст. Вы еще не добавили ни одной роли, которые можно отобразить на этой странице.",-1),Se=e("hr",null,null,-1),Ve=e("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свою первую роль",-1),Me=[De,Pe,Se,Ve],Be={key:1,class:"row mb-3"},Oe={class:"col-12"},Te={class:"modal fade",id:"role-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Ee={class:"modal-dialog modal-lg"},Ne={class:"modal-content rounded-0"},Ue={class:"modal-body"},qe={props:["forSelect"],data(){return{editor_modal:null,selected_item:null,sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...b(["getRoles","getRolesPaginateObject"])},mounted(){this.loadRoles(),this.editor_modal=new bootstrap.Modal(document.getElementById("role-editor-modal"),{})},methods:{sortAndLoad(i){this.sort.column=i,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadRoles(this.current_page)},loadRoles(i=0){this.current_page=i,this.$store.dispatch("loadRoles",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(s=>{this.items=this.getRoles,this.paginate_object=this.getRolesPaginateObject}).catch(()=>{this.loading=!1})},selectItem(i){if(i==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=i,this.editor_modal.show()})},duplicateItem(i){this.$store.dispatch("duplicateRole",{roleId:i}).then(()=>{this.sortAndLoad("id")})},removeItem(i){this.$store.dispatch("removeRole",{roleId:i}).then(()=>{this.sortAndLoad("id")})}}},Ke=Object.assign(qe,{__name:"RoleTable",setup(i){return(s,n)=>(o(),l(_,null,[e("form",T,[e("div",E,[e("div",N,[e("div",U,[m(e("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=t=>s.search=t),class:"form-control",id:"search-roles"},null,512),[[h,s.search]]),q]),e("button",{type:"button",onClick:n[1]||(n[1]=t=>s.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},z)])])]),e("div",H,[s.items.length>0?(o(),l("table",J,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:n[2]||(n[2]=t=>s.sortAndLoad("id"))},[r("# "),s.sort.direction==="desc"&&s.sort.column==="id"?(o(),l("span",K,W)):a("",!0),s.sort.direction==="asc"&&s.sort.column==="id"?(o(),l("span",X,Z)):a("",!0)]),i.forSelect?a("",!0):(o(),l("th",x,"Действие")),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[3]||(n[3]=t=>s.sortAndLoad("name"))},[r("Название "),s.sort.direction==="desc"&&s.sort.column==="name"?(o(),l("span",ee,te)):a("",!0),s.sort.direction==="asc"&&s.sort.column==="name"?(o(),l("span",oe,ne)):a("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[4]||(n[4]=t=>s.sortAndLoad("slug"))},[r("Идентификатор "),s.sort.direction==="desc"&&s.sort.column==="slug"?(o(),l("span",ie,re)):a("",!0),s.sort.direction==="asc"&&s.sort.column==="slug"?(o(),l("span",de,ue)):a("",!0)]),i.forSelect?a("",!0):(o(),l("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:n[5]||(n[5]=t=>s.sortAndLoad("updated_at"))},[r(" Дата изменения "),s.sort.direction==="desc"&&s.sort.column==="updated_at"?(o(),l("span",me,_e)):a("",!0),s.sort.direction==="asc"&&s.sort.column==="updated_at"?(o(),l("span",pe,ge)):a("",!0)]))])]),e("tbody",null,[(o(!0),l(_,null,f(s.items,(t,u)=>(o(),l("tr",null,[e("th",be,d(t.id||u),1),i.forSelect?a("",!0):(o(),l("td",ke,[e("div",ve,[ye,e("ul",$e,[e("li",null,[e("a",{class:"dropdown-item",onClick:c=>s.selectItem(t),href:"javascript:void(0)"},[we,r("Редактировать")],8,Ce)]),e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:c=>s.removeItem(t.id),href:"javascript:void(0)"},[je,r("Удалить")],8,Re)])])])])),e("td",{class:"text-center",onClick:c=>s.selectItem(t)},d(t.name||"-"),9,Fe),e("td",{class:"text-center",onClick:c=>s.selectItem(t)},d(t.slug||"-"),9,Ie),i.forSelect?a("",!0):(o(),l("td",Le,d(t.updated_at||"-"),1))]))),256))])])):a("",!0)]),s.items.length===0?(o(),l("div",Ae,Me)):a("",!0),s.items.length>0?(o(),l("div",Be,[e("div",Oe,[s.paginate_object?(o(),p(k,{key:0,onPagination_page:s.loadRoles,pagination:s.paginate_object},null,8,["onPagination_page","pagination"])):a("",!0)])])):a("",!0),e("div",Te,[e("div",Ee,[e("div",Ne,[e("div",Ue,[s.selected_item?(o(),p(O,{key:0,item:s.selected_item,onCallback:n[6]||(n[6]=t=>s.selectItem(null))},null,8,["item"])):a("",!0)])])])])],64))}});export{O as _,Ke as a};
