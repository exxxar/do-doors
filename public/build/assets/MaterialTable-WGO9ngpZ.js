import{o as s,c as i,b as e,g as h,v as p,h as b,e as d,F as f,r as g,f as u,j as w,t as v,m as k,d as y}from"./app-y7v9ArMj.js";import{P as $}from"./Pagination-CLy7CU8J.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={props:["item"],data(){return{messages:[],uploaded_wrapper_image:[],uploaded_door_image:[],loading:!1,form:{id:null,title:null,is_base:!1,order_position:0,need_generate_sizes:!1,wrapper_variants:[],door_variants:[],config:{is_custom_color:!1}}}},computed:{needClearForm(){return this.form.id||this.form.title||this.uploaded_wrapper_image.length>0||this.uploaded_door_image.length>0}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,title:this.item.title||null,is_base:this.item.is_base||!1,order_position:this.item.order_position||0,config:this.item.config||{is_custom_color:!1},wrapper_variants:this.item.wrapper_variants||[],door_variants:this.item.door_variants||[]}})},methods:{alert(o){this.messages.push(o)},resetForm(){this.uploaded_wrapper_image=[],this.uploaded_door_image=[],this.form.id=null,this.form.title=null,this.form.order_position=0,this.form.is_base=!1,this.form.wrapper_variants=[],this.form.door_variants=[],this.form.config.is_custom_color=!1,this.$refs.doorImageRef.value=null,this.$refs.wrapperImageRef.value=null,this.$emit("callback")},removeUploadedPhoto(o,t){this.form[o].splice(t,1)},removePhoto(o,t){this[o].splice(t,1)},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},onChangePhotos(o,t){const n=t.target.files;for(let c=0;c<n.length;c++)this[o].push({image:n[c],title:null,description:null})},removeMessage(o){this.messages.splice(o,1)},submit(){let o=new FormData;if(Object.keys(this.form).forEach(t=>{const n=this.form[t]||"";typeof n=="object"?o.append(t,JSON.stringify(n)):o.append(t,n)}),this.uploaded_wrapper_image.length>0){for(let t=0;t<this.uploaded_wrapper_image.length;t++)o.append("wrapper_images[]",this.uploaded_wrapper_image[t].image),this.uploaded_wrapper_image[t].image_name=this.uploaded_wrapper_image[t].image.name||null;o.append("wrapper_images_info",JSON.stringify(this.uploaded_wrapper_image))}if(this.uploaded_door_image.length>0){for(let t=0;t<this.uploaded_door_image.length;t++)o.append("door_images[]",this.uploaded_door_image[t].image),this.uploaded_door_image[t].image_name=this.uploaded_door_image[t].image.name||null;o.append("door_images_info",JSON.stringify(this.uploaded_door_image))}this.$store.dispatch("storeMaterial",{materialForm:o}).then(t=>{this.resetForm(),this.$emit("callback")}).catch(t=>{this.alert(t.response.data.message)})}}},V={class:"row"},j={class:"col-md-6 col-12"},x={class:"form-floating mb-3"},I=e("label",{for:"material-title"},"Название материала",-1),M={class:"col-md-6 col-12"},P={class:"form-floating mb-3"},L=e("label",{for:"material-order-position"},"Позиция материала в выдаче",-1),T={class:"form-check form-switch mb-3"},F=e("label",{class:"form-check-label",for:"is-base"}," Является базой ",-1),O={class:"form-check form-switch mb-3"},q=e("label",{class:"form-check-label",for:"recount-by-width"}," Автоматически создать заглушки размеров ",-1),A={class:"form-check form-switch mb-3"},N=e("label",{class:"form-check-label",for:"is-custom-color"}," Ручной ввод цвета ",-1),R={class:"form-floating mb-3 border-gray-100 border"},B=e("label",{for:"door-material"},"Текстура материала для двери",-1),S={class:"row"},D={key:0,class:"col-12"},z=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),E=[z],J={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},G={class:"card w-100"},W=["src"],H={class:"card-body d-flex justify-center"},K=["onClick"],Q={class:"card-body"},X={class:"form-floating mb-3"},Y=["onUpdate:modelValue"],Z=e("label",{for:"floatingInput"},"Название",-1),ee={class:"form-floating"},te=["onUpdate:modelValue"],oe=e("label",{for:"floatingTextarea"},"Описание",-1),se={key:1,class:"col-12"},ie=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),le=[ie],ae={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},re={class:"card w-100"},de=["src"],ne=["src"],ce={class:"card-body d-flex justify-center"},me=["onClick"],_e={class:"card-body"},he={class:"form-floating mb-3"},pe=["onUpdate:modelValue"],ue=e("label",{for:"floatingInput"},"Название",-1),fe={class:"form-floating"},ge=["onUpdate:modelValue"],ve=e("label",{for:"floatingTextarea"},"Описание",-1),be={class:"form-floating mb-3 border-gray-100 border"},ye=e("label",{for:"material-wrapper"},"Текстура материала вокруг двери",-1),we={class:"row"},ke={key:0,class:"col-12"},$e=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),Ce=[$e],Ue={class:"col-md-6 mb-2 image-preview d-flex align-items-start"},Ve={class:"card w-100 rounded-0"},je=["src"],xe={class:"card-body d-flex justify-center"},Ie=["onClick"],Me={class:"card-body"},Pe={class:"form-floating mb-2"},Le=["onUpdate:modelValue"],Te=e("label",{for:"floatingInput"},"Название",-1),Fe={class:"form-floating"},Oe=["onUpdate:modelValue"],qe=e("label",{for:"floatingTextarea"},"Описание",-1),Ae={key:1,class:"col-12"},Ne=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),Re=[Ne],Be={class:"col-md-6 mb-2 image-preview d-flex align-items-start"},Se={class:"card w-100 p-1 rounded-0"},De=["src"],ze=["src"],Ee={class:"card-body d-flex justify-center"},Je=["onClick"],Ge={class:"card-body"},We={class:"form-floating mb-2"},He=["onUpdate:modelValue"],Ke=e("label",{for:"floatingInput"},"Название",-1),Qe={class:"form-floating"},Xe=["onUpdate:modelValue"],Ye=e("label",{for:"floatingTextarea"},"Описание",-1),Ze={class:"row"},et={class:"col-12"},tt={class:"alert alert-danger alert-dismissible fade show",role:"alert"},ot=e("strong",null,"Внимание!",-1),st=["onClick"],it={class:"row mt-5"},lt={class:"col-12 d-flex justify-content-center"},at=["disabled"],rt={key:0,class:"fa-regular fa-floppy-disk mr-1"},dt={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},nt=e("i",{class:"fa-solid fa-xmark mr-1"},null,-1);function ct(o,t,n,c,l,_){return s(),i("form",{action:"",onSubmit:t[8]||(t[8]=w((...a)=>_.submit&&_.submit(...a),["prevent"]))},[e("div",V,[e("div",j,[e("div",x,[h(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>l.form.title=a),class:"form-control",id:"material-title",placeholder:"name@example.com",required:""},null,512),[[p,l.form.title]]),I])]),e("div",M,[e("div",P,[h(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>l.form.order_position=a),class:"form-control",id:"material-order-position",placeholder:"name@example.com",required:""},null,512),[[p,l.form.order_position]]),L])])]),e("div",T,[h(e("input",{class:"form-check-input","onUpdate:modelValue":t[2]||(t[2]=a=>l.form.is_base=a),type:"checkbox",role:"switch",id:"is-base"},null,512),[[b,l.form.is_base]]),F]),e("div",O,[h(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=a=>l.form.need_generate_sizes=a),type:"checkbox",role:"switch",id:"recount-by-width"},null,512),[[b,l.form.need_generate_sizes]]),q]),e("div",A,[h(e("input",{class:"form-check-input","onUpdate:modelValue":t[4]||(t[4]=a=>l.form.config.is_custom_color=a),type:"checkbox",role:"switch",id:"is-custom-color"},null,512),[[b,l.form.config.is_custom_color]]),N]),e("div",R,[e("input",{type:"file",class:"form-control",accept:"image/*",id:"door-material",ref:"doorImageRef",onChange:t[5]||(t[5]=a=>_.onChangePhotos("uploaded_door_image",a)),placeholder:"name@example.com",multiple:""},null,544),B]),e("div",S,[l.uploaded_door_image.length>0?(s(),i("div",D,E)):d("",!0),(s(!0),i(f,null,g(l.uploaded_door_image,(a,r)=>(s(),i("div",J,[e("div",G,[e("img",{style:{"min-height":"200px"},src:_.getPhoto(a.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,W),e("div",H,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removePhoto("uploaded_door_image",r)},"Удалить фото",8,K)]),e("div",Q,[e("div",X,[h(e("input",{type:"text","onUpdate:modelValue":m=>l.uploaded_door_image[r].title=m,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,Y),[[p,l.uploaded_door_image[r].title]]),Z]),e("div",ee,[h(e("textarea",{class:"form-control","onUpdate:modelValue":m=>l.uploaded_door_image[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,te),[[p,l.uploaded_door_image[r].description]]),oe])])])]))),256)),l.form.door_variants.length>0?(s(),i("div",se,le)):d("",!0),(s(!0),i(f,null,g(l.form.door_variants,(a,r)=>(s(),i("div",ae,[e("div",re,[a.image.indexOf("http")===-1?(s(),i("img",{key:0,style:{"min-height":"200px"},src:"/images/"+a.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,de)):(s(),i("img",{key:1,style:{"min-height":"200px"},src:a.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,ne)),e("div",ce,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removeUploadedPhoto("door_variants",r)},"Удалить",8,me)]),e("div",_e,[e("div",he,[h(e("input",{type:"text","onUpdate:modelValue":m=>l.form.door_variants[r].title=m,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,pe),[[p,l.form.door_variants[r].title]]),ue]),e("div",fe,[h(e("textarea",{class:"form-control","onUpdate:modelValue":m=>l.form.door_variants[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,ge),[[p,l.form.door_variants[r].description]]),ve])])])]))),256))]),e("div",be,[e("input",{type:"file",class:"form-control",id:"material-wrapper",accept:"image/*",ref:"wrapperImageRef",onChange:t[6]||(t[6]=a=>_.onChangePhotos("uploaded_wrapper_image",a)),placeholder:"name@example.com",multiple:""},null,544),ye]),e("div",we,[l.uploaded_wrapper_image.length>0?(s(),i("div",ke,Ce)):d("",!0),(s(!0),i(f,null,g(l.uploaded_wrapper_image,(a,r)=>(s(),i("div",Ue,[e("div",Ve,[e("img",{style:{"min-height":"200px"},src:_.getPhoto(a.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,je),e("div",xe,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removePhoto("uploaded_wrapper_image",r)},"Удалить фото",8,Ie)]),e("div",Me,[e("div",Pe,[h(e("input",{type:"text","onUpdate:modelValue":m=>l.uploaded_wrapper_image[r].title=m,class:"form-control rounded-0 border-gray-300",id:"floatingInput"},null,8,Le),[[p,l.uploaded_wrapper_image[r].title]]),Te]),e("div",Fe,[h(e("textarea",{class:"form-control rounded-0","onUpdate:modelValue":m=>l.uploaded_wrapper_image[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea"},null,8,Oe),[[p,l.uploaded_wrapper_image[r].description]]),qe])])])]))),256)),l.form.wrapper_variants.length>0?(s(),i("div",Ae,Re)):d("",!0),(s(!0),i(f,null,g(l.form.wrapper_variants,(a,r)=>(s(),i("div",Be,[e("div",Se,[a.image.indexOf("http")===-1?(s(),i("img",{key:0,style:{"min-height":"200px"},src:"/images/"+a.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,De)):(s(),i("img",{key:1,style:{"min-height":"200px"},src:a.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,ze)),e("div",Ee,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removeUploadedPhoto("wrapper_variants",r)},"Удалить",8,Je)]),e("div",Ge,[e("div",We,[h(e("input",{type:"text","onUpdate:modelValue":m=>l.form.wrapper_variants[r].title=m,class:"form-control border-gray-300 rounded-0",id:"floatingInput",required:""},null,8,He),[[p,l.form.wrapper_variants[r].title]]),Ke]),e("div",Qe,[h(e("textarea",{class:"form-control rounded-0","onUpdate:modelValue":m=>l.form.wrapper_variants[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,Xe),[[p,l.form.wrapper_variants[r].description]]),Ye])])])]))),256))]),e("div",Ze,[e("div",et,[l.messages.length>0?(s(!0),i(f,{key:0},g(l.messages,(a,r)=>(s(),i("div",tt,[ot,u(" "+v(a||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:m=>_.removeMessage(r)},null,8,st)]))),256)):d("",!0)])]),e("div",it,[e("div",lt,[e("button",{disabled:!_.needClearForm,class:"btn btn-dark rounded-0"},[l.loading?(s(),i("span",dt)):(s(),i("i",rt)),u(" Сохранить материал ")],8,at),_.needClearForm&&!l.loading?(s(),i("button",{key:0,type:"button",onClick:t[7]||(t[7]=(...a)=>_.resetForm&&_.resetForm(...a)),class:"btn btn-outline-danger rounded-0 ml-2"},[nt,u(" Очистить форму ")])):d("",!0)])])],32)}const mt=C(U,[["render",ct]]),_t={class:"row"},ht={class:"col-12"},pt={class:"input-group mb-3"},ut={class:"form-floating"},ft=e("label",{for:"search-materials"},"Поиск по материалам",-1),gt=e("i",{class:"fa-solid fa-magnifying-glass"},null,-1),vt=[gt],bt={style:{"overflow-y":"auto"}},yt={key:0,class:"table"},wt={key:0},kt=e("i",{class:"fa-solid fa-caret-down"},null,-1),$t=[kt],Ct={key:1},Ut=e("i",{class:"fa-solid fa-caret-up"},null,-1),Vt=[Ut],jt={key:0,scope:"col",class:"text-center"},xt={key:0},It=e("i",{class:"fa-solid fa-caret-down"},null,-1),Mt=[It],Pt={key:1},Lt=e("i",{class:"fa-solid fa-caret-up"},null,-1),Tt=[Lt],Ft={key:0},Ot=e("i",{class:"fa-solid fa-caret-down"},null,-1),qt=[Ot],At={key:1},Nt=e("i",{class:"fa-solid fa-caret-up"},null,-1),Rt=[Nt],Bt={key:2,scope:"col",class:"text-center"},St={key:3,scope:"col",class:"text-center"},Dt={scope:"row"},zt={key:0,class:"text-center"},Et={class:"dropdown"},Jt=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),Gt={class:"dropdown-menu"},Wt=["onClick"],Ht=e("i",{class:"fa-solid fa-pen mr-2"},null,-1),Kt=["onClick"],Qt=e("i",{class:"fa-regular fa-copy mr-2"},null,-1),Xt=["onClick"],Yt=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Zt={class:"text-center cursor-pointer"},eo={key:1,class:"text-center"},to={key:2,class:"text-center"},oo={key:3,class:"text-center"},so={key:0,class:"alert alert-success",role:"alert"},io=e("h4",{class:"alert-heading"},"Материалы",-1),lo=e("p",null,"К сожалению, раздел материалов пуст. Вы еще не добавили ни одного материала, который можно отобразить на этой странице.",-1),ao=e("hr",null,null,-1),ro=e("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свой первый материал",-1),no=[io,lo,ao,ro],co={key:1,class:"row mb-3"},mo={class:"col-12"},_o={class:"modal fade",id:"material-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ho={class:"modal-dialog modal-lg"},po={class:"modal-content rounded-0"},uo={class:"modal-body"},fo={props:["simple"],data(){return{editor_modal:null,selected_item:null,sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,wrapper_variants:[],door_variants:[]}]}},computed:{...k(["getMaterialsPaginateObject","getMaterials"])},mounted(){this.loadMaterials(),this.editor_modal=new bootstrap.Modal(document.getElementById("material-editor-modal"),{})},methods:{sortAndLoad(o){this.sort.column=o,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadMaterials(this.current_page)},loadMaterials(o=0){this.current_page=o,this.$store.dispatch("loadMaterials",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(t=>{this.items=this.getMaterials,this.paginate_object=this.getMaterialsPaginateObject}).catch(()=>{this.loading=!1})},selectItem(o){if(o==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=o,this.editor_modal.show()})},duplicateItem(o){this.$store.dispatch("duplicateMaterial",{materialId:o}).then(()=>{this.sortAndLoad("id")})},removeItem(o){this.$store.dispatch("removeMaterial",{materialId:o}).then(()=>{this.sortAndLoad("id")})},showWrapperVariants(o){this.$emit("show-wrapper-variants",o.wrapper_variants)},showDoorVariants(o){this.$emit("show-door-variants",o.door_variants)}}},yo=Object.assign(fo,{__name:"MaterialTable",setup(o){return(t,n)=>(s(),i(f,null,[e("form",_t,[e("div",ht,[e("div",pt,[e("div",ut,[h(e("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=c=>t.search=c),class:"form-control",id:"search-materials"},null,512),[[p,t.search]]),ft]),e("button",{type:"button",onClick:n[1]||(n[1]=c=>t.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},vt)])])]),e("div",bt,[t.items.length>0?(s(),i("table",yt,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:n[2]||(n[2]=c=>t.sortAndLoad("id"))},[u("# "),t.sort.direction==="desc"&&t.sort.column==="id"?(s(),i("span",wt,$t)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="id"?(s(),i("span",Ct,Vt)):d("",!0)]),o.simple?d("",!0):(s(),i("th",jt,"Действие ")),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[3]||(n[3]=c=>t.sortAndLoad("title"))},[u("Название "),t.sort.direction==="desc"&&t.sort.column==="title"?(s(),i("span",xt,Mt)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="title"?(s(),i("span",Pt,Tt)):d("",!0)]),o.simple?d("",!0):(s(),i("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:n[4]||(n[4]=c=>t.sortAndLoad("order_position"))},[u("Позиция в выдаче "),t.sort.direction==="desc"&&t.sort.column==="order_position"?(s(),i("span",Ft,qt)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="order_position"?(s(),i("span",At,Rt)):d("",!0)])),o.simple?d("",!0):(s(),i("th",Bt,"Варианты двери ")),o.simple?d("",!0):(s(),i("th",St,"Варианты контура вокруг "))])]),e("tbody",null,[(s(!0),i(f,null,g(t.items,(c,l)=>(s(),i("tr",null,[e("th",Dt,v(c.id||l),1),o.simple?d("",!0):(s(),i("td",zt,[e("div",Et,[Jt,e("ul",Gt,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.selectItem(c),href:"javascript:void(0)"},[Ht,u("Редактировать")],8,Wt)]),e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.duplicateItem(c.id),href:"javascript:void(0)"},[Qt,u("Дублировать")],8,Kt)]),e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:_=>t.removeItem(c.id),href:"javascript:void(0)"},[Yt,u("Удалить")],8,Xt)])])])])),e("td",Zt,v(c.title||"-"),1),o.simple?d("",!0):(s(),i("td",eo,v(c.order_position||0),1)),o.simple?d("",!0):(s(),i("td",to,v((c.door_variants||[]).length),1)),o.simple?d("",!0):(s(),i("td",oo,v((c.wrapper_variants||[]).length),1))]))),256))])])):d("",!0)]),t.items.length===0?(s(),i("div",so,no)):d("",!0),t.items.length>0?(s(),i("div",co,[e("div",mo,[t.paginate_object?(s(),y($,{key:0,onPagination_page:t.loadMaterials,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0),e("div",_o,[e("div",ho,[e("div",po,[e("div",uo,[t.selected_item?(s(),y(mt,{key:0,item:t.selected_item,onCallback:n[5]||(n[5]=c=>t.selectItem(null))},null,8,["item"])):d("",!0)])])])])],64))}});export{mt as M,yo as _};
