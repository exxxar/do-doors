import{_ as j}from"./AuthenticatedLayout-CcEbYJnn.js";import{m as w,o,c as l,b as e,g as m,v as C,f as a,e as d,F as h,r as f,t as r,d as p,q as A,a as b,w as k,u as O,s as y,p as I,h as T,Z as M}from"./app-D45p5dsZ.js";import{P as D}from"./Pagination-D8TK8aBy.js";import{_ as V}from"./CalcPreview-CMYaFBMo.js";import{D as B}from"./DownloadDocumentForm--ZSNMONI.js";import{_ as E}from"./ClientForm-Dl45T08r.js";import{E as L}from"./main-SO3nlm2p.js";import"./ApplicationLogo-g6AMOIaG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IndividualDataForm-DvCQ0BD8.js";import"./vue-the-mask-CqK5ykWg.js";import"./DoorItemEditor-BWyoC59c.js";import"./RalColorSelector-DhTyCFsd.js";import"./HandleDetail-QKY2XzrE.js";import"./UserTable-BM0aFa6b.js";import"./RoleTable-CYC_zG3c.js";import"./PermissionTable-DvmPAlcp.js";const P={class:"row"},z={class:"col-12"},F={class:"input-group mb-3"},S={class:"form-floating"},U=e("label",{for:"search-orderDetails"},"Поиск по деталям заказа",-1),N=e("i",{class:"fa-solid fa-magnifying-glass"},null,-1),R=[N],q={class:"d-flex scrollable-area"},K={key:0,class:"table"},G={key:0},Z=e("i",{class:"fa-solid fa-caret-down"},null,-1),H=[Z],J={key:1},Q=e("i",{class:"fa-solid fa-caret-up"},null,-1),W=[Q],X={key:0},Y=e("i",{class:"fa-solid fa-caret-down"},null,-1),x=[Y],tt={key:1},et=e("i",{class:"fa-solid fa-caret-up"},null,-1),st=[et],ot={key:0},nt=e("i",{class:"fa-solid fa-caret-down"},null,-1),lt=[nt],dt={key:1},it=e("i",{class:"fa-solid fa-caret-up"},null,-1),at=[it],rt={key:0},ct=e("i",{class:"fa-solid fa-caret-down"},null,-1),ut=[ct],ht={key:1},_t=e("i",{class:"fa-solid fa-caret-up"},null,-1),pt=[_t],mt={key:0},ft=e("i",{class:"fa-solid fa-caret-down"},null,-1),bt=[ft],kt={key:1},vt=e("i",{class:"fa-solid fa-caret-up"},null,-1),gt=[vt],$t={key:0},yt=e("i",{class:"fa-solid fa-caret-down"},null,-1),wt=[yt],Ct={key:1},Ot=e("i",{class:"fa-solid fa-caret-up"},null,-1),Dt=[Ot],Lt={key:0},jt=e("i",{class:"fa-solid fa-caret-down"},null,-1),At=[jt],It={key:1},Tt=e("i",{class:"fa-solid fa-caret-up"},null,-1),Mt=[Tt],Vt={key:0},Bt=e("i",{class:"fa-solid fa-caret-down"},null,-1),Et=[Bt],Pt={key:1},zt=e("i",{class:"fa-solid fa-caret-up"},null,-1),Ft=[zt],St=e("th",{scope:"col",class:"text-center"},"Действие",-1),Ut={scope:"row"},Nt=["onClick"],Rt={class:"text-center"},qt={class:"text-center"},Kt={class:"text-center"},Gt={class:"text-center"},Zt={class:"text-center"},Ht={class:"text-center"},Jt={class:"text-center"},Qt={class:"dropdown"},Wt=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),Xt={class:"dropdown-menu"},Yt=["onClick"],xt=e("i",{class:"fa-solid fa-pen mr-2"},null,-1),te=["onClick"],ee=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),se={key:0,class:"alert alert-success",role:"alert"},oe=e("h4",{class:"alert-heading"},"Детали заказа",-1),ne=e("p",null,"К сожалению,в данном заказе нет деталей заказа",-1),le=[oe,ne],de={key:1,class:"row mb-3"},ie={class:"col-12"},ae={props:["orderId"],data(){return{sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...w(["getOrderDetails","getOrderDetailsPaginateObject"])},mounted(){this.loadOrderDetails()},methods:{sortAndLoad(i){this.sort.column=i,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadOrderDetails(this.current_page)},loadOrderDetails(i=0){this.current_page=i,this.$store.dispatch("loadOrderDetails",{dataObject:{order_id:this.orderId,search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(t=>{this.items=this.getOrderDetails,this.paginate_object=this.getOrderDetailsPaginateObject}).catch(()=>{this.loading=!1})},selectItem(i){this.$emit("select",i)},duplicateItem(i){this.$store.dispatch("duplicateOrderDetail",{orderDetailId:i}).then(()=>{this.sortAndLoad("id")})},removeItem(i){this.$store.dispatch("removeOrderDetail",{orderDetailId:i}).then(()=>{this.sortAndLoad("id")})}}},re=Object.assign(ae,{__name:"OrderDetailTable",setup(i){return(t,n)=>(o(),l(h,null,[e("form",P,[e("div",z,[e("div",F,[e("div",S,[m(e("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=s=>t.search=s),class:"form-control",id:"search-orderDetails"},null,512),[[C,t.search]]),U]),e("button",{type:"button",onClick:n[1]||(n[1]=s=>t.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},R)])])]),e("div",q,[t.items.length>0?(o(),l("table",K,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:n[2]||(n[2]=s=>t.sortAndLoad("id"))},[a("# "),t.sort.direction==="desc"&&t.sort.column==="id"?(o(),l("span",G,H)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="id"?(o(),l("span",J,W)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[3]||(n[3]=s=>t.sortAndLoad("door_type"))},[a("Тип двери "),t.sort.direction==="desc"&&t.sort.column==="door_type"?(o(),l("span",X,x)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="door_type"?(o(),l("span",tt,st)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[4]||(n[4]=s=>t.sortAndLoad("count"))},[a("Кол-во "),t.sort.direction==="desc"&&t.sort.column==="count"?(o(),l("span",ot,lt)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="count"?(o(),l("span",dt,at)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[5]||(n[5]=s=>t.sortAndLoad("price"))},[a("Цена "),t.sort.direction==="desc"&&t.sort.column==="price"?(o(),l("span",rt,ut)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="price"?(o(),l("span",ht,pt)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[6]||(n[6]=s=>t.sortAndLoad("comment"))},[a("Комментарий "),t.sort.direction==="desc"&&t.sort.column==="comment"?(o(),l("span",mt,bt)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="comment"?(o(),l("span",kt,gt)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[7]||(n[7]=s=>t.sortAndLoad("purpose"))},[a("Назначение двери "),t.sort.direction==="desc"&&t.sort.column==="purpose"?(o(),l("span",$t,wt)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="purpose"?(o(),l("span",Ct,Dt)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[8]||(n[8]=s=>t.sortAndLoad("door"))},[a("Параметры двери "),t.sort.direction==="desc"&&t.sort.column==="door"?(o(),l("span",Lt,At)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="door"?(o(),l("span",It,Mt)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[9]||(n[9]=s=>t.sortAndLoad("updated_at"))},[a(" Дата изменения "),t.sort.direction==="desc"&&t.sort.column==="updated_at"?(o(),l("span",Vt,Et)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="updated_at"?(o(),l("span",Pt,Ft)):d("",!0)]),St])]),e("tbody",null,[(o(!0),l(h,null,f(t.items,(s,c)=>(o(),l("tr",null,[e("th",Ut,r(s.id||c),1),e("td",{class:"text-center",onClick:_=>t.selectItem(s)},r(s.door_type||"-"),9,Nt),e("td",Rt,r(s.count||0),1),e("td",qt,r(s.price||0),1),e("td",Kt,r(s.comment||"-"),1),e("td",Gt,r(s.purpose||"-"),1),e("td",Zt,r(s.door||"-"),1),e("td",Ht,r(s.updated_at||"-"),1),e("td",Jt,[e("div",Qt,[Wt,e("ul",Xt,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.selectItem(s),href:"javascript:void(0)"},[xt,a("Редактировать")],8,Yt)]),e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:_=>t.removeItem(s.id),href:"javascript:void(0)"},[ee,a("Удалить")],8,te)])])])])]))),256))])])):d("",!0)]),t.items.length===0?(o(),l("div",se,le)):d("",!0),t.items.length>0?(o(),l("div",de,[e("div",ie,[t.paginate_object?(o(),p(D,{key:0,onPagination_page:t.loadOrderDetails,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0)],64))}}),ce={class:"row"},ue={class:"col-12"},he={class:"input-group mb-3"},_e={class:"form-floating"},pe=e("label",{for:"search-orders"},"Поиск по заказам",-1),me={class:"dropdown"},fe=e("button",{class:"btn btn-outline-secondary rounded-0 h-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-up-right-and-down-left-from-center"})],-1),be={class:"dropdown-menu"},ke=e("i",{class:"fa-solid fa-magnifying-glass"},null,-1),ve=e("i",{class:"fa-regular fa-file-excel"},null,-1),ge={class:"col-12"},$e={class:"action-row"},ye=["onClick"],we=["onClick"],Ce={class:"col-12 mb-2"},Oe=["onClick"],De=e("i",{class:"fa-solid fa-retweet"},null,-1),Le=[De],je=e("i",{class:"fa-solid fa-xmark"},null,-1),Ae=[je],Ie={class:"col-12"},Te={class:"my-3"},Me=["onClick"],Ve=e("i",{class:"fa-solid fa-xmark"},null,-1),Be=[Ve],Ee={class:"d-flex flex-wrap"},Pe={key:1,class:"my-2 small italic"},ze={class:"d-flex scrollable-area"},Fe={key:0,class:"table"},Se={key:0},Ue=e("i",{class:"fa-solid fa-caret-down"},null,-1),Ne=[Ue],Re={key:1},qe=e("i",{class:"fa-solid fa-caret-up"},null,-1),Ke=[qe],Ge=e("th",{scope:"col",class:"text-center"},"Действие",-1),Ze={key:0},He=e("i",{class:"fa-solid fa-caret-down"},null,-1),Je=[He],Qe={key:1},We=e("i",{class:"fa-solid fa-caret-up"},null,-1),Xe=[We],Ye={key:0},xe=e("i",{class:"fa-solid fa-caret-down"},null,-1),ts=[xe],es={key:1},ss=e("i",{class:"fa-solid fa-caret-up"},null,-1),os=[ss],ns={key:0},ls=e("i",{class:"fa-solid fa-caret-down"},null,-1),ds=[ls],is={key:1},as=e("i",{class:"fa-solid fa-caret-up"},null,-1),rs=[as],cs={key:0},us=e("i",{class:"fa-solid fa-caret-down"},null,-1),hs=[us],_s={key:1},ps=e("i",{class:"fa-solid fa-caret-up"},null,-1),ms=[ps],fs={key:0},bs=e("i",{class:"fa-solid fa-caret-down"},null,-1),ks=[bs],vs={key:1},gs=e("i",{class:"fa-solid fa-caret-up"},null,-1),$s=[gs],ys={key:0},ws=e("i",{class:"fa-solid fa-caret-down"},null,-1),Cs=[ws],Os={key:1},Ds=e("i",{class:"fa-solid fa-caret-up"},null,-1),Ls=[Ds],js={key:0},As=e("i",{class:"fa-solid fa-caret-down"},null,-1),Is=[As],Ts={key:1},Ms=e("i",{class:"fa-solid fa-caret-up"},null,-1),Vs=[Ms],Bs={key:0},Es=e("i",{class:"fa-solid fa-caret-down"},null,-1),Ps=[Es],zs={key:1},Fs=e("i",{class:"fa-solid fa-caret-up"},null,-1),Ss=[Fs],Us={key:0},Ns=e("i",{class:"fa-solid fa-caret-down"},null,-1),Rs=[Ns],qs={key:1},Ks=e("i",{class:"fa-solid fa-caret-up"},null,-1),Gs=[Ks],Zs={key:0},Hs=e("i",{class:"fa-solid fa-caret-down"},null,-1),Js=[Hs],Qs={key:1},Ws=e("i",{class:"fa-solid fa-caret-up"},null,-1),Xs=[Ws],Ys={key:0},xs=e("i",{class:"fa-solid fa-caret-down"},null,-1),to=[xs],eo={key:1},so=e("i",{class:"fa-solid fa-caret-up"},null,-1),oo=[so],no={key:0},lo=e("i",{class:"fa-solid fa-caret-down"},null,-1),io=[lo],ao={key:1},ro=e("i",{class:"fa-solid fa-caret-up"},null,-1),co=[ro],uo={key:0},ho=e("i",{class:"fa-solid fa-caret-down"},null,-1),_o=[ho],po={key:1},mo=e("i",{class:"fa-solid fa-caret-up"},null,-1),fo=[mo],bo={scope:"row"},ko={class:"form-check"},vo=["value","id"],go=["for"],$o={class:"text-center"},yo={class:"dropdown"},wo=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),Co={class:"dropdown-menu"},Oo=["onClick"],Do=e("i",{class:"fa-solid fa-pen mr-2"},null,-1),Lo=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),jo=["onClick"],Ao=e("i",{class:"fa-solid fa-paper-plane mr-2"},null,-1),Io=["onClick"],To=e("i",{class:"fa-solid fa-square-arrow-up-right mr-2"},null,-1),Mo=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),Vo=["href"],Bo=e("i",{class:"fa-regular fa-file-excel mr-2"},null,-1),Eo=["onClick"],Po=e("i",{class:"fa-solid fa-file-signature mr-2"},null,-1),zo=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),Fo=["onClick"],So=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Uo=["onClick"],No=["onClick"],Ro={key:2,class:"text-center"},qo={key:3,class:"text-center"},Ko=["onClick"],Go={key:0},Zo={key:4,class:"text-center"},Ho={key:0},Jo={key:1},Qo={key:5,class:"text-center"},Wo={key:6,class:"text-center"},Xo={key:7,class:"text-center"},Yo={key:8,class:"text-center"},xo={key:9,class:"text-center"},tn={key:10,class:"text-center"},en={key:11,class:"text-center"},sn={key:12,class:"text-center"},on={key:2,class:"alert alert-success rounded-0",role:"alert"},nn=e("h4",{class:"alert-heading"},"Заказы",-1),ln=e("p",null,"К сожалению, раздел заказов пуст.",-1),dn=[nn,ln],an={key:3,class:"row mb-3"},rn={class:"col-12"},cn={class:"modal fade",id:"client-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},un={class:"modal-dialog modal-lg"},hn={class:"modal-content rounded-0"},_n={class:"modal-body"},pn={class:"modal fade",id:"order-details",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},mn={class:"modal-dialog modal-fullscreen"},fn={class:"modal-content"},bn=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Детали заказа"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},[e("i",{class:"fa-solid fa-xmark"})])],-1),kn={class:"modal-body"},vn=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary rounded-0","data-bs-dismiss":"modal"},"Закрыть ")],-1),gn={class:"modal fade",id:"confirm-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},$n={class:"modal-dialog modal-dialog-centered"},yn={class:"modal-content rounded-0"},wn={class:"modal-body"},Cn=e("div",{class:"d-flex justify-center p-3"},[e("img",{src:"/images/logo.png",style:{width:"100px"},alt:""})],-1),On={class:"font-bold text-center py-3"},Dn={class:"text-center pb-3"},Ln={class:"row mb-3"},jn={class:"col-md-6 d-flex justify-center"},An={class:"form-check"},In=e("label",{class:"form-check-label",for:"work-with-nds"}," Работаю с НДС ",-1),Tn={class:"col-md-6 d-flex justify-center"},Mn={class:"form-check"},Vn=e("label",{class:"form-check-label",for:"work-without-nds"}," Работаю без НДС ",-1),Bn={class:"row"},En={class:"col-6"},Pn={class:"col-6"},zn={class:"modal fade",id:"order-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Fn={class:"modal-dialog modal-xl"},Sn={class:"modal-content rounded-0"},Un={class:"modal-body"},Nn={components:{VueDatePicker:L},data(){return{selected_client_item:null,editor_modal:null,selected_orders:[],selected_item:null,organization_forms:{individual:"ИП",legal_entity:"ООО",phys:"ФЛ"},table:{contract_number:{title:"Номер договора",value:!0},contract_date:{title:"Дата договора",value:!0},completion_at:{title:"Дата закрытия",value:!0},client_id:{title:"Идентификатор клиента",value:!0},status:{title:"Статус",value:!0},source:{title:"Источник",value:!0},contact_person:{title:"Контактное лицо",value:!0},phone:{title:"Номер телефона",value:!0},organizational_form:{title:"Организационная форма",value:!0},contract_amount:{title:"Сумма договора",value:!0},paid:{title:"Оплачено",value:!0},debt:{title:"Остаток",value:!0},profit:{title:"Доход",value:!0}},sort:{column:null,date:null,direction:"desc"},selected_order:null,order_detail_modal:null,order_status:["Новый заказ","В работе","Завершен"],search:null,current_page:0,paginate_object:null,loading:!1,confirm_modal:null,confirm:{title:null,message:null,work_with_nds:1,item:null},items:[{id:null,contract_number:null,contract_date:null,completion_at:null,client_id:null,status:null,source:null,contact_person:null,phone:null,organizational_form:null,contract_amount:null,paid:null,debt:null,profit:null}]}},computed:{...w(["getOrders","getOrdersPaginateObject"])},mounted(){this.loadOrders(),this.order_detail_modal=new bootstrap.Modal(document.getElementById("order-details"),{}),this.confirm_modal=new bootstrap.Modal(document.getElementById("confirm-modal"),{}),this.editor_modal=new bootstrap.Modal(document.getElementById("order-editor-modal"),{}),this.client_editor_modal=new bootstrap.Modal(document.getElementById("client-editor-modal"),{})},methods:{selectClient(i){if(i==null){this.selected_client_item=null,this.client_editor_modal.hide();return}this.selected_client_item=null,this.$nextTick(()=>{this.selected_client_item=i,this.client_editor_modal.show()})},getStatusByOrgForm(i){let t=this.organization_forms[i]||!1;return t||"Новый клиент"},selectOrder(i){let t=this.selected_orders.findIndex(n=>n===i);t===-1?this.selected_orders.push(i):this.selected_orders.splice(t,1)},resetColumns(){Object.keys(this.table).forEach(i=>{this.table[i].value=!0})},changeColumns(i){i?this.table[i].value=!this.table[i].value:Object.keys(this.table).forEach(t=>{this.table[t].value=!this.table[t].value})},openConfirmModal(i,t,n){this.confirm.title=i||null,this.confirm.message=t||null,this.confirm.item=n||null,this.confirm_modal.show()},sortAndLoad(i){this.sort.column=i,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadOrders(this.current_page)},downloadSelectedOrders(){let i=this.sort,t=(i.date||[]).length>0?new Date(i.date[0]).getTime():null,n=(i.date||[]).length>1?new Date(i.date[1]).getTime():null,s=`/orders/download-filtered-orders?order=id&ids=${this.selected_orders.join(",")}&type=multiply`;t&&n&&(s+=`&df=${t}&dt=${n}`),this.search&&(s+=`&search=${this.search||null}`),window.open(s,"_blank").focus()},filteredDownload(){let i=this.sort,t=(i.date||[]).length>0?new Date(i.date[0]).getTime():null,n=(i.date||[]).length>1?new Date(i.date[1]).getTime():null,s="/orders/download-filtered-orders?order=id";t&&n&&(s+=`&df=${t}&dt=${n}`),this.search&&(s+=`&search=${this.search||null}`),window.open(s,"_blank").focus()},sendToBitrix(i){this.$store.dispatch("sendOrderToBitrix",{order_id:i.id}).then(()=>{this.$notify({title:"DoDoors",text:"Информация успешно отправлена в Битрикс",type:"success"})}).catch(()=>{this.$notify({title:"DoDoors",text:"Ошибка отправки информации в Битрикс",type:"error"})})},sendToTelegram(i){this.$store.dispatch("sendOrderToTelegram",{order_id:i.id}).then(()=>{this.$notify({title:"DoDoors",text:"Информация успешно отправлена в Телеграм",type:"success"})}).catch(()=>{this.$notify({title:"DoDoors",text:"Ошибка отправки информации в Телеграм",type:"error"})})},downloadDocument(i){window.open(`/orders/download-contract?id=${i.id}`,"_blank").focus()},loadOrders(i=0){this.current_page=i;let t=this.sort,n=(t.date||[]).length>0?t.date[0]:null,s=(t.date||[]).length>1?t.date[1]:null;this.$store.dispatch("loadOrders",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction,df:n||null,dt:s||null},page:this.current_page}).then(c=>{this.items=this.getOrders,this.paginate_object=this.getOrdersPaginateObject}).catch(()=>{this.loading=!1})},selectItemForEdit(i){if(i==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=i,this.editor_modal.show()})},selectItem(i){this.loading=!0,this.selected_order=i,this.$nextTick(()=>{this.loading=!1,this.order_detail_modal.show()})},duplicateItem(i){this.$store.dispatch("duplicateOrder",{materialId:i}).then(()=>{this.sortAndLoad("id")})},removeItem(i){this.$store.dispatch("removeOrder",{materialId:i}).then(()=>{this.sortAndLoad("id")})}}},Rn=Object.assign(Nn,{__name:"OrderTable",setup(i){return(t,n)=>(o(),l(h,null,[e("div",ce,[e("div",ue,[e("div",he,[e("div",_e,[m(e("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=s=>t.search=s),onKeydown:n[1]||(n[1]=A(s=>t.sortAndLoad("id"),["enter"])),class:"form-control",id:"search-orders"},null,544),[[C,t.search]]),pe]),e("div",me,[fe,e("ul",be,[e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:n[2]||(n[2]=s=>t.sortAndLoad("id"))},[ke,a(" Искать")])]),e("li",null,[e("a",{class:"dropdown-item",onClick:n[3]||(n[3]=(...s)=>t.filteredDownload&&t.filteredDownload(...s)),href:"javascript:void(0)"},[ve,a(" Скачать в Excel ")])])])])])]),e("div",ge,[b(O(L),{class:"rounded-0",locale:"ru",range:"","multi-calendars":"",modelValue:t.sort.date,"onUpdate:modelValue":n[4]||(n[4]=s=>t.sort.date=s)},{"action-row":k(({internalModelValue:s,selectDate:c,closePicker:_})=>[e("div",$e,[e("button",{class:"btn btn-dark rounded-0 mr-2",onClick:c},"Выбрать",8,ye),e("button",{class:"btn btn-outline-secondary rounded-0",onClick:_},"Закрыть",8,we)])]),_:1},8,["modelValue"])]),e("div",Ce,[(o(!0),l(h,null,f(Object.keys(t.table),s=>(o(),l("span",{class:I(["badge mr-1 rounded-0 cursor-pointer",{"bg-dark":t.table[s].value===!0,"bg-secondary":t.table[s].value===!1}]),onClick:c=>t.changeColumns(s)},r(t.table[s].title||"-"),11,Oe))),256)),e("span",{onClick:n[5]||(n[5]=s=>t.changeColumns(null)),class:"badge mr-1 bg-danger rounded-0 cursor-pointer"},Le),e("span",{onClick:n[6]||(n[6]=(...s)=>t.resetColumns&&t.resetColumns(...s)),class:"badge mr-1 bg-secondary rounded-0 cursor-pointer"},Ae)]),e("div",Ie,[b(B,null,{name:k(()=>[a(" Скачать договор по номеру заказа ")]),_:1})])]),t.selected_orders.length>0?(o(),l(h,{key:0},[e("p",Te,[a("Выбрано "),e("span",null,"("+r(t.selected_orders.length)+")",1),a(" элементов: "),(o(!0),l(h,null,f(t.selected_orders,s=>(o(),l("span",{onClick:c=>t.selectOrder(s),class:"badge mr-1 bg-dark rounded-0 cursor-pointer"},r(s),9,Me))),256)),e("span",{onClick:n[7]||(n[7]=s=>t.selected_orders=[]),class:"badge mr-1 bg-secondary rounded-0 cursor-pointer"},Be)]),e("div",Ee,[e("button",{onClick:n[8]||(n[8]=(...s)=>t.downloadSelectedOrders&&t.downloadSelectedOrders(...s)),type:"button",class:"btn btn-dark rounded-0 mr-2"},"Скачать эксель ")])],64)):d("",!0),t.paginate_object?(o(),l("p",Pe,[a("Найдено результатов "),e("strong",null,r(t.paginate_object.meta.total),1)])):d("",!0),e("div",ze,[t.items.length>0?(o(),l("table",Fe,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:n[9]||(n[9]=s=>t.sortAndLoad("id"))},[a("# "),t.sort.direction==="desc"&&t.sort.column==="id"?(o(),l("span",Se,Ne)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="id"?(o(),l("span",Re,Ke)):d("",!0)]),Ge,t.table.contract_number.value?(o(),l("th",{key:0,scope:"col",class:"text-center cursor-pointer",onClick:n[10]||(n[10]=s=>t.sortAndLoad("contract_number"))},[a("Номер договора "),t.sort.direction==="desc"&&t.sort.column==="contract_number"?(o(),l("span",Ze,Je)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="contract_number"?(o(),l("span",Qe,Xe)):d("",!0)])):d("",!0),t.table.contract_date.value?(o(),l("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:n[11]||(n[11]=s=>t.sortAndLoad("contract_date"))},[a("Дата договора "),t.sort.direction==="desc"&&t.sort.column==="contract_date"?(o(),l("span",Ye,ts)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="contract_date"?(o(),l("span",es,os)):d("",!0)])):d("",!0),t.table.completion_at.value?(o(),l("th",{key:2,scope:"col",class:"text-center cursor-pointer",onClick:n[12]||(n[12]=s=>t.sortAndLoad("completion_at"))},[a("Дата закрытия "),t.sort.direction==="desc"&&t.sort.column==="completion_at"?(o(),l("span",ns,ds)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="completion_at"?(o(),l("span",is,rs)):d("",!0)])):d("",!0),t.table.client_id.value?(o(),l("th",{key:3,scope:"col",class:"text-center cursor-pointer",onClick:n[13]||(n[13]=s=>t.sortAndLoad("client_id"))},[a("Клиент "),t.sort.direction==="desc"&&t.sort.column==="client_id"?(o(),l("span",cs,hs)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="client_id"?(o(),l("span",_s,ms)):d("",!0)])):d("",!0),t.table.status.value?(o(),l("th",{key:4,scope:"col",class:"text-center cursor-pointer",onClick:n[14]||(n[14]=s=>t.sortAndLoad("status"))},[a("Статус заказа "),t.sort.direction==="desc"&&t.sort.column==="status"?(o(),l("span",fs,ks)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="status"?(o(),l("span",vs,$s)):d("",!0)])):d("",!0),t.table.source.value?(o(),l("th",{key:5,scope:"col",class:"text-center cursor-pointer",onClick:n[15]||(n[15]=s=>t.sortAndLoad("source"))},[a("Источник "),t.sort.direction==="desc"&&t.sort.column==="source"?(o(),l("span",ys,Cs)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="source"?(o(),l("span",Os,Ls)):d("",!0)])):d("",!0),t.table.contact_person.value?(o(),l("th",{key:6,scope:"col",class:"text-center cursor-pointer",onClick:n[16]||(n[16]=s=>t.sortAndLoad("contact_person"))},[a("Контактное лицо "),t.sort.direction==="desc"&&t.sort.column==="contact_person"?(o(),l("span",js,Is)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="contact_person"?(o(),l("span",Ts,Vs)):d("",!0)])):d("",!0),t.table.phone.value?(o(),l("th",{key:7,scope:"col",class:"text-center cursor-pointer",onClick:n[17]||(n[17]=s=>t.sortAndLoad("phone"))},[a("Телефон "),t.sort.direction==="desc"&&t.sort.column==="phone"?(o(),l("span",Bs,Ps)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="phone"?(o(),l("span",zs,Ss)):d("",!0)])):d("",!0),t.table.organizational_form.value?(o(),l("th",{key:8,scope:"col",class:"text-center cursor-pointer",onClick:n[18]||(n[18]=s=>t.sortAndLoad("organizational_form"))},[a("На ип\\ооо "),t.sort.direction==="desc"&&t.sort.column==="organizational_form"?(o(),l("span",Us,Rs)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="organizational_form"?(o(),l("span",qs,Gs)):d("",!0)])):d("",!0),t.table.contract_amount.value?(o(),l("th",{key:9,scope:"col",class:"text-center cursor-pointer",onClick:n[19]||(n[19]=s=>t.sortAndLoad("contract_amount"))},[a("Сумма договора "),t.sort.direction==="desc"&&t.sort.column==="contract_amount"?(o(),l("span",Zs,Js)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="contract_amount"?(o(),l("span",Qs,Xs)):d("",!0)])):d("",!0),t.table.paid.value?(o(),l("th",{key:10,scope:"col",class:"text-center cursor-pointer",onClick:n[20]||(n[20]=s=>t.sortAndLoad("paid"))},[a("Оплачено "),t.sort.direction==="desc"&&t.sort.column==="paid"?(o(),l("span",Ys,to)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="paid"?(o(),l("span",eo,oo)):d("",!0)])):d("",!0),t.table.debt.value?(o(),l("th",{key:11,scope:"col",class:"text-center cursor-pointer",onClick:n[21]||(n[21]=s=>t.sortAndLoad("debt"))},[a("Задолженность "),t.sort.direction==="desc"&&t.sort.column==="debt"?(o(),l("span",no,io)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="debt"?(o(),l("span",ao,co)):d("",!0)])):d("",!0),t.table.profit.value?(o(),l("th",{key:12,scope:"col",class:"text-center cursor-pointer",onClick:n[22]||(n[22]=s=>t.sortAndLoad("profit"))},[a("Прибыль "),t.sort.direction==="desc"&&t.sort.column==="profit"?(o(),l("span",uo,_o)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="profit"?(o(),l("span",po,fo)):d("",!0)])):d("",!0)])]),e("tbody",null,[(o(!0),l(h,null,f(t.items,(s,c)=>{var _,v,g,$;return o(),l("tr",null,[e("th",bo,[e("div",ko,[m(e("input",{value:s.id,"onUpdate:modelValue":n[23]||(n[23]=u=>t.selected_orders=u),class:"form-check-input",type:"checkbox",id:"order-check-"+c},null,8,vo),[[T,t.selected_orders]]),e("label",{class:"form-check-label",for:"order-check-"+c},r(s.id||c),9,go)])]),e("td",$o,[e("div",yo,[wo,e("ul",Co,[e("li",null,[e("a",{class:"dropdown-item",onClick:u=>t.selectItemForEdit(s),href:"javascript:void(0)"},[Do,a("Редактор заказа")],8,Oo)]),Lo,e("li",null,[e("a",{class:"dropdown-item disabled",onClick:u=>t.sendToTelegram(s),href:"javascript:void(0)"},[Ao,a(" Отправить в телеграм ")],8,jo)]),e("li",null,[e("a",{class:"dropdown-item disabled",onClick:u=>t.sendToBitrix(s),href:"javascript:void(0)"},[To,a(" Отправить в Битрикс ")],8,Io)]),Mo,e("li",null,[e("a",{class:"dropdown-item",target:"_blank",href:"/orders/download-order-excel/"+s.id},[Bo,a("Скачать Excel-документ по заказу")],8,Vo)]),e("li",null,[e("a",{class:"dropdown-item",onClick:u=>t.downloadDocument(s),href:"javascript:void(0)"},[Po,a("Скачать договор")],8,Eo)]),zo,e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:u=>t.removeItem(s.id),href:"javascript:void(0)"},[So,a("Удалить")],8,Fo)])])])]),t.table.contract_number.value?(o(),l("td",{key:0,class:"text-center",onClick:u=>t.selectItem(s)},r(s.contract_number||"-"),9,Uo)):d("",!0),t.table.contract_date.value?(o(),l("td",{key:1,class:"text-center",onClick:u=>t.selectItem(s)},r(s.contract_date||"-"),9,No)):d("",!0),t.table.completion_at.value?(o(),l("td",Ro,r(s.completion_at||"-"),1)):d("",!0),t.table.client_id.value?(o(),l("td",qo,[e("a",{class:"btn btn-link",onClick:u=>t.selectClient(s.client),href:"javascript:void(0)"},[a(r(((_=s.client)==null?void 0:_.title)||"-")+" ",1),((v=s.client)==null?void 0:v.title)!==((g=s.client)==null?void 0:g.fio)?(o(),l("span",Go," ( "+r((($=s.client)==null?void 0:$.fio)||"-")+") ",1)):d("",!0)],8,Ko)])):d("",!0),t.table.status.value?(o(),l("td",Zo,[(s.status||0)<=2?(o(),l("span",Ho,r(t.order_status[s.status]),1)):(o(),l("span",Jo,"Не указан"))])):d("",!0),t.table.source.value?(o(),l("td",Qo,r(s.source||"-"),1)):d("",!0),t.table.contact_person.value?(o(),l("td",Wo,r(s.contact_person||"-"),1)):d("",!0),t.table.phone.value?(o(),l("td",Xo,r(s.phone||"-"),1)):d("",!0),t.table.organizational_form.value?(o(),l("td",Yo,r(t.getStatusByOrgForm(s.organizational_form||"-")),1)):d("",!0),t.table.contract_amount.value?(o(),l("td",xo,r(s.contract_amount||0),1)):d("",!0),t.table.paid.value?(o(),l("td",tn,r(s.paid||0),1)):d("",!0),t.table.debt.value?(o(),l("td",en,r(s.debt||0),1)):d("",!0),t.table.profit.value?(o(),l("td",sn,r(s.profit||0),1)):d("",!0)])}),256))])])):d("",!0)]),t.items.length===0?(o(),l("div",on,dn)):d("",!0),t.items.length>0?(o(),l("div",an,[e("div",rn,[t.paginate_object?(o(),p(D,{key:0,onPagination_page:t.loadOrders,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0),e("div",cn,[e("div",un,[e("div",hn,[e("div",_n,[t.selected_client_item?(o(),p(E,{key:0,item:t.selected_client_item,onCallback:n[24]||(n[24]=s=>t.selectClient(null))},null,8,["item"])):d("",!0)])])])]),e("div",pn,[e("div",mn,[e("div",fn,[bn,e("div",kn,[t.selected_order&&!t.loading?(o(),p(re,{key:0,"order-id":t.selected_order.id},null,8,["order-id"])):d("",!0)]),vn])])]),e("div",gn,[e("div",$n,[e("div",yn,[e("div",wn,[Cn,e("h3",On,r(t.confirm.title||"-"),1),e("p",Dn,r(t.confirm.message||"-"),1),e("div",Ln,[e("div",jn,[e("div",An,[m(e("input",{class:"form-check-input",type:"radio",value:"1","onUpdate:modelValue":n[25]||(n[25]=s=>t.confirm.work_with_nds=s),name:"flexRadioDefault",id:"work-with-nds"},null,512),[[y,t.confirm.work_with_nds]]),In])]),e("div",Tn,[e("div",Mn,[m(e("input",{class:"form-check-input",type:"radio",value:"0",name:"flexRadioDefault","onUpdate:modelValue":n[26]||(n[26]=s=>t.confirm.work_with_nds=s),id:"work-without-nds"},null,512),[[y,t.confirm.work_with_nds]]),Vn])])]),e("div",Bn,[e("div",En,[e("button",{class:"btn btn-dark rounded-0 w-100",type:"button",onClick:n[27]||(n[27]=(...s)=>t.downloadDocument&&t.downloadDocument(...s))},"Скачать договор ")]),e("div",Pn,[e("button",{class:"btn btn-outline-secondary rounded-0 w-100",onClick:n[28]||(n[28]=s=>t.confirm_modal.hide())}," Закрыть ")])])])])])]),e("div",zn,[e("div",Fn,[e("div",Sn,[e("div",Un,[t.selected_item?(o(),p(V,{key:0,"can-edit":!0,doors:t.selected_item.details,order:t.selected_item},null,8,["doors","order"])):d("",!0)])])])])],64))}}),qn=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Заказы",-1),Kn={class:"py-12"},Gn={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Zn={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Hn={class:"p-6 text-gray-900"},Jn={data(){return{loading:!1,selectedOrder:null}},methods:{selectOrder(i){this.selectedOrder=i,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackOrderForm(){this.loading=!0,this.selectedOrder=null,this.$nextTick(()=>{this.loading=!1})}}},hl=Object.assign(Jn,{__name:"OrdersPage",setup(i){return(t,n)=>(o(),l(h,null,[b(O(M),{title:"Заказы"}),b(j,null,{header:k(()=>[qn]),default:k(()=>[e("div",Kn,[e("div",Gn,[e("div",Zn,[e("div",Hn,[t.loading?d("",!0):(o(),p(Rn,{key:0,onSelect:t.selectOrder},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{hl as default};
