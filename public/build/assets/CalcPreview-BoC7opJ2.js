import{_ as B,a as L}from"./DoorItemEditor-Bim17LhK.js";import{m as U,l as H,o as s,c as l,b as e,f as _,t as c,n as z,e as a,F as w,r as S,p as g,g as k,d as O,h as T,v as F,x as N,a as M,w as W,j as A}from"./app-O5Q0GFN0.js";import{L as J,I as R}from"./IndividualDataForm-ujEXQDpl.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{v as K}from"./vue-the-mask-B735Myrw.js";const Q={key:0,class:"row"},X={class:"col-md-6"},Y={class:"row"},Z={class:"col-md-6 col-12 mb-2"},ee=["disabled"],te=e("i",{class:"fa-solid fa-floppy-disk"},null,-1),oe={class:"col-md-6 col-12 mb-2"},se={class:"card rounded-0 border-black"},le={class:"card-body px-2 py-1"},ie=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-signs-post"}),_(" Назначение двери")],-1),ne={class:"col-md-6 col-12 mb-2"},re={class:"card rounded-0 border-black"},de={class:"card-body px-2 py-1"},ce=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-ruler-vertical"}),_(" Высота, мм")],-1),ae=["innerHTML"],_e={class:"col-md-6 col-12 mb-2"},ue={class:"card rounded-0 border-black"},he={class:"card-body px-2 py-1"},pe=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-ruler-horizontal"}),_(" Ширина, мм ")],-1),me=["innerHTML"],fe={class:"col-md-6 col-12 mb-2"},ye={class:"card rounded-0 border-black"},be={class:"card-body px-2 py-1"},ve=e("label",{class:"font-size-10"},[e("i",{class:"fa-brands fa-openid"}),_(" Тип открытия двери и толщина ")],-1),ke={class:"col-md-6 col-12 mb-2"},ge={class:"card rounded-0 border-black"},we={class:"card-body px-2 py-1"},Fe=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-door-open"}),_(" Тип двери ")],-1),$e={class:"col-md-6 col-12 mb-2"},xe={class:"card rounded-0 border-black"},Ce={class:"card-body px-2 py-1"},Pe=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-industry"}),_(" Производитель петель ")],-1),Ve={class:"col-md-6 col-12 mb-2"},ze={class:"card rounded-0 border-black"},je={class:"card-body px-2 py-1"},Te=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-angles-left"}),_(" Сторона петель ")],-1),De={class:"col-md-6 col-12 mb-2"},Ee={class:"card rounded-0 border-black"},Ie={class:"card-body px-2 py-1"},Se=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-paint-roller"}),_(" Отделка первой стороны ")],-1),Oe={class:"col-md-6 col-12 mb-2"},Ue={class:"card-body px-2 py-1"},qe=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-palette"}),_(" Цвет отделки первой стороны ")],-1),Me={key:1,class:"card rounded-0"},Be=e("div",{class:"card-body p-3 disabled-element"},[e("p",{class:"text-center"},'Выбрано "Под покраску"')],-1),Le=[Be],He={class:"col-md-6 col-12 mb-2"},Ne={class:"card rounded-0 border-black"},We={class:"card-body px-2 py-1"},Ae=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-paint-roller"}),_(" Отделка второй стороны ")],-1),Je={class:"col-md-6 col-12 mb-2"},Re={class:"card-body px-2 py-1"},Ge=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-palette"}),_(" Цвет отделки второй стороны ")],-1),Ke={key:1,class:"card rounded-0"},Qe=e("div",{class:"card-body p-3 disabled-element"},[e("p",{class:"text-center"},'Выбрано "Под покраску"')],-1),Xe=[Qe],Ye={class:"col-md-6 col-12 mb-2"},Ze={class:"card-body px-2 py-1"},et=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-palette"}),_(" Цвет короба и каркаса ")],-1),tt={class:"col-md-6 col-12 mb-2"},ot={class:"card-body px-2 py-1"},st=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-palette"}),_(" Цвет уплотнителя ")],-1),lt={class:"col-md-6 col-12 mb-2"},it={class:"card-body px-2 py-1"},nt=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-palette"}),_(" Цвет фурнитуры ")],-1),rt={key:0,class:"col-md-6 col-12 mb-2"},dt={class:"card-body px-2 py-1"},ct=e("label",{class:"font-size-10"},[e("i",{class:"fa-solid fa-palette"}),_(" Цвет фурнитуры ")],-1),at={class:"col-12 mb-2"},_t={style:{"min-height":"100px"},class:"card rounded-0 border-black"},ut={class:"card-body px-2 py-1"},ht=e("label",{class:"font-size-10"},"Комментарий к двери ",-1),pt={key:0,class:"row py-3"},mt={class:"col-12 d-flex align-items-center"},ft={key:0,class:"fw-bold"},yt={key:1,class:"fw-bold"},bt={key:0,class:"col-md-6 col-12 mb-2"},vt={class:"card rounded-0 border-black"},kt={class:"card-body px-2 py-1"},gt=e("label",{class:"font-size-10"},"Отверстие под ручку ",-1),wt={key:1,class:"col-md-6 col-12 mb-2"},Ft={key:0,class:"card rounded-0 border-black mb-2"},$t={class:"card-body px-2 py-1"},xt=e("label",{class:"font-size-10"},"Вариант ручки ",-1),Ct={key:1,class:"card rounded-0 border-black"},Pt={class:"card-body px-2 py-1"},Vt=e("label",{class:"font-size-10"},"Вариант завертки ",-1),zt={key:2,class:"col-12"},jt={class:"row"},Tt={class:"col-12"},Dt={class:"mb-2"},Et={class:"col-lg-3 col-md-3 col-12 mb-2"},It=["onClick"],St={class:"card-img-top",alt:"..."},Ot={class:"card-body"},Ut={key:0,class:"font-bold"},qt={key:1,class:"card-text"},Mt={key:3,class:"col-12"},Bt=e("div",{class:"alert alert-warning rounded-0",role:"alert"},[e("p",null,"Вариантов изображений ручки нет")],-1),Lt=[Bt],Ht={class:"col-12 d-flex align-items-center"},Nt={key:0,class:"fw-bold"},Wt={key:1,class:"fw-bold"},At={class:"col-12 d-flex align-items-center"},Jt={key:0,class:"fw-bold"},Rt={key:1,class:"fw-bold"},Gt={key:4,class:"col-12"},Kt={class:"card rounded-0 border-black"},Qt={class:"card-body px-2 py-1"},Xt=e("label",{class:"font-size-10"},"Вариант ",-1),Yt={class:"col-12 d-flex align-items-center"},Zt={key:0,class:"fw-bold"},eo={key:1,class:"fw-bold"},to={key:5,class:"col-12"},oo={class:"card rounded-0 border-black"},so={class:"card-body px-2 py-1"},lo=e("label",{class:"font-size-10"},"Вариант ",-1),io={class:"col-12 d-flex align-items-center"},no={key:0,class:"fw-bold"},ro={key:1,class:"fw-bold"},co={key:6,class:"col-12"},ao={class:"card rounded-0 border-black"},_o={class:"card-body px-2 py-1"},uo=e("label",{class:"font-size-10"},"Вариант ",-1),ho={class:"col-12 d-flex align-items-center"},po={key:0,class:"fw-bold"},mo={key:1,class:"fw-bold"},fo={class:"col-12 d-flex align-items-center"},yo={key:0,class:"fw-bold"},bo={key:1,class:"fw-bold"},vo={class:"col-12 d-flex align-items-center"},ko={key:0,class:"fw-bold"},go={key:1,class:"fw-bold"},wo={class:"col-md-6"},Fo={class:"preview"},$o={class:"card rounded-0 mt-3"},xo={class:"card-body"},Co=e("h6",null,"Характеристики",-1),Po={class:"text-muted font-bold"},Vo={class:"text-black mb-0"},zo={key:0,class:"mr-1"},jo={key:1,class:"mr-1"},To={key:2,class:"mr-1"},Do={key:3,class:"mr-1"},Eo={key:4,class:"mr-1"},Io={key:5,class:"mr-1"},So={key:6,class:"mr-1"},Oo={key:7,class:"mr-1"},Uo={class:"row row-cols-md-2 mt-3"},qo={class:"col mb-2"},Mo={class:"card rounded-0 border-black"},Bo={class:"card-body px-2 py-1"},Lo=e("label",{class:"font-size-10"},"Тип цены ",-1),Ho={key:0,class:"col mb-2"},No={class:"card rounded-0 border-black"},Wo={class:"card-body px-2 py-1"},Ao=e("label",{class:"font-size-10"},"Процент дилера ",-1),Jo={class:"col mb-2"},Ro={class:"card rounded-0 border-black"},Go={class:"card-body px-2 py-1"},Ko=e("label",{class:"font-size-10"},"Кол-во ",-1),Qo={class:"col mb-2"},Xo={class:"card rounded-0 border-black"},Yo={class:"card-body px-2 py-1"},Zo=e("label",{class:"font-size-10"},"Цена ",-1),es={key:1,class:"col d-flex mb-2"},ts=e("i",{class:"fa-solid fa-floppy-disk"},null,-1),os={key:1,class:"card rounded-0 mt-3"},ss={class:"card-body"},ls={class:"table"},is=e("br",null,null,-1),ns={key:0},rs=e("br",null,null,-1),ds={key:1,class:"row"},cs=e("div",{class:"col-12"},[e("div",{class:"d-flex justify-content-center align-items-center flex-column",style:{"min-height":"500px"}},[e("h5",null,"Загружаем страничку...."),e("div",{class:"spinner-border my-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")])])],-1),as=[cs],_s={name:"MyComponent",props:["modelValue","canEdit"],data(){return{loaded:!1,door:null,type_dictionary:{size:"Петли",handle_holes_type:"Отверстие под ручку",opening_type:"Тип открытия двери и толщина",box_and_frame_color:"Цвет короба и каркаса",door_type:"Тип двери",front_side_finish_color:"Цвет отделки внешней стороны",back_side_finish_color:"Цвет отделки внутренней стороны",seal_color:"Цвет уплотнителя",fittings_color:"Цвет фурнитуры",hinge_manufacturer:"Производитель петель",front_side_finish:"Отделка внешней стороны",back_side_finish:"Отделка внутренней стороны",base:"База (под покраску)",service_doorstep:"Работа с порогом",service_painting:"Покраска фурнитуры",service_door_closer:"Работа с доводчиком",service_handle:"Работа с ручками",service_stopper:"Работа со стопором"},tmp_prices:[],need_addition:!0,messages:[],filterHeight:null,filterWidth:null,selectedColorParam:null,loadedParams:!0,confirmModal:null,finishFrontVariantModal:null,finishBackVariantModal:null,colors:[],confirm:{title:null,message:null},color_sync_update:!1}},computed:{...U(["getErrors","getDictionary","cartTotalCount","cartProducts","cartTotalPrice"])},watch:{door:{handler(i){this.$emit("update:modelValue",this.door)},deep:!0}},mounted(){this.door=this.modelValue},methods:{editVariant(){this.$emit("edit")},invertHex(i){if(!i)return"#000000";var t=i.replace(/#/,""),d=parseInt(t.substr(0,2),16),h=parseInt(t.substr(2,2),16),o=parseInt(t.substr(4,2),16),p=(.2126*d+.7152*h+.0722*o)/255;return p>.5?"#000000":"#ffffff"}}},us=Object.assign(_s,{setup(i){return(t,d)=>{var o,p,r,v,P,C,n;const h=H("lazy");return t.door?(s(),l("div",Q,[e("div",X,[e("div",Y,[e("div",Z,[e("button",{disabled:!i.canEdit,onClick:d[0]||(d[0]=(...f)=>t.editVariant&&t.editVariant(...f)),type:"button",class:"btn btn-dark rounded-0 w-100 p-3"},[te,_(" Редактировать ")],8,ee)]),e("div",oe,[e("div",se,[e("div",le,[ie,e("p",null,c(t.door.purpose||"Не указано"),1)])])]),e("div",ne,[e("div",re,[e("div",de,[ce,e("p",{innerHTML:t.door.height},null,8,ae)])])]),e("div",_e,[e("div",ue,[e("div",he,[pe,e("p",{innerHTML:t.door.width},null,8,me)])])]),e("div",fe,[e("div",ye,[e("div",be,[ve,e("p",null,c(t.door.opening_type.title||"-")+" (толщина "+c(t.door.opening_type.depth)+" мм)",1)])])]),e("div",ke,[e("div",ge,[e("div",we,[Fe,e("p",null,c(t.door.door_type.title||"-"),1)])])]),e("div",$e,[e("div",xe,[e("div",Ce,[Pe,e("p",null,c(t.door.hinge_manufacturer.title||"-"),1)])])]),e("div",Ve,[e("div",ze,[e("div",je,[Te,e("p",null,c(((o=t.door.loops)==null?void 0:o.title)||"-"),1)])])]),e("div",De,[e("div",Ee,[e("div",Ie,[Se,e("p",null,c(((p=t.door.front_side_finish)==null?void 0:p.title)||"-"),1)])])]),e("div",Oe,[t.door.front_side_finish.title!=="Под покраску"?(s(),l("div",{key:0,style:z({"background-color":t.door.front_side_finish.code,color:t.invertHex(t.door.front_side_finish.code)}),class:"card rounded-0 border-black"},[e("div",Ue,[qe,e("p",null,c(t.door.front_side_finish.title||"-"),1)])],4)):(s(),l("div",Me,Le))]),e("div",He,[e("div",Ne,[e("div",We,[Ae,e("p",null,c(t.door.back_side_finish.title||"-"),1)])])]),e("div",Je,[t.door.back_side_finish.title!=="Под покраску"?(s(),l("div",{key:0,style:z({"background-color":t.door.back_side_finish.code,color:t.invertHex(t.door.back_side_finish.code)}),class:"card rounded-0 border-black"},[e("div",Re,[Ge,e("p",null,c(t.door.back_side_finish.title||"-"),1)])],4)):(s(),l("div",Ke,Xe))]),e("div",Ye,[e("div",{style:z({"background-color":t.door.box_and_frame_color.code,color:t.invertHex(t.door.box_and_frame_color.code)}),class:"card rounded-0 border-black"},[e("div",Ze,[et,e("p",null,c(t.door.box_and_frame_color.title||"-"),1)])],4)]),e("div",tt,[e("div",{style:z({"background-color":t.door.seal_color.code,color:t.invertHex(t.door.seal_color.code)}),class:"card rounded-0 border-black"},[e("div",ot,[st,e("p",null,c(t.door.seal_color.title||"-"),1)])],4)]),e("div",lt,[e("div",{style:z({"background-color":t.door.fittings_color.code,color:t.invertHex(t.door.fittings_color.code)}),class:"card rounded-0 border-black"},[e("div",it,[nt,e("p",null,c(t.door.fittings_color.title||"-"),1)])],4)]),t.door.fittings_color.title!=null&&t.door.fittings_color.is_ral?(s(),l("div",rt,[e("div",{style:z({"background-color":t.door.service_painting.code,color:t.invertHex(t.door.service_painting.code)}),class:"card rounded-0 border-black"},[e("div",dt,[ct,e("p",null,c(t.door.service_painting.title||"-"),1)])],4)])):a("",!0),e("div",at,[e("div",_t,[e("div",ut,[ht,e("p",null,c(t.door.comment||"-"),1)])])])]),t.need_addition?(s(),l("div",pt,[e("div",mt,[e("p",null,[_(" Ручка: "),t.door.need_handle_holes?(s(),l("span",ft,"нужна")):(s(),l("span",yt,"не нужна"))])]),t.door.need_handle_holes?(s(),l("div",bt,[e("div",vt,[e("div",kt,[gt,e("p",null,c(((r=t.door.handle_holes)==null?void 0:r.title)||"-"),1)])])])):a("",!0),t.door.need_handle_holes?(s(),l("div",wt,[t.door.handle_holes.id===1||t.door.handle_holes.id===2?(s(),l("div",Ft,[e("div",$t,[xt,e("p",null,c(t.door.handle_holes_type.title||"-"),1)])])):a("",!0),t.door.handle_holes.id===2?(s(),l("div",Ct,[e("div",Pt,[Vt,e("p",null,c(t.door.handle_wrapper_type.title||"-"),1)])])):a("",!0)])):a("",!0),(t.door.handle_holes_type.variants||[]).length>0&&t.door.need_handle_holes&&t.door.handle_holes.id!==3?(s(),l("div",zt,[e("div",jt,[e("div",Tt,[e("p",Dt,[_("Цвет ручки "+c(t.door.handle_holes_type.color||"не указан")+" ",1),t.door.handle_holes_type.color?(s(),l("span",{key:0,class:"d-inline-block",style:z([{"background-color":t.door.handle_holes_type.color},{width:"50px",height:"10px"}])},null,4)):a("",!0)])]),(s(!0),l(w,null,S(t.door.handle_holes_type.variants,(f,$)=>(s(),l("div",Et,[e("div",{class:g(["card cursor-pointer",{"border-secondary shadow-lg":f.selected}]),onClick:x=>t.selectSideFinish("handle_holes_type","variants",$)},[k(e("img",St,null,512),[[h,f.image]]),e("div",Ot,[f.title?(s(),l("h6",Ut,c(f.title||"не указано"),1)):a("",!0),f.description?(s(),l("p",qt,c(f.description||"не указано"),1)):a("",!0)])],10,It)]))),256))])])):a("",!0),(t.door.handle_holes_type.variants||[]).length===0&&t.door.need_handle_holes?(s(),l("div",Mt,Lt)):a("",!0),e("div",Ht,[e("p",null,[_(" Верхняя перемычка: "),t.door.need_upper_jumper?(s(),l("span",Nt,"нужна")):(s(),l("span",Wt,"не нужна"))])]),e("div",At,[e("p",null,[_(" Автоматический порог: "),t.door.need_upper_jumper?(s(),l("span",Jt,"нужен")):(s(),l("span",Rt,"не нужен"))])]),t.door.need_automatic_doorstep?(s(),l("div",Gt,[e("div",Kt,[e("div",Qt,[Xt,e("p",null,c(((v=t.door.service_doorstep)==null?void 0:v.title)||"-"),1)])])])):a("",!0),e("div",Yt,[e("p",null,[_(" Скрытый стопор: "),t.door.need_hidden_stopper?(s(),l("span",Zt,"нужен")):(s(),l("span",eo,"не нужен"))])]),t.door.need_hidden_stopper?(s(),l("div",to,[e("div",oo,[e("div",so,[lo,e("p",null,c(((P=t.door.service_stopper)==null?void 0:P.title)||"-"),1)])])])):a("",!0),e("div",io,[e("p",null,[_(" Скрытый доводчик: "),t.door.need_hidden_door_closer?(s(),l("span",no,"нужен")):(s(),l("span",ro,"не нужен"))])]),t.door.need_hidden_door_closer?(s(),l("div",co,[e("div",ao,[e("div",_o,[uo,e("p",null,c(((C=t.door.service_door_closer)==null?void 0:C.title)||"-"),1)])])])):a("",!0),e("div",ho,[e("p",null,[_(" Скрытый плинтус: "),t.door.need_hidden_skirting_board?(s(),l("span",po,"нужен")):(s(),l("span",mo,"не нужен"))])]),e("div",fo,[e("p",null,[_(" Установка двери: "),t.door.need_door_install?(s(),l("span",yo,"нужна")):(s(),l("span",bo,"не нужна"))])]),e("div",vo,[e("p",null,[_(" Упаковка двери: "),t.door.need_wrapper?(s(),l("span",ko,"нужна")):(s(),l("span",go,"не нужна"))])])])):a("",!0)]),e("div",wo,[e("div",Fo,[t.loadedParams?(s(),O(B,{key:0,disabled:!0,modelValue:t.door,"onUpdate:modelValue":d[1]||(d[1]=f=>t.door=f)},null,8,["modelValue"])):a("",!0),e("div",$o,[e("div",xo,[Co,e("h6",Po,c(t.door.door_type.title)+" "+c(t.door.width)+"x"+c(t.door.height)+"x"+c(((n=t.door.opening_type)==null?void 0:n.depth)||0),1),e("h6",Vo,[t.door.box_and_frame_color.title?(s(),l("span",zo,"("+c(t.door.box_and_frame_color.title)+"),",1)):a("",!0),t.door.front_side_finish.title?(s(),l("span",jo,"первая сторона "+c(t.door.front_side_finish.title)+", ",1)):a("",!0),t.door.back_side_finish.title?(s(),l("span",To,"/вторая сторона "+c(t.door.back_side_finish.title)+",",1)):a("",!0),t.door.loops.title?(s(),l("span",Do,"петли "+c(t.door.loops.title),1)):a("",!0),t.door.hinge_manufacturer.title?(s(),l("span",Eo,c(t.door.hinge_manufacturer.title),1)):a("",!0),t.door.fittings_color.title?(s(),l("span",Io,"("+c(t.door.fittings_color.title)+"),",1)):a("",!0),t.door.opening_type.title?(s(),l("span",So,c(t.door.opening_type.title)+",",1)):a("",!0),t.door.handle_holes.title?(s(),l("span",Oo,c(t.door.handle_holes.title),1)):a("",!0)]),e("div",Uo,[e("div",qo,[e("div",Mo,[e("div",Bo,[Lo,e("p",null,c(t.door.price_type.title||"-"),1)])])]),t.door.price_type.id===3?(s(),l("div",Ho,[e("div",No,[e("div",Wo,[Ao,e("p",null,c(t.door.dealer_percent||"0"),1)])])])):a("",!0),e("div",Jo,[e("div",Ro,[e("div",Go,[Ko,e("p",null,c(t.door.count||"0"),1)])])]),e("div",Qo,[e("div",Xo,[e("div",Yo,[Zo,e("p",null,c(t.door.price)+" ₽",1)])])]),i.canEdit?(s(),l("div",es,[e("button",{onClick:d[2]||(d[2]=(...f)=>t.editVariant&&t.editVariant(...f)),type:"button",class:"btn btn-dark rounded-0 w-100"},[ts,_(" Редактировать ")])])):a("",!0)])])]),t.tmp_prices.length>0?(s(),l("div",os,[e("div",ss,[e("table",ls,[e("tbody",null,[(s(!0),l(w,null,S(t.tmp_prices,f=>(s(),l("tr",null,[e("td",null,[_(c(t.type_dictionary[f.type]||f.type)+" ",1),t.door[f.type]?(s(),l(w,{key:0},[is,t.door[f.type].description?(s(),l("small",ns,"("+c(t.door[f.type].description)+")",1)):a("",!0)],64)):a("",!0)]),e("td",null,[_(c(f.price||0)+" руб. ",1),f.full_price?(s(),l(w,{key:0},[rs,e("small",null,"("+c(f.full_price||0)+" руб.)",1)],64)):a("",!0)])]))),256))])])])])):a("",!0)])])])):(s(),l("div",ds,as))}}}),hs={props:["modelValue","doors","order","disabled"],data(){return{discount_text:null,blocks:{install:!0,designer:!0,delivery:!0,develop:!0,price:!0,discount_detailing:!1,price_type_attention:!0},need_promo:!1,flgDays:!0,discount:0,clientForm:null,delivery_services:[]}},mounted(){if(localStorage.getItem("dodoors_cart_checkout_blocks")){const i=JSON.parse(localStorage.getItem("dodoors_cart_checkout_blocks")),t=Object.keys(this.blocks).length||0,d=Object.keys(i).length||0;t===d?this.blocks=i:localStorage.setItem("dodoors_cart_checkout_blocks",JSON.stringify(this.blocks))}this.clientForm=this.modelValue,this.$nextTick(()=>{var i;this.discount=((i=this.clientForm.discount_data)==null?void 0:i.discount_percent)||0}),this.clientForm.summary_price_type||this.getDictionary.price_type_variants.forEach(i=>{i.key==="retail"&&(this.clientForm.summary_price_type=i)}),this.selectPayedPercentType(1),this.loadServicesByType()},computed:{...U(["getErrors","getDictionary"]),designerPrice(){let i=0;return this.doors.forEach(t=>{i+=t.door.base_price||0}),this.clientForm.designer.price=(i*this.clientForm.designer.value/100).toFixed(2),this.clientForm.designer.price},discountPriceAmount(){return Math.round(this.detailingSummaryPrice*this.discount/100)},detailingSummaryPrice(){let i="";const t={size:"Петли",handle_holes_type:"Ручка",handle_wrapper_type:"Завертка",opening_type:"Тип открытия двери и толщина",box_and_frame_color:"Цвет короба и каркаса",door_type:"Тип двери",front_side_finish_color:"Цвет отделки внешней стороны",back_side_finish_color:"Цвет отделки внутренней стороны",seal_color:"Цвет уплотнителя",fittings_color:"Цвет фурнитуры",hinge_manufacturer:"Производитель петель",front_side_finish:"Отделка внешней стороны",back_side_finish:"Отделка внутренней стороны",base:"База (под покраску)",service_doorstep:"Работа с порогом",service_painting:"Покраска фурнитуры",service_door_closer:"Работа с доводчиком",service_handle:"Услуги по монтажу ручки",service_stopper:"Работа со стопором"};let d=0;const h=["size","handle_holes_type","handle_wrapper_type","base"];return(this.doors||[]).length>0&&(this.doors.forEach(o=>{let p=0;i+=`<h6 class='fw-bold my-2' style='font-size: 10px;'>"`+(o.door.purpose||"Дверь")+'" кол-во '+o.count+"ед. </h6>",(o.door.detailing_price||[]).length>0&&(i+="<ul style='font-size:10px;' class='list-group'>",o.door.detailing_price.forEach(r=>{if(h.indexOf(r.type)===-1){let v=r.full_price?r.full_price:r.price;p+=v,i+="<li class='list-group-item'>"+t[r.type]+" <span class='fw-bold'>"+v+" руб</span> </li>"}}),i+="<li class='list-group-item bg-secondary text-white d-flex justify-content-between'><span>Итого за дверь <span class='fw-bold'>"+p+" руб</span></span><span class='fw-bold'>"+p*o.count+" руб (x"+o.count+")</span> </li>",i+="</ul>",d+=p*(o.count||0))}),i+="<h6 class='fw-bold my-2' style='font-size: 10px;'>Скидку считаем от этого значения "+d+" руб</h6>",this.discount_text=i),d},cartTotalCount(){let i=0;return this.doors.forEach(t=>{i+=t.count}),i},cartTotalPrice(){let i=0;return this.doors.forEach(t=>{i+=t.price*t.count}),i},cartProducts(){return this.doors||[]},fullSummaryPrice(){let i=this.clientForm.installation.count===0?(this.order.details||[]).length:this.clientForm.installation.count,t=this.clientForm.installation.recount_type===1?this.clientForm.installation.price*i:this.clientForm.installation.price;return this.cartTotalPrice-this.discountPriceAmount+t+this.clientForm.delivery_price}},watch:{discount:{handler(i){this.modelValue.discount_data={discount_percent:this.discount,discount_amount:this.discountPriceAmount},this.changeDiscount()},deep:!0},blocks:{handler(i){localStorage.setItem("dodoors_cart_checkout_blocks",JSON.stringify(this.blocks))},deep:!0},need_promo:{handler(i){this.need_promo&&(this.discount=0)},deep:!0},"clientForm.dealer_percent":{handler(i){this.recountPrices()},deep:!0},clientForm:{handler(i){!this.clientForm.designer.is_fix&&this.clientForm.designer.value>100&&(this.clientForm.designer.value=30),this.clientForm.price_with_discount=this.cartTotalPrice-this.discountPriceAmount,this.clientForm.detailing_summary_price=this.detailingSummaryPrice,this.clientForm.full_summary_price=this.fullSummaryPrice,this.$emit("update:modelValue",this.clientForm)},deep:!0}},methods:{changeDiscount(){this.clientForm.current_payed=Math.max(0,Math.round(this.fullSummaryPrice*this.clientForm.payed_percent/100))},recountPrices(){const i=this.clientForm.dealer_percent||0,t=this.clientForm.summary_price_type;let d=this.cartProducts;const h=this.getDictionary;let o=0,p=null,r=[];if(!t)return;let v=t.key,P=C=>Math.round(parseInt(C)/10)*10;d.forEach(C=>{var E;const n=C.door;let f=u=>{let y=typeof n.door_type.price=="object"?n.door_type.price[v]:n.door_type.price,m=n.door_type.id!==3?1:.8,b=n.door_type.need_percent_price?u*y/100:u*m+y;return r.push({type:"door_type",price:(b||0)>0?b:u}),(b||0)>0?b:u};Object.keys(n).forEach(u=>{let y=!1;if(u&&typeof n[u]=="object"&&n[u]!=null&&u!=="door_type"){if(u==="opening_type"&&n[u].sizes){y=!0;let m=n[u].sizes.findIndex(V=>V.width==n.width&&V.height==n.height),b=m===-1?0:n[u].sizes[m].price[v];o+=parseInt(b||0),console.log("opening_type",b,u),r.push({type:u,price:b})}if(u.indexOf("_color")!==-1&&n[u].sizes&&!y){y=!0;let m=(n[u]||{excludes:[]}).excludes.indexOf(u.substring(0,u.indexOf("_color")))!==-1,b=0;if(!n[u].assign_with_size)b=m?0:n[u].sizes[0].price[v];else{let V=n[u].sizes.findIndex(I=>I.width==n.width&&I.height==n.height);b=V===-1||m?0:n[u].sizes[V].price[v]}o+=parseInt(b||0),r.push({type:u,price:b})}if(u==="hinge_manufacturer"&&n[u].title!=null&&!y){y=!0;let m=n[u].price[v],b=0;n.size&&(b=n.size.loops.count*m),o+=parseInt(b||0),r.push({type:u,price:m,full_price:b})}if(u==="size"&&n[u].loops.price&&!y){y=!0;let m=n[u].loops.price[v];o+=parseInt(m||0),r.push({type:u,price:m})}if(u==="service_painting"&&n[u].title!=null&&!y){y=!0;let m=n.fittings_color.is_ral?n[u].price[v]:0,b=0;n.size&&(b=(n.size.loops.count+1)*m),o+=b||0,r.push({type:u,price:m,full_price:b})}if(n[u].price&&!y){let m=typeof n[u].price=="object"?n[u].price[v]||0:n[u].price||0;o+=parseInt(m||0),r.push({type:u,price:m})}}});let $=h.prices,x=0,D=!1,j=null;if($.forEach(u=>{u.width===n.width&&u.height===n.height&&(D=!0,j=u)}),D){p=j.materials.find(y=>y.is_base)||{price:{wholesale:0,dealer:0,retail:0,cost:0}};let u=typeof p.price=="object"?p.price[v]:p.price;r.push({type:"base",price:u}),x=parseInt(f(u)),j.materials.forEach(y=>{if(y.id===n.front_side_finish.id&&!n.front_side_finish.is_base){let m=typeof y.price=="object"?y.price[v]:y.price;x+=m,r.push({type:"front_side_finish",price:m})}if(y.id===n.back_side_finish.id&&!n.back_side_finish.is_base){let m=typeof y.price=="object"?y.price[v]:y.price;x+=m,r.push({type:"back_side_finish",price:m})}})}else for(let u=0;u<$.length;u++)if($[u].width>=n.width&&$[u].height>=n.height){p=$[u].materials.find(m=>m.is_base)||{price:{wholesale:0,dealer:0,retail:0,cost:0}};let y=typeof p.price=="object"?p.price[v]:p.price;r.push({type:"base",price:y}),x=parseInt(f(y)),$[u].materials.forEach(m=>{if(m.id===n.front_side_finish.id&&!n.front_side_finish.is_base){let b=typeof m.price=="object"?m.price[v]:m.price;x+=b,r.push({type:"front_side_finish",price:b})}}),$[u].materials.forEach(m=>{if(m.id===n.back_side_finish.id&&!n.back_side_finish.is_base){let b=typeof m.price=="object"?m.price[v]:m.price;x+=b,r.push({type:"back_side_finish",price:b})}});break}n.price=i===0?P(o+x):Math.round((P(o+x)||0)*(1+(i||0)/100)),n.base_price=((E=r.find(u=>u.type==="door_type"))==null?void 0:E.price)||0}),this.$store.dispatch("updateCartItems",d),this.changePayedPercent()},selectPriceType(i){this.clientForm.summary_price_type=i,this.recountPrices(),this.changePayedPercent()},loadServicesByType(){this.$store.dispatch("loadServicesByType",{type:"service_delivery"}).then(i=>{this.delivery_services=i.data||[]}).catch(()=>{})},selectPayedPercentType(i){switch(this.clientForm.payed_percent_type=i,i){case 0:this.clientForm.payed_percent=50;break;default:case 1:this.clientForm.payed_percent=70;break;case 2:this.clientForm.payed_percent=100;break}this.changePayedPercent()},hasRoles(i){let t=!1;return typeof i=="object"?this.$page.props.auth.roles.forEach(d=>{t=t||i.includes(d)}):this.$page.props.auth.roles.includes(i),t},changeCurrentPayed(){this.clientForm.payed_percent=Math.round(this.clientForm.current_payed/this.fullSummaryPrice*100)},changePayedPercent(){this.clientForm.current_payed=Math.round(this.cartTotalPrice*this.clientForm.payed_percent/100),this.changeDiscount()},selectDeliveryVariant(i){var o;this.clientForm.info=i.title,this.clientForm.delivery_service=i.title,this.clientForm.delivery_price=((o=i.price)==null?void 0:o.retail)||0;const t=i.title,d=/г\.\s*([А-Яа-яЁё\- ]+)/,h=t.match(d);h&&(this.clientForm.delivery_city=h[1].trim())},findPromo(){this.discount=0,!((this.clientForm.promo||"").length<=5)&&this.$store.dispatch("findPromoCode",{code:this.clientForm.promo}).then(i=>{this.discount=i.discount||0})}}},ps={class:"font-bold d-flex justify-content-between align-items-center mb-2"},ms={key:0},fs={key:0,class:"fa-regular fa-square-plus"},ys={key:1,class:"fa-regular fa-square-minus"},bs={class:"form-check form-switch my-2"},vs={class:"form-check-label",for:"need_promo_switcher"},ks={class:"form-floating mb-2"},gs=e("label",{for:"checkout-promo"},"Скидка, %",-1),ws={style:{"font-size":"10px","font-style":"italic","text-decoration":"underline"}},Fs={key:0,class:"fa-regular fa-square-plus"},$s={key:1,class:"fa-regular fa-square-minus"},xs=e("p",{class:"alert alert-light mb-2",style:{"font-size":"10px"}},"Внимание! В расчете скидки не участвует фурнитура, ручка (и завертка), доставка и установка",-1),Cs=["innerHTML"],Ps={key:1,class:"form-floating mb-2"},Vs=e("label",{for:"checkout-promo"},"Промокод",-1),zs={key:1},js=e("p",null,[e("small",null,"Начальная внесенная покупателем сумма")],-1),Ts={class:"form-floating mb-2"},Ds=e("label",{for:"checkout-name"},"Начальная сумма, руб",-1),Es=e("p",null,[e("small",null,"Процент внесенной суммы от полной стоимости")],-1),Is={class:"my-2"},Ss={class:"form-floating mb-2"},Os=e("label",{for:"checkout-name"},"%",-1),Us={class:"mb-2 fw-bold d-flex justify-content-between align-items-center"},qs={key:0,class:"fa-regular fa-square-plus"},Ms={key:1,class:"fa-regular fa-square-minus"},Bs={class:"form-check form-switch"},Ls=e("label",{class:"form-check-label",for:"flexSwitchCheckDefault"},"Указать кол-во рабочих дней / Выбрать конкретную дату",-1),Hs={key:0,class:"form-floating mb-2"},Ns=e("label",{for:"checkout-name"},"Кол-во рабочих дней",-1),Ws={key:1,class:"form-floating mb-2"},As=e("label",{for:"checkout-name"},"Срок передачи товара покупателю",-1),Js={class:"mb-2 fw-bold d-flex justify-content-between align-items-center"},Rs={key:0,class:"fa-regular fa-square-plus"},Gs={key:1,class:"fa-regular fa-square-minus"},Ks={class:"my-2"},Qs=e("h6",{class:"mb-2 fw-bold"},"Информация по доставке",-1),Xs={class:"form-floating mb-2"},Ys=e("label",{for:"delivery-price"},"Сумма за доставку",-1),Zs={class:"input-group mb-2"},el={class:"form-floating"},tl=e("label",{for:"delivery-city"},"Город доставки",-1),ol={class:"input-group-text rounded-0 border-secondary"},sl={class:"dropdown"},ll=e("button",{class:"btn btn-light",type:"button",id:"dropdownMenuButton","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-map-location-dot"})],-1),il={class:"dropdown-menu",style:{"max-height":"200px","overflow-y":"scroll"},"aria-labelledby":"dropdownMenuButton"},nl=["onClick"],rl={class:"dropdown-item",href:"javascript:void(0)"},dl={class:"form-floating mb-2"},cl=e("label",{for:"delivery-address"},"Адрес доставки",-1),al={key:0,class:"alert alert-light rounded-0 border-black"},_l=e("i",{class:"fa-solid fa-xmark"},null,-1),ul=e("p",{class:"mb-2"},"Подъем на этаж",-1),hl={class:"my-2"},pl={class:"mb-2 fw-bold d-flex justify-content-between align-items-center"},ml={key:0,class:"fa-regular fa-square-plus"},fl={key:1,class:"fa-regular fa-square-minus"},yl={key:3,class:"my-2"},bl={class:"form-floating mb-2"},vl=e("label",{for:"installation-count"},"Дверей к установке",-1),kl=e("p",{style:{"font-size":"10px"}},"Производить расчет цены",-1),gl={class:"form-floating my-2"},wl={for:"installation-price"},Fl={key:0},$l={key:1},xl={class:"mb-2 fw-bold d-flex justify-content-between align-items-center"},Cl={key:0,class:"fa-regular fa-square-plus"},Pl={key:1,class:"fa-regular fa-square-minus"},Vl={class:"my-2 d-flex justify-content-between align-items-center"},zl={key:0},jl={key:1},Tl={class:"form-floating mb-2"},Dl={for:"installation-count"},El={key:0},Il={key:1},Sl={key:0},Ol={class:"form-floating mb-2"},Ul=e("label",{for:"dealer-percent"},"Процент дилера, %",-1),ql={class:"form-check form-switch"},Ml=e("label",{class:"form-check-label",for:"send_to_bitix"},"Отправить в Битрикс",-1),Bl={class:"form-check form-switch"},Ll=e("label",{class:"form-check-label",for:"send_to_mail"},"Отправить на почту клиента",-1),Hl={class:"form-check form-switch"},Nl=e("label",{class:"form-check-label",for:"send_to_telegram"},"Отправить в телеграм",-1),Wl={class:"form-check form-switch mb-2"},Al=e("label",{class:"form-check-label",for:"send_to_self_mail"},"Отправить себе на почту",-1),Jl={key:7,class:"form-floating mb-2"},Rl=e("label",{for:"self_email_address"},"Почта",-1),Gl={key:8,class:"alert alert-light rounded-0 mb-2"},Kl=e("strong",{class:"fw-bold"},"Внимание!",-1),Ql={class:"alert alert-light"},Xl={class:"d-flex justify-content-between"},Yl={class:"d-flex justify-content-between"},Zl={class:"d-flex justify-content-between"},ei={key:0,class:"d-flex justify-content-between"},ti={key:0},oi={key:1},si={key:1,class:"d-flex justify-content-between"},li={class:"d-flex justify-content-between fw-bold"},ii={class:"d-flex justify-content-between"},ni={class:"fw-bold"},ri={class:"btn-group w-100 mb-2"},di=["disabled"],ci=["disabled"];function ai(i,t,d,h,o,p){return o.clientForm?(s(),l(w,{key:0},[e("h6",ps,[e("span",null,[_(" Итого цена "+c(p.cartTotalPrice-p.discountPriceAmount)+" ₽ ",1),o.discount>0?(s(),l("span",ms,"(скидка "+c(o.discount)+"%)",1)):a("",!0)]),e("span",{onClick:t[0]||(t[0]=r=>o.blocks.price=!o.blocks.price)},[o.blocks.price?(s(),l("i",ys)):(s(),l("i",fs))])]),o.blocks.price?(s(),l(w,{key:0},[e("div",bs,[e("label",vs,[e("span",{class:g({"fw-bold":!o.need_promo})},"скидка",2),_(" \\ "),e("span",{class:g({"fw-bold":o.need_promo})},"промокод",2)]),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>o.need_promo=r),class:"form-check-input",type:"checkbox",role:"switch",id:"need_promo_switcher"},null,512),[[T,o.need_promo]])]),o.need_promo?a("",!0):(s(),l(w,{key:0},[e("div",ks,[k(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=r=>o.discount=r),id:"checkout-promo",placeholder:"name@example.com"},null,512),[[F,o.discount]]),gs]),e("p",ws,[_(" Ознакомиться с расчетом скидки "),e("span",{onClick:t[3]||(t[3]=r=>o.blocks.discount_detailing=!o.blocks.discount_detailing)},[o.blocks.discount_detailing?(s(),l("i",$s)):(s(),l("i",Fs))])]),o.blocks.discount_detailing?(s(),l(w,{key:0},[xs,o.discount_text?(s(),l("p",{key:0,innerHTML:o.discount_text},null,8,Cs)):a("",!0)],64)):a("",!0)],64)),o.need_promo?(s(),l("div",Ps,[k(e("input",{type:"text",class:"form-control",onKeyup:t[4]||(t[4]=(...r)=>p.findPromo&&p.findPromo(...r)),"onUpdate:modelValue":t[5]||(t[5]=r=>o.clientForm.promo=r),id:"checkout-promo",placeholder:"name@example.com"},null,544),[[F,o.clientForm.promo]]),Vs])):a("",!0)],64)):a("",!0),p.hasRoles(["manager","administrator"])?(s(),l("div",zs,[o.blocks.price?(s(),l(w,{key:0},[js,e("div",Ts,[k(e("input",{type:"text",class:"form-control",onChange:t[6]||(t[6]=(...r)=>p.changeCurrentPayed&&p.changeCurrentPayed(...r)),"onUpdate:modelValue":t[7]||(t[7]=r=>o.clientForm.current_payed=r),id:"checkout-name",placeholder:"",required:""},null,544),[[F,o.clientForm.current_payed]]),Ds]),Es,e("p",Is,[e("span",{onClick:t[8]||(t[8]=r=>p.selectPayedPercentType(0)),class:g([{"btn-dark text-white":o.clientForm.payed_percent_type===0},"btn btn-outline-secondary text-black rounded-0 mr-2"]),style:{"font-size":"10px"}},"50\\50",2),e("span",{onClick:t[9]||(t[9]=r=>p.selectPayedPercentType(1)),class:g([{"btn-dark text-white":o.clientForm.payed_percent_type===1},"btn btn-outline-secondary text-black rounded-0 mr-2"]),style:{"font-size":"10px"}},"70\\30",2),e("span",{onClick:t[10]||(t[10]=r=>p.selectPayedPercentType(2)),class:g([{"btn-dark text-white":o.clientForm.payed_percent_type===2},"btn btn-outline-secondary text-black rounded-0 mr-2"]),style:{"font-size":"10px"}},"100% предоплата",2)]),e("div",Ss,[k(e("input",{type:"text",class:"form-control",onChange:t[11]||(t[11]=(...r)=>p.changePayedPercent&&p.changePayedPercent(...r)),"onUpdate:modelValue":t[12]||(t[12]=r=>o.clientForm.payed_percent=r),id:"checkout-name",placeholder:"name@example.com",required:""},null,544),[[F,o.clientForm.payed_percent]]),Os])],64)):a("",!0),e("h6",Us,[_("Срок изготовления "),e("span",{onClick:t[13]||(t[13]=r=>o.blocks.develop=!o.blocks.develop)},[o.blocks.develop?(s(),l("i",Ms)):(s(),l("i",qs))])]),o.blocks.develop?(s(),l(w,{key:1},[e("div",Bs,[k(e("input",{onClick:t[14]||(t[14]=r=>o.flgDays=!o.flgDays),"onUpdate:modelValue":t[15]||(t[15]=r=>o.flgDays=r),class:"form-check-input",type:"checkbox",role:"switch",id:""},null,512),[[T,o.flgDays]]),Ls]),o.flgDays?(s(),l("div",Hs,[k(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[16]||(t[16]=r=>o.clientForm.work_days=r),id:"checkout-name",placeholder:"name@example.com",required:""},null,512),[[F,o.clientForm.work_days]]),Ns])):(s(),l("div",Ws,[k(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[17]||(t[17]=r=>o.clientForm.delivery_terms=r),id:"checkout-name",placeholder:"name@example.com",required:""},null,512),[[F,o.clientForm.delivery_terms]]),As]))],64)):a("",!0),e("h6",Js,[_("Доставка "),e("span",{onClick:t[18]||(t[18]=r=>o.blocks.delivery=!o.blocks.delivery)},[o.blocks.delivery?(s(),l("i",Gs)):(s(),l("i",Rs))])]),o.blocks.delivery?(s(),l(w,{key:2},[e("div",Ks,[e("button",{type:"button",onClick:t[19]||(t[19]=r=>o.clientForm.delivery_type=0),class:g([{"btn-dark text-white":o.clientForm.delivery_type===0},"btn btn-outline-secondary text-black rounded-0 mr-2 mb-2"])},"Доставка до адреса ",2),e("button",{type:"button",onClick:t[20]||(t[20]=r=>o.clientForm.delivery_type=1),class:g([{"btn-dark text-white":o.clientForm.delivery_type===1},"btn btn-outline-secondary text-black rounded-0 mr-2 mb-2"])},"Самовывоз ",2),e("button",{type:"button",onClick:t[21]||(t[21]=r=>o.clientForm.delivery_type=2),class:g([{"btn-dark text-white":o.clientForm.delivery_type===2},"btn btn-outline-secondary text-black rounded-0 mr-2 mb-2"])},"ТК ",2),e("button",{type:"button",onClick:t[22]||(t[22]=r=>o.clientForm.delivery_type=3),class:g([{"btn-dark text-white":o.clientForm.delivery_type===3},"btn btn-outline-secondary text-black rounded-0 mr-2 mb-2"])},"Доставка до проходной ",2)]),o.clientForm.delivery_type===0?(s(),l(w,{key:0},[Qs,e("div",Xs,[k(e("input",{type:"number",min:"0",class:"form-control","onUpdate:modelValue":t[23]||(t[23]=r=>o.clientForm.delivery_price=r),id:"delivery-price",placeholder:"name@example.com",required:""},null,512),[[F,o.clientForm.delivery_price]]),Ys]),e("div",Zs,[e("div",el,[k(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[24]||(t[24]=r=>o.clientForm.delivery_city=r),id:"delivery-city",placeholder:"name@example.com"},null,512),[[F,o.clientForm.delivery_city]]),tl]),e("span",ol,[e("div",sl,[ll,e("ul",il,[(s(!0),l(w,null,S(o.delivery_services,r=>(s(),l("li",{onClick:v=>p.selectDeliveryVariant(r)},[e("a",rl,c(r.title||"-"),1)],8,nl))),256))])])])]),e("div",dl,[k(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[25]||(t[25]=r=>o.clientForm.delivery_address=r),id:"delivery-address",placeholder:"name@example.com"},null,512),[[F,o.clientForm.delivery_address]]),cl]),o.clientForm.delivery_service?(s(),l("p",al,[e("span",null,c(o.clientForm.delivery_service),1),e("a",{href:"javascript:void(0)",class:"d-block p-0 m-0 text-danger",style:{"font-size":"10px"},onClick:t[26]||(t[26]=r=>o.clientForm.delivery_service=null)},[_l,_(" убрать сервис")])])):a("",!0),ul,e("div",hl,[e("button",{type:"button",onClick:t[27]||(t[27]=r=>o.clientForm.ascent_floor=!0),class:g([{"btn-dark text-white":o.clientForm.ascent_floor===!0},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"Нужен ",2),e("button",{type:"button",onClick:t[28]||(t[28]=r=>o.clientForm.ascent_floor=!1),class:g([{"btn-dark text-white":o.clientForm.ascent_floor===!1},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"Не нужен ",2)])],64)):a("",!0)],64)):a("",!0),e("h6",pl,[_("Установка "),e("span",{onClick:t[29]||(t[29]=r=>o.blocks.install=!o.blocks.install)},[o.blocks.install?(s(),l("i",fl)):(s(),l("i",ml))])]),o.blocks.install?(s(),l("div",yl,[e("button",{type:"button",onClick:t[30]||(t[30]=r=>o.clientForm.installation.need_door_install=!0),class:g([{"btn-dark text-white":o.clientForm.installation.need_door_install===!0},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"Нужна ",2),e("button",{type:"button",onClick:t[31]||(t[31]=r=>o.clientForm.installation.need_door_install=!1),class:g([{"btn-dark text-white":o.clientForm.installation.need_door_install===!1},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"Не нужна ",2)])):a("",!0),o.clientForm.installation.need_door_install?(s(),l(w,{key:4},[e("div",bl,[k(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[32]||(t[32]=r=>o.clientForm.installation.count=r),id:"installation-count",placeholder:"name@example.com"},null,512),[[F,o.clientForm.installation.count]]),vl]),kl,e("button",{type:"button",onClick:t[33]||(t[33]=r=>o.clientForm.installation.recount_type=0),style:{"font-size":"10px"},class:g([{"btn-dark text-white":o.clientForm.installation.recount_type===0},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"Суммарно ",2),e("button",{type:"button",style:{"font-size":"10px"},onClick:t[34]||(t[34]=r=>o.clientForm.installation.recount_type=1),class:g([{"btn-dark text-white":o.clientForm.installation.recount_type===1},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"За единицу ",2),e("div",gl,[k(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[35]||(t[35]=r=>o.clientForm.installation.price=r),id:"installation-price",placeholder:"name@example.com"},null,512),[[F,o.clientForm.installation.price]]),e("label",wl,[_("Цена за установку, руб "),o.clientForm.installation.recount_type===1?(s(),l("span",Fl,"(за единицу)")):a("",!0),o.clientForm.installation.recount_type===0?(s(),l("span",$l,"(суммарно)")):a("",!0)])])],64)):a("",!0),e("h6",xl,[_("Работа дизайнера "),e("span",{onClick:t[36]||(t[36]=r=>o.blocks.designer=!o.blocks.designer)},[o.blocks.designer?(s(),l("i",Pl)):(s(),l("i",Cl))])]),o.blocks.designer?(s(),l(w,{key:5},[e("div",Vl,[e("div",null,[e("button",{type:"button",onClick:t[37]||(t[37]=r=>o.clientForm.designer.is_fix=!0),class:g([{"btn-dark text-white":o.clientForm.designer.is_fix===!0},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"Фикс ",2),e("button",{type:"button",onClick:t[38]||(t[38]=r=>o.clientForm.designer.is_fix=!1),class:g([{"btn-dark text-white":o.clientForm.designer.is_fix===!1},"btn btn-outline-secondary text-black rounded-0 mr-2"])},"Процент ",2)]),o.clientForm.designer.is_fix?a("",!0):(s(),l("span",zl,c(p.designerPrice)+" руб",1)),o.clientForm.designer.is_fix?(s(),l("span",jl,c(o.clientForm.designer.value)+" руб",1)):a("",!0)]),e("div",Tl,[k(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[39]||(t[39]=r=>o.clientForm.designer.value=r),id:"designer-value",placeholder:"name@example.com"},null,512),[[F,o.clientForm.designer.value]]),e("label",Dl,[o.clientForm.designer.is_fix?(s(),l("span",El,"Фиксированная оплата, руб")):a("",!0),o.clientForm.designer.is_fix?a("",!0):(s(),l("span",Il,"Процент за работу, %"))])])],64)):a("",!0),N(i.$slots,"loader"),o.clientForm.summary_price_type?(s(),l(w,{key:6},[o.clientForm.summary_price_type.id===3?(s(),l("div",Sl,[e("div",Ol,[k(e("input",{type:"number",min:"0",max:"100","onUpdate:modelValue":t[40]||(t[40]=r=>o.clientForm.dealer_percent=r),class:"form-control text-left",id:"dealer-percent",required:""},null,512),[[F,o.clientForm.dealer_percent]]),Ul])])):a("",!0)],64)):a("",!0),e("div",ql,[k(e("input",{"onUpdate:modelValue":t[41]||(t[41]=r=>d.modelValue.send_to_bitrix=r),class:"form-check-input",type:"checkbox",role:"switch",id:"send_to_bitix"},null,512),[[T,d.modelValue.send_to_bitrix]]),Ml]),e("div",Bl,[k(e("input",{class:"form-check-input","onUpdate:modelValue":t[42]||(t[42]=r=>d.modelValue.send_to_mail=r),type:"checkbox",role:"switch",id:"send_to_mail"},null,512),[[T,d.modelValue.send_to_mail]]),Ll]),e("div",Hl,[k(e("input",{class:"form-check-input","onUpdate:modelValue":t[43]||(t[43]=r=>d.modelValue.send_to_telegram=r),type:"checkbox",role:"switch",id:"send_to_telegram"},null,512),[[T,d.modelValue.send_to_telegram]]),Nl]),e("div",Wl,[k(e("input",{class:"form-check-input","onUpdate:modelValue":t[44]||(t[44]=r=>d.modelValue.send_to_self_mail=r),type:"checkbox",role:"switch",id:"send_to_self_mail"},null,512),[[T,d.modelValue.send_to_self_mail]]),Al]),d.modelValue.send_to_self_mail?(s(),l("div",Jl,[k(e("input",{type:"email","onUpdate:modelValue":t[45]||(t[45]=r=>d.modelValue.self_email=r),class:"form-control",id:"self_email_address",placeholder:"name@example.com",required:""},null,512),[[F,d.modelValue.self_email]]),Rl])):a("",!0),o.blocks.price_type_attention?(s(),l("p",Gl,[Kl,_(" При смене типа цены будет проведен перерасчет всех цен на двери и изменены значения начальной внесенной суммы для покупателя "),e("a",{onClick:t[46]||(t[46]=r=>o.blocks.price_type_attention=!1),style:{"font-size":"10px"},class:"d-block text-danger",href:"javascript:void(0)"},"Скрыть и больше не показывать")])):a("",!0),e("div",Ql,[e("p",Xl,[_("Цена без скидки "),e("span",null,c(p.cartTotalPrice)+" руб.",1)]),e("p",Yl,[_("Сумма скидки"),e("span",null,c(p.discountPriceAmount)+" руб. ("+c(o.discount)+"%)",1)]),e("p",Zl,[_("Цена со скидкой "),e("span",null,c(p.cartTotalPrice-p.discountPriceAmount)+" руб. ",1)]),o.clientForm.installation.price>0?(s(),l("p",ei,[_("Цена установки "),o.clientForm.installation.recount_type===0?(s(),l("span",ti,c(o.clientForm.installation.price)+" руб.",1)):a("",!0),o.clientForm.installation.recount_type===1?(s(),l("span",oi,c(o.clientForm.installation.price*(o.clientForm.installation.count===0?p.cartTotalCount:o.clientForm.installation.count))+" руб.",1)):a("",!0)])):a("",!0),o.clientForm.delivery_price>0?(s(),l("p",si,[_("Цена доставки "),e("span",null,c(o.clientForm.delivery_price)+" руб.",1)])):a("",!0),e("p",li,[_("Итого "),e("span",null,c(p.fullSummaryPrice)+" руб.",1)]),e("p",ii,[_("Клиент должен внести "),e("span",ni,c(o.clientForm.current_payed)+"руб. ("+c(o.clientForm.payed_percent)+"%)",1)])]),e("div",ri,[e("button",{type:"submit",disabled:d.disabled,class:"btn btn-dark rounded-0 p-3"},"Отправить ",8,di)])])):(s(),l("button",{key:2,disabled:d.disabled,class:"btn btn-dark w-100 my-2 rounded-0 p-3"},"Отправить ",8,ci))],64)):a("",!0)}const _i=G(hs,[["render",ai]]),ui=e("div",{class:"alert alert-danger"}," Внимание! Редактирование заказа на текущий момент на стадии доработки! ",-1),hi={class:"form-floating mb-2"},pi=e("label",{for:"contractNumber"},"Номер договора",-1),mi={class:"input-group mb-2"},fi={class:"form-floating"},yi=e("label",{for:"checkout-name"},"Название компании\\Ф.И.О. ИП",-1),bi={key:0,class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},vi=e("i",{class:"fa-solid fa-up-right-and-down-left-from-center"},null,-1),ki=[vi],gi={style:{"overflow-y":"scroll",height:"400px",width:"100%"},class:"dropdown-menu dropdown-menu-end rounded-0"},wi=e("i",{class:"fa-solid fa-ban"},null,-1),Fi=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),$i=e("i",{class:"fa-solid fa-plus"},null,-1),xi=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),Ci={class:"p-2"},Pi={class:"form-floating mb-3"},Vi={for:"floatingInput"},zi=["onClick"],ji=e("br",null,null,-1),Ti={class:"badge rounded-0 btn-dark",style:{"font-size":"8px"}},Di=["href"],Ei={key:0,class:"d-flex justify-content-center my-3"},Ii=e("div",{class:"spinner-border text-primary mx-2",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),Si={key:1,class:"card rounded-0"},Oi=e("div",{class:"card-body"},[e("p",null,"Вы должны добавить в корзину хотя бы одно изделие")],-1),Ui=[Oi],qi={props:["type","action","doors","order"],directives:{mask:K.mask},computed:{...U(["getErrors","getDictionary"]),filteredClients(){if(!this.search)return this.self_clients||[];const i=this.search.toLowerCase();return this.self_clients.filter(t=>(t.title||"").toLowerCase().includes(i)||(t.fio||"").toLowerCase().includes(i))}},watch:{},data(){return{edit_requisites:!1,search:null,tab:0,timer:null,step:0,editor_modal:null,self_clients:[],clientForm:{id:null,send_to_bitrix:!0,send_to_mail:!1,send_to_telegram:!0,send_to_self_mail:!1,self_email:null,name:null,phone:null,email:null,info:null,promo:null,contract_number:null,dealer_percent:0,summary_price_type:null,work_with_nds:1,items:[],current_payed:0,payed_percent:70,payed_percent_type:1,delivery_terms:null,ascent_floor:!1,work_days:0,installation:{need_door_install:!1,count:0,price:0,recount_type:0},designer:{is_fix:!1,value:0,price:0},passport:null,passport_issued:null,need_delivery:!1,delivery_type:1,delivery_address:null,delivery_price:null,delivery_city:null,delivery_service:null,discount_data:null}}},mounted(){var i,t,d,h,o,p,r,v,P,C,n,f,$,x,D,j,E,u,y,m,b,V,I,q;this.loadSelfClients(),console.log("ordddddder=>",this.order),console.log("doooors=>",this.doors),this.clientForm.id=this.order.id,this.clientForm.contract_number=this.order.contract_number||this.order.id,this.clientForm.name=this.order.contact_person||null,this.clientForm.phone=((i=this.order.client)==null?void 0:i.phone)||null,this.clientForm.email=((t=this.order.client)==null?void 0:t.email)||null,this.clientForm.work_with_nds=this.order.organizational_form==="individual"?0:1,this.clientForm.info=this.order.info||null,this.clientForm.promo=this.order.promo||null,this.clientForm.dealer_percent=this.order.dealer_percent||0,this.clientForm.summary_price_type=this.order.summary_price_type||null,this.clientForm.items=this.order.items||[],this.clientForm.current_payed=this.order.current_payed||0,this.clientForm.payed_percent=this.order.payed_percent??70,this.clientForm.payed_percent_type=this.order.payed_percent_type??1,this.clientForm.delivery_terms=this.order.delivery_terms||null,this.clientForm.ascent_floor=!!this.order.ascent_floor,this.clientForm.work_days=this.order.work_days||0,this.clientForm.installation={need_door_install:!!((h=(d=this.order.config)==null?void 0:d.installation)!=null&&h.need_door_install),count:((p=(o=this.order.config)==null?void 0:o.installation)==null?void 0:p.count)||0,price:((v=(r=this.order.config)==null?void 0:r.installation)==null?void 0:v.price)||0,recount_type:((C=(P=this.order.config)==null?void 0:P.installation)==null?void 0:C.recount_type)||0},this.clientForm.designer={is_fix:!!((f=(n=this.order.config)==null?void 0:n.designer)!=null&&f.is_fix),value:((x=($=this.order.config)==null?void 0:$.designer)==null?void 0:x.value)||0,price:((j=(D=this.order.config)==null?void 0:D.designer)==null?void 0:j.price)||0},this.clientForm.passport=((E=this.order.client)==null?void 0:E.passport)||null,this.clientForm.passport_issued=((u=this.order.client)==null?void 0:u.passport_issued)||null,this.clientForm.delivery_type=((y=this.order.config)==null?void 0:y.delivery_type)??1,this.clientForm.delivery_address=((m=this.order.config)==null?void 0:m.delivery_address)||null,this.clientForm.delivery_price=((b=this.order.config)==null?void 0:b.delivery_price)||null,this.clientForm.delivery_city=((V=this.order.config)==null?void 0:V.delivery_city)||null,this.clientForm.delivery_service=this.order.delivery_service||null,this.clientForm.discount_data={discount_value:((I=this.order.discount)==null?void 0:I.amount)||0,discount_percent:((q=this.order.discount)==null?void 0:q.percent)||0}},methods:{showEditorForm(){window.location.href="/clients"},selectItem(){},back(){this.$emit("callback")},preparedLawStatus(i){let d=(this.getDictionary.statuses||[]).find(h=>h.value===i)||null;return d?d.title:null},selectInfo(i){if(i==null){this.clientForm.id=null,this.clientForm.name=null,this.clientForm.email=null,this.clientForm.phone=null,this.clientForm.pasport=null,this.clientForm.pasport_issued=null,this.clientForm.fact_address=null;return}this.clientForm.id=i.id||null,this.clientForm.name=i.title||null,this.clientForm.email=i.email||null,this.clientForm.phone=i.phone||null,this.clientForm.delivery_address=i.fact_address||null,this.clientForm.pasport=i.pasport||null,this.clientForm.pasport_issued=i.pasport_issued||null},findPromo(){this.discount=0,!((this.clientForm.promo||"").length<=5)&&this.$store.dispatch("findPromoCode",{code:this.clientForm.promo}).then(i=>{this.discount=i.discount||0})},loadSelfClients(){this.$store.dispatch("loadSelfClients").then(i=>{this.self_clients=i.data||[]}).catch(()=>{})},submit(){this.timer=0;let i=setInterval(()=>{this.timer++},1e3);this.clientForm.items=this.doors;let t=new FormData;Object.keys(this.clientForm).forEach(d=>{const h=this.clientForm[d]||"";typeof h=="object"?t.append(d,JSON.stringify(h)):t.append(d,h)}),t.append("items",JSON.stringify(this.doors)),this.$store.dispatch("editOrder",{clientForm:t}).then(d=>{clearInterval(i),this.timer=null,this.step=0,this.tab=0,this.$notify({title:"DoDoors",text:"Заказ передан менеджеру!",type:"success"}),this.loadSelfClients()}).catch(d=>{clearInterval(i),this.timer=null,this.$notify({title:"DoDoors",text:"Ошибочка...",type:"error"})})}}},Mi=Object.assign(qi,{__name:"CheckoutFormEditor",setup(i){return(t,d)=>(i.doors||[]).length>0?(s(),l("form",{key:0,onSubmit:d[8]||(d[8]=A((...h)=>t.submit&&t.submit(...h),["prevent"]))},[ui,e("div",hi,[k(e("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=h=>t.clientForm.contract_number=h),class:"form-control",id:"contractNumber",required:"",placeholder:"Введите номер договора"},null,512),[[F,t.clientForm.contract_number]]),pi]),e("div",mi,[e("div",fi,[k(e("input",{type:"text",class:"form-control","onUpdate:modelValue":d[1]||(d[1]=h=>t.clientForm.name=h),id:"checkout-name",placeholder:"name@example.com",required:""},null,512),[[F,t.clientForm.name]]),yi]),t.self_clients.length>0?(s(),l("button",bi,ki)):a("",!0),e("ul",gi,[e("li",null,[e("a",{class:"dropdown-item",onClick:d[2]||(d[2]=h=>t.selectInfo(null)),href:"javascript:void(0)"},[wi,_(" Не выбрано")])]),Fi,e("li",null,[e("a",{class:"dropdown-item",onClick:d[3]||(d[3]=(...h)=>t.showEditorForm&&t.showEditorForm(...h)),href:"javascript:void(0)"},[$i,_(" Создать нового")])]),xi,e("li",null,[e("div",Ci,[e("div",Pi,[k(e("input",{type:"search","onUpdate:modelValue":d[4]||(d[4]=h=>t.search=h),class:"form-control",id:"floatingInput",placeholder:"Имя"},null,512),[[F,t.search]]),e("label",Vi,"Поиск (найдено "+c(t.filteredClients.length||0)+" клиентов) ",1)])]),(s(!0),l(w,null,S(t.filteredClients,(h,o)=>(s(),l("a",{class:g([{"btn-light":o%2===0},"p-2 d-block btn rounded-0"]),style:{"word-wrap":"break-word","overflow-wrap":"break-word"},href:"javascript:void(0)",onClick:p=>t.selectInfo(h)},[_(c(h.title||h.phone)+" ",1),ji,e("span",Ti,c(t.preparedLawStatus(h.status)||"Не указан"),1)],10,zi))),256))])])]),t.clientForm.id?(s(),l("a",{key:0,class:"btn btn-link mb-2 p-0",href:"/client/"+t.clientForm.id,target:"_blank"},"Редактировать клиента",8,Di)):a("",!0),(i.type||0)===0?(s(),O(J,{key:1,modelValue:t.clientForm,"onUpdate:modelValue":d[5]||(d[5]=h=>t.clientForm=h)},null,8,["modelValue"])):a("",!0),(i.type||0)===1?(s(),O(R,{key:2,modelValue:t.clientForm,"onUpdate:modelValue":d[6]||(d[6]=h=>t.clientForm=h)},null,8,["modelValue"])):a("",!0),M(_i,{disabled:t.timer,doors:i.doors,order:i.order,modelValue:t.clientForm,"onUpdate:modelValue":d[7]||(d[7]=h=>t.clientForm=h)},{loader:W(()=>[t.timer?(s(),l("div",Ei,[Ii,_(" Отправляем... ")])):a("",!0)]),_:1},8,["disabled","doors","order","modelValue"])],32)):(s(),l("div",Si,Ui))}}),Bi={class:"row"},Li={class:"col-12 mb-2 d-flex align-items-center"},Hi={class:"d-flex justify-content-between w-100 align-items-center"},Ni={class:"d-flex"},Wi={class:"btn-group"},Ai=["disabled"],Ji=e("i",{class:"fa-regular fa-square-caret-left"},null,-1),Ri=[Ji],Gi={class:"btn rounded-0"},Ki=["disabled"],Qi=e("i",{class:"fa-regular fa-square-caret-right"},null,-1),Xi=[Qi],Yi=e("button",{class:"btn btn-dark rounded-0 ml-2",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasWithBothOptions","aria-controls":"offcanvasWithBothOptions"},[e("i",{class:"fa-solid fa-arrow-up-right-from-square"}),_(" Список дверей в заказе ")],-1),Zi={class:"d-flex align-items-center"},en={class:"fw-bold"},tn={class:"dropdown"},on=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),sn={class:"dropdown-menu"},ln=e("i",{class:"fa-solid fa-paper-plane mr-2"},null,-1),nn=e("i",{class:"fa-solid fa-square-arrow-up-right mr-2"},null,-1),rn=e("i",{class:"fa-solid fa-envelope mr-2"},null,-1),dn=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),cn=["href"],an=e("i",{class:"fa-regular fa-file-excel mr-2"},null,-1),_n=["href"],un=e("i",{class:"fa-solid fa-file-signature mr-2"},null,-1),hn=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),pn=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),mn={key:0,class:"row"},fn={class:"col-lg-12"},yn={key:1,class:"row"},bn={class:"col-lg-12"},vn={class:"offcanvas offcanvas-end","data-bs-scroll":"true",tabindex:"-1",id:"offcanvasWithBothOptions","aria-labelledby":"offcanvasWithBothOptionsLabel"},kn={class:"offcanvas-header"},gn={key:0,class:"offcanvas-title fw-bold",id:"offcanvasWithBothOptionsLabel"},wn={key:1,class:"offcanvas-title fw-bold",id:"offcanvasWithBothOptionsLabel"},Fn=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1),$n={key:0,class:"offcanvas-body"},xn=["onClick"],Cn={class:"card-body"},Pn={class:"text-muted font-bold"},Vn={class:"text-black mb-0"},zn={key:0},jn={key:1,class:"ml-1"},Tn={key:2,class:"ml-1"},Dn={key:3},En={key:4,class:"ml-1"},In={key:5,class:"ml-1"},Sn={key:6,class:"ml-1"},On={key:7,class:"ml-1"},Un={key:8,class:"ml-1"},qn={key:9,class:"ml-1"},Mn={key:10,class:"ml-1"},Bn={key:11,class:"ml-1"},Ln={key:12,class:"ml-1"},Hn={key:13,class:"ml-1"},Nn={key:14,class:"ml-1"},Wn={key:15,class:"ml-1"},An={key:16,class:"ml-1"},Jn={key:0,class:"card rounded-0"},Rn={class:"card-body"},Gn=e("h6",{class:"fw-bold mb-2"},"Сводная информация по заказу",-1),Kn={class:"d-flex justify-content-between"},Qn={class:"fw-bold"},Xn={class:"d-flex justify-content-between"},Yn={class:"fw-bold"},Zn={class:"d-flex justify-content-between"},er={class:"fw-bold"},tr={class:"d-flex justify-content-between"},or={key:0,class:"fw-bold"},sr={key:1,class:"fw-bold"},lr={class:"d-flex justify-content-between"},ir={class:"fw-bold"},nr={class:"d-flex justify-content-between"},rr={class:"fw-bold"},dr={class:"d-flex justify-content-between"},cr={class:"fw-bold"},ar={class:"d-flex justify-content-between"},_r={class:"fw-bold"},ur={class:"d-flex justify-content-between mt-3 fw-bold"},hr={class:"d-flex justify-content-between fw-bold"},pr={key:1,class:"card rounded-0"},mr=e("div",{class:"card-body d-flex flex-column align-items-center"},[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")]),e("p",null,"Обновляем информацию о заказе...")],-1),fr=[mr],yr={class:"offcanvas-body p-3"},br={class:"offcanvas-footer p-3"},vr={key:2,class:"offcanvas-footer p-3"},kr={key:1,class:"alert alert-dark"},gr={props:["doors","order","canEdit"],name:"MyComponent",data(){return{loading:!1,tab:0,cart_tab:0,timer:null,selected_index:0,formData:{contract_number:null,work_with_nds:null}}},computed:{...U(["getErrors"]),summary(){var t,d;let i=this.order;return i.total_price+(((t=i.config)==null?void 0:t.delivery_price)||0)+(((d=i.config)==null?void 0:d.install_price)||0)},summaryWithDiscount(){var i;return this.summary-(((i=this.order.discount)==null?void 0:i.amount)||0)}},mounted(){this.formData.contract_number=this.order.contract_number||null},methods:{sendOrder(i=!1,t=!1,d=!1){this.$store.dispatch("sendOrderToBitrix",{order_id:this.order.id,send_to_telegram:t,send_to_email:i,send_to_bitrix:d}).then(()=>{this.$notify({title:"DoDoors",text:"Информация успешно отправлена",type:"success"})}).catch(()=>{this.$notify({title:"DoDoors",text:"Ошибка отправки информации ",type:"error"})})},sendToBitrix(){this.sendOrder(!1,!1,!0)},sendToTelegram(){this.sendOrder(!1,!0,!1)},sendToEmail(){this.sendOrder(!0,!1,!1)},removeItem(){this.$store.dispatch("removeOrder",{orderId:this.order.id}).then(()=>{}).catch(()=>{})},nextDoor(i){i===1&&this.selected_index>0&&this.selected_index--,i===1&&this.selected_index===0&&(this.selected_index=this.doors.length-1),i===0&&this.selected_index<this.doors.length-1&&this.selected_index++,i===0&&this.selected_index===this.doors.length-1&&(this.selected_index=0),this.loading=!0,this.$nextTick(()=>{this.loading=!1})},submit(){this.timer=0;let i=setInterval(()=>{this.timer++},1e3);this.formData.id=this.order.id;let t=new FormData;Object.keys(this.formData).forEach(d=>{const h=this.formData[d]||"";typeof h=="object"?t.append(d,JSON.stringify(h)):t.append(d,h)}),this.$store.dispatch("contractProcessing",{processingForm:t}).then(d=>{clearInterval(i),this.timer=null,this.$notify({title:"DoDoors",text:"Номер договора успешно установлен!",type:"success"})}).catch(d=>{clearInterval(i),this.timer=null,this.$notify({title:"DoDoors",text:"Ошибочка...",type:"error"})})},selectDoor(i){this.loading=!0,this.tab=0,this.selected_index=i,this.$nextTick(()=>{this.loading=!1})},onStartEdit(){this.tab=1}}},Pr=Object.assign(gr,{setup(i){return(t,d)=>{var h,o,p,r,v,P,C;return i.doors.length>0?(s(),l(w,{key:0},[e("div",Bi,[e("div",Li,[e("div",Hi,[e("div",Ni,[e("div",Wi,[e("button",{type:"button",disabled:i.doors.length===1,onClick:d[0]||(d[0]=n=>t.nextDoor(0)),class:"btn btn-dark rounded-0"},Ri,8,Ai),e("button",Gi,c(t.selected_index+1)+"/"+c(i.doors.length),1),e("button",{type:"button",disabled:i.doors.length===1,onClick:d[1]||(d[1]=n=>t.nextDoor(1)),class:"btn btn-dark rounded-0 ml-2"},Xi,8,Ki)]),Yi]),e("div",Zi,[e("p",null,[_("Информация о заказе: "),e("span",en,"№"+c(i.order.id),1)]),e("div",tn,[on,e("ul",sn,[e("li",null,[e("a",{class:"dropdown-item",onClick:d[2]||(d[2]=(...n)=>t.sendToTelegram&&t.sendToTelegram(...n)),href:"javascript:void(0)"},[ln,_(" Отправить в телеграм ")])]),e("li",null,[e("a",{class:"dropdown-item",onClick:d[3]||(d[3]=(...n)=>t.sendToBitrix&&t.sendToBitrix(...n)),href:"javascript:void(0)"},[nn,_(" Отправить в Битрикс ")])]),e("li",null,[e("a",{class:"dropdown-item",onClick:d[4]||(d[4]=(...n)=>t.sendToEmail&&t.sendToEmail(...n)),href:"javascript:void(0)"},[rn,_(" Отправить на почту клиента ")])]),dn,e("li",null,[e("a",{class:"dropdown-item",target:"_blank",href:"/orders/download-order-excel/"+i.order.id},[an,_("Скачать Excel-документ по заказу")],8,cn)]),e("li",null,[e("a",{class:"dropdown-item",target:"_blank",href:"/orders/download-contract?id="+i.order.id},[un,_("Скачать договор")],8,_n)]),hn,e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:d[5]||(d[5]=(...n)=>t.removeItem&&t.removeItem(...n)),href:"javascript:void(0)"},[pn,_("Удалить")])])])])])])])]),t.tab===0?(s(),l("div",mn,[e("div",fn,[t.loading?a("",!0):(s(),O(us,{key:0,"can-edit":i.canEdit,onEdit:t.onStartEdit,modelValue:i.doors[t.selected_index].door,"onUpdate:modelValue":d[6]||(d[6]=n=>i.doors[t.selected_index].door=n)},null,8,["can-edit","onEdit","modelValue"]))])])):a("",!0),t.tab===1?(s(),l("div",yn,[e("div",bn,[t.loading?a("",!0):(s(),O(L,{key:0,"edit-order":!0,door:i.doors[t.selected_index]},null,8,["door"]))])])):a("",!0),e("div",vn,[e("div",kn,[t.cart_tab===0?(s(),l("h5",gn,"Двери в заказе")):a("",!0),t.cart_tab===1?(s(),l("h5",wn,"Параметры заказа")):a("",!0),Fn]),t.cart_tab===0?(s(),l("div",$n,[(s(!0),l(w,null,S(i.doors,(n,f)=>{var $;return s(),l("div",{onClick:x=>t.selectDoor(f),class:g([{"border-black":t.selected_index===f},"card btn btn-light text-left p-0 rounded-0 mb-2 cursor-pointer"])},[e("div",Cn,[e("h6",Pn,c(n.door.purpose||"-")+": "+c(n.door.door_type.title)+" "+c(n.door.width)+"x"+c(n.door.height)+"x"+c((($=n.door.opening_type)==null?void 0:$.depth)||0),1),e("h6",Vn,[n.door.box_and_frame_color.title?(s(),l("span",zn,"("+c(n.door.box_and_frame_color.title)+")",1)):a("",!0),_(" лицо "),n.door.front_side_finish.title?(s(),l("span",jn,c(n.door.front_side_finish.title),1)):a("",!0),_("/ "),n.door.back_side_finish.title?(s(),l("span",Tn,c(n.door.back_side_finish.title)+",",1)):a("",!0),_(" петли "),n.door.loops.title?(s(),l("span",Dn,c(n.door.loops.title)+",",1)):a("",!0),n.door.hinge_manufacturer.title?(s(),l("span",En,c(n.door.hinge_manufacturer.title)+",",1)):a("",!0),n.door.fittings_color.title?(s(),l("span",In,"("+c(n.door.fittings_color.title)+"),",1)):a("",!0),n.door.opening_type.title?(s(),l("span",Sn,c(n.door.opening_type.title)+",",1)):a("",!0),n.door.handle_holes.title?(s(),l("span",On,c(n.door.handle_holes.title)+",",1)):a("",!0),n.door.need_automatic_doorstep?(s(),l("span",Un," автоматический порожек,")):a("",!0),n.door.need_upper_jumper?(s(),l("span",qn," верхняя перемычка,")):a("",!0),n.door.need_handle_holes?(s(),l("span",Mn," дверная ручка,")):a("",!0),n.door.handle_holes_type.title?(s(),l("span",Bn,c(n.door.handle_holes_type.title)+",",1)):a("",!0),n.door.handle_holes.title?(s(),l("span",Ln,c(n.door.handle_holes.title)+",",1)):a("",!0),n.door.need_hidden_door_closer?(s(),l("span",Hn," скрытый доводчик,")):a("",!0),n.door.need_hidden_skirting_board?(s(),l("span",Nn," скрытый плинтус,")):a("",!0),n.door.need_hidden_stopper?(s(),l("span",Wn," скрытый стопор,")):a("",!0),n.door.need_door_install?(s(),l("span",An," установка двери")):a("",!0)])])],10,xn)}),256)),t.loading?(s(),l("div",pr,fr)):(s(),l("div",Jn,[e("div",Rn,[Gn,e("p",Kn,[_("Сумма за заказ "),e("span",Qn,c(i.order.total_price||0)+" руб",1)]),e("p",Xn,[_("Общее число дверей "),e("span",Yn,c(i.order.total_count||0)+" ед.",1)]),e("p",Zn,[_("Оплачено "),e("span",er,c(i.order.current_payed||0)+" руб ("+c(i.order.payed_percent||0)+"%)",1)]),e("p",tr,[_(" Оплата дизайнеру "),(h=i.order.config)!=null&&h.designer_work_type?(s(),l("span",or,c(((o=i.order.config)==null?void 0:o.designer_price)||0)+" руб",1)):(s(),l("span",sr,c(((p=i.order.config)==null?void 0:p.designer_value)||0)+" %",1))]),e("p",lr,[_("Цена за установку "),e("span",ir,c(((r=i.order.config)==null?void 0:r.install_price)||0)+" руб",1)]),e("p",nr,[_("Цена за доставку "),e("span",rr,c(((v=i.order.config)==null?void 0:v.delivery_price)||0)+" руб",1)]),e("p",dr,[_("Скидка "),e("span",cr,c(((P=i.order.discount)==null?void 0:P.percent)||0)+"%",1)]),e("p",ar,[_("Сумма скидки "),e("span",_r,c(((C=i.order.discount)==null?void 0:C.amount)||0)+" руб",1)]),e("p",ur,[_("Итого "),e("span",null,c(t.summary)+" руб",1)]),e("p",hr,[_("Итого со скидкой "),e("span",null,c(t.summaryWithDiscount)+" руб",1)])])]))])):a("",!0),t.cart_tab===1?(s(),l(w,{key:1},[e("div",yr,[M(Mi,{onBack:d[7]||(d[7]=n=>t.cart_tab=0),order:i.order,doors:i.doors},null,8,["order","doors"])]),e("div",br,[e("button",{type:"button",class:"btn btn-outline-secondary w-100 rounded-0 p-3",onClick:d[8]||(d[8]=n=>t.cart_tab=0)},"Назад ")])],64)):a("",!0),t.cart_tab===0?(s(),l("div",vr,[e("button",{type:"button",onClick:d[9]||(d[9]=n=>t.cart_tab=1),class:"btn btn-outline-dark p-3 w-100 rounded-0"},"Редактировать параметры заказа ")])):a("",!0)])],64)):(s(),l("p",kr," Данный заказ не содержит информации о дверях "))}}});export{Pr as _};
