import{_ as y}from"./AuthenticatedLayout-xRh9Nswg.js";import{o as i,c as n,b as o,g as m,v as h,h as C,a as f,w as b,u as g,F as _,r as k,e as l,f as r,j as w,t as a,m as P,d as p,Z as j}from"./app-Cs4LqTrj.js";import{P as V}from"./Pagination-DlrHS-RB.js";import"./RalColorSelector-DJ_0YP6K.js";import{E as v}from"./main-C76KUz8k.js";import"./ApplicationLogo-C9sx2dvQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IndividualDataForm-YIxirPpt.js";import"./vue-the-mask-Bdf0JxEC.js";const F={class:"form-floating mb-3"},L=o("label",{for:"promo-code-code"},"Промокод",-1),A={class:"form-floating mb-3"},I=o("label",{for:"promo-code-discount"},"Процент скидки",-1),M={class:"form-floating mb-3"},D=o("label",{for:"promo-code-comment"},"Комментарий к промокоду",-1),T={class:"form-check form-switch"},O=o("label",{class:"form-check-label",for:"promo-code-is-active"}," Доступен для активации ",-1),U={class:"row"},B={class:"col-12"},E=o("label",{class:"form-check-label",for:"promo-code-is-active"}," Дата завершения ",-1),N={class:"action-row"},S=["onClick"],q=["onClick"],G={class:"row"},Z={class:"col-12"},z={class:"alert alert-danger alert-dismissible fade show",role:"alert"},H=o("strong",null,"Внимание!",-1),J=["onClick"],K={class:"row mt-5"},Q={class:"col-12 d-flex justify-content-center"},R=["disabled"],W={key:0,class:"fa-regular fa-floppy-disk mr-1"},X={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},Y=o("i",{class:"fa-solid fa-xmark mr-1"},null,-1),x={props:["item"],components:{VueDatePicker:v},data(){return{messages:[],loading:!1,form:{id:null,code:null,description:null,discount:0,end_at:null,is_active:!0}}},computed:{needClearForm(){return this.form.id||this.form.code||this.form.description||this.form.discount||this.form.end_at}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,code:this.item.code||null,description:this.item.description||null,discount:this.item.discount||0,end_at:this.item.end_at||null,is_active:this.item.is_active||!0}})},methods:{alert(d){this.messages.push(d)},resetForm(){this.form.id=null,this.form.code=null,this.form.discount=0,this.form.description=null,this.form.end_at=null,this.form.is_active=!1,this.$emit("callback")},removeMessage(d){this.messages.splice(d,1)},submit(){this.$store.dispatch("storePromoCode",{promoCodeForm:this.form}).then(d=>{this.$notify({title:"DoDoors",text:"Промокод успешно добавлен",type:"success"}),this.$emit("callback"),this.resetForm()}).catch(d=>{this.$notify({title:"DoDoors",text:"Ошибка добавления промокода",type:"error"})})}}},$=Object.assign(x,{__name:"PomoCodeForm",setup(d){return(t,e)=>(i(),n("form",{action:"",onSubmit:e[6]||(e[6]=w((...s)=>t.submit&&t.submit(...s),["prevent"]))},[o("div",F,[m(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>t.form.code=s),maxlength:"5",class:"form-control",id:"promo-code-code",required:""},null,512),[[h,t.form.code]]),L]),o("div",A,[m(o("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>t.form.discount=s),step:"0.01",min:"0",max:"100",class:"form-control",id:"promo-code-discount",required:""},null,512),[[h,t.form.discount]]),I]),o("div",M,[m(o("textarea",{class:"form-control border-secondary rounded-0","onUpdate:modelValue":e[2]||(e[2]=s=>t.form.description=s),style:{"min-height":"100px"},placeholder:"Оставьте комментарий",id:"promo-code-comment"},`
            `,512),[[h,t.form.description]]),D]),o("div",T,[m(o("input",{class:"form-check-input","onUpdate:modelValue":e[3]||(e[3]=s=>t.form.is_active=s),type:"checkbox",role:"switch",id:"promo-code-is-active",checked:""},null,512),[[C,t.form.is_active]]),O]),o("div",U,[o("div",B,[E,f(g(v),{locale:"ru",modelValue:t.form.end_at,"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.end_at=s)},{"action-row":b(({internalModelValue:s,selectDate:c,closePicker:u})=>[o("div",N,[o("button",{type:"button",class:"btn btn-dark rounded-0 mr-2",onClick:c},"Выбрать",8,S),o("button",{type:"button",class:"btn btn-outline-secondary rounded-0",onClick:u},"Закрыть",8,q)])]),_:1},8,["modelValue"])])]),o("div",G,[o("div",Z,[t.messages.length>0?(i(!0),n(_,{key:0},k(t.messages,(s,c)=>(i(),n("div",z,[H,r(" "+a(s||"Ошибка")+" ",1),o("button",{type:"button",class:"btn-close",onClick:u=>t.removeMessage(c)},null,8,J)]))),256)):l("",!0)])]),o("div",K,[o("div",Q,[o("button",{disabled:!t.needClearForm,class:"btn btn-dark rounded-0"},[t.loading?(i(),n("span",X)):(i(),n("i",W)),r(" Сохранить промокод ")],8,R),t.needClearForm&&!t.loading?(i(),n("button",{key:0,type:"button",onClick:e[5]||(e[5]=(...s)=>t.resetForm&&t.resetForm(...s)),class:"btn btn-outline-secondary rounded-0 ml-2"},[Y,r(" Очистить форму ")])):l("",!0)])])],32))}}),oo={class:"row"},to={class:"col-12"},so={class:"input-group mb-3"},eo={class:"form-floating"},io=o("label",{for:"search-promo-codes"},"Поиск по промокодам",-1),no=o("i",{class:"fa-solid fa-magnifying-glass"},null,-1),lo=[no],ro={key:0,class:"table"},ao={key:0},co=o("i",{class:"fa-solid fa-caret-down"},null,-1),mo=[co],uo={key:1},ho=o("i",{class:"fa-solid fa-caret-up"},null,-1),_o=[ho],po=o("th",{scope:"col",class:"text-center"},"Действие",-1),fo={key:0},bo=o("i",{class:"fa-solid fa-caret-down"},null,-1),go=[bo],ko={key:1},vo=o("i",{class:"fa-solid fa-caret-up"},null,-1),$o=[vo],yo={key:0},Co=o("i",{class:"fa-solid fa-caret-down"},null,-1),wo=[Co],Po={key:1},jo=o("i",{class:"fa-solid fa-caret-up"},null,-1),Vo=[jo],Fo={key:0},Lo=o("i",{class:"fa-solid fa-caret-down"},null,-1),Ao=[Lo],Io={key:1},Mo=o("i",{class:"fa-solid fa-caret-up"},null,-1),Do=[Mo],To=o("th",{scope:"col",class:"text-center"},"Число активация",-1),Oo=o("th",{scope:"col",class:"text-center"},"Активный",-1),Uo={key:0},Bo=o("i",{class:"fa-solid fa-caret-down"},null,-1),Eo=[Bo],No={key:1},So=o("i",{class:"fa-solid fa-caret-up"},null,-1),qo=[So],Go={scope:"row"},Zo={class:"text-center"},zo={class:"dropdown"},Ho=o("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[o("i",{class:"fa-solid fa-bars"})],-1),Jo={class:"dropdown-menu"},Ko=["onClick"],Qo=o("i",{class:"fa-solid fa-pen mr-2"},null,-1),Ro=["onClick"],Wo=o("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Xo={class:"text-center"},Yo={class:"text-center"},xo={class:"text-center"},ot={class:"text-center"},tt={class:"text-center"},st={key:0},et={key:1},it={class:"text-center"},nt={key:1,class:"alert alert-success rounded-0",role:"alert"},dt=o("h4",{class:"alert-heading"},"Промокоды",-1),lt=o("p",null,"К сожалению, раздел промокодов пуст. Вы еще не добавили ни одного промокода, которые можно отобразить на этой странице.",-1),rt=o("hr",null,null,-1),at=o("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свой первый промокод",-1),ct=[dt,lt,rt,at],mt={key:2,class:"row mb-3"},ut={class:"col-12"},ht={class:"modal fade",id:"promocode-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},_t={class:"modal-dialog modal-lg"},pt={class:"modal-content rounded-0"},ft={class:"modal-body"},bt={data(){return{editor_modal:null,selected_item:null,sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...P(["getPromoCodes","getPromoCodesPaginateObject"])},mounted(){this.loadPromoCodes(),this.editor_modal=new bootstrap.Modal(document.getElementById("promocode-editor-modal"),{})},methods:{sortAndLoad(d){this.sort.column=d,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadPromoCodes(this.current_page)},loadPromoCodes(d=0){this.current_page=d,this.$store.dispatch("loadPromoCodes",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(t=>{this.items=this.getPromoCodes,this.paginate_object=this.getPromoCodesPaginateObject}).catch(()=>{this.loading=!1})},selectItem(d){if(d==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=d,this.editor_modal.show()})},duplicateItem(d){this.$store.dispatch("duplicatePromoCode",{promoCodeId:d}).then(()=>{this.sortAndLoad("id")})},removeItem(d){this.$store.dispatch("removePromoCode",{promoCodeId:d}).then(()=>{this.sortAndLoad("id")})}}},gt=Object.assign(bt,{__name:"PromoCodeTable",setup(d){return(t,e)=>(i(),n(_,null,[o("form",oo,[o("div",to,[o("div",so,[o("div",eo,[m(o("input",{type:"search","onUpdate:modelValue":e[0]||(e[0]=s=>t.search=s),class:"form-control",id:"search-promo-codes"},null,512),[[h,t.search]]),io]),o("button",{type:"button",onClick:e[1]||(e[1]=s=>t.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},lo)])])]),t.items.length>0?(i(),n("table",ro,[o("thead",null,[o("tr",null,[o("th",{scope:"col",class:"cursor-pointer",onClick:e[2]||(e[2]=s=>t.sortAndLoad("id"))},[r("# "),t.sort.direction==="desc"&&t.sort.column==="id"?(i(),n("span",ao,mo)):l("",!0),t.sort.direction==="asc"&&t.sort.column==="id"?(i(),n("span",uo,_o)):l("",!0)]),po,o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[3]||(e[3]=s=>t.sortAndLoad("code"))},[r("Код "),t.sort.direction==="desc"&&t.sort.column==="code"?(i(),n("span",fo,go)):l("",!0),t.sort.direction==="asc"&&t.sort.column==="code"?(i(),n("span",ko,$o)):l("",!0)]),o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[4]||(e[4]=s=>t.sortAndLoad("discount"))},[r("Процент скидки "),t.sort.direction==="desc"&&t.sort.column==="discount"?(i(),n("span",yo,wo)):l("",!0),t.sort.direction==="asc"&&t.sort.column==="discount"?(i(),n("span",Po,Vo)):l("",!0)]),o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[5]||(e[5]=s=>t.sortAndLoad("description"))},[r("Описание "),t.sort.direction==="desc"&&t.sort.column==="description"?(i(),n("span",Fo,Ao)):l("",!0),t.sort.direction==="asc"&&t.sort.column==="description"?(i(),n("span",Io,Do)):l("",!0)]),To,Oo,o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[6]||(e[6]=s=>t.sortAndLoad("end_at"))},[r(" Дата окончания "),t.sort.direction==="desc"&&t.sort.column==="end_at"?(i(),n("span",Uo,Eo)):l("",!0),t.sort.direction==="asc"&&t.sort.column==="end_at"?(i(),n("span",No,qo)):l("",!0)])])]),o("tbody",null,[(i(!0),n(_,null,k(t.items,(s,c)=>(i(),n("tr",null,[o("th",Go,a(s.id||c),1),o("td",Zo,[o("div",zo,[Ho,o("ul",Jo,[o("li",null,[o("a",{class:"dropdown-item",onClick:u=>t.selectItem(s),href:"javascript:void(0)"},[Qo,r("Редактировать")],8,Ko)]),o("li",null,[o("a",{class:"dropdown-item text-danger",onClick:u=>t.removeItem(s.id),href:"javascript:void(0)"},[Wo,r("Удалить")],8,Ro)])])])]),o("td",Xo,a(s.code||"-"),1),o("td",Yo,a(s.discount||0),1),o("td",xo,a(s.description||0),1),o("td",ot,a(s.activation_count||0),1),o("td",tt,[s.is_active?(i(),n("span",st,"Активный")):(i(),n("span",et,"Не активный"))]),o("td",it,a(s.end_at||"-"),1)]))),256))])])):l("",!0),t.items.length===0?(i(),n("div",nt,ct)):l("",!0),t.items.length>0?(i(),n("div",mt,[o("div",ut,[t.paginate_object?(i(),p(V,{key:0,onPagination_page:t.loadPromoCodes,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):l("",!0)])])):l("",!0),o("div",ht,[o("div",_t,[o("div",pt,[o("div",ft,[t.selected_item?(i(),p($,{key:0,item:t.selected_item,onCallback:e[7]||(e[7]=s=>t.selectItem(null))},null,8,["item"])):l("",!0)])])])])],64))}}),kt=o("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Промокоды",-1),vt={class:"py-12"},$t={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},yt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ct={class:"p-6 text-gray-900"},wt=o("hr",{class:"hr my-5"},null,-1),Pt={data(){return{loading:!1,selectedPromoCode:null}},methods:{selectPromoCode(d){this.selectedPromoCode=d,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackPromoCodeForm(){this.loading=!0,this.selectedPromoCode=null,this.$nextTick(()=>{this.loading=!1})}}},Ot=Object.assign(Pt,{__name:"PromoCodesPage",setup(d){return(t,e)=>(i(),n(_,null,[f(g(j),{title:"Промокоды"}),f(y,null,{header:b(()=>[kt]),default:b(()=>[o("div",vt,[o("div",$t,[o("div",yt,[o("div",Ct,[t.loading?l("",!0):(i(),p($,{key:0,item:t.selectedPromoCode,onCallback:t.callbackPromoCodeForm},null,8,["item","onCallback"])),wt,t.loading?l("",!0):(i(),p(gt,{key:1,onSelect:t.selectPromoCode},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{Ot as default};
