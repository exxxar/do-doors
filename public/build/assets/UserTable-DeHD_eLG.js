import{o as i,c as n,b as s,f as u,v as h,t as c,e as a,i as r,F as m,r as _,j as y,a as f,m as $,d as b}from"./app-CVZ-3-e_.js";import{P as g}from"./Pagination-D2K4Aw9P.js";import{a as v}from"./RoleTable-CzNpEgoW.js";import{a as k}from"./PermissionTable-CpgjPoeR.js";const w={class:"form-floating mb-3"},M=s("label",{for:"user-title"},"Имя пользователя",-1),S={class:"form-floating mb-3"},C=s("label",{for:"user-email"},"Почта пользователя",-1),U={class:"form-floating mb-3"},j=s("label",{for:"user-password"},"Пароль",-1),P={class:"row"},L={class:"col-12"},F={class:"input-group"},I={key:0,class:"form-control rounded-0 border-secondary"},D={key:1,class:"form-control rounded-0 border-secondary"},A=s("label",{for:"client-user_id"},"Роль",-1),V=s("i",{class:"fa-solid fa-ban"},null,-1),B=[V],O={class:"row mt-3"},E={class:"col-12 mb-3"},N=s("i",{class:"fa-solid fa-plus mr-1"},null,-1),R={class:"col-md-4 col-12 mb-3"},T={class:"input-group"},q={class:"form-floating"},z={key:0,class:"form-control rounded-0 border-secondary"},G={key:1,class:"form-control rounded-0 border-secondary"},J=s("label",{for:"client-user_id"},"Разрешение",-1),H=["onClick"],K=s("i",{class:"fa-solid fa-ban"},null,-1),Q=[K],W={class:"row"},X={class:"col-12"},Y={class:"alert alert-danger alert-dismissible fade show",role:"alert"},Z=s("strong",null,"Внимание!",-1),x=["onClick"],ss={class:"row mt-5"},es={class:"col-12 d-flex justify-content-center"},os=["disabled"],ts={key:0,class:"fa-regular fa-floppy-disk mr-1"},is={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},ls=s("i",{class:"fa-solid fa-xmark mr-1"},null,-1),ns=["id"],as={class:"modal-dialog modal-lg"},rs={class:"modal-content rounded-0 border-secondary"},ds=s("div",{class:"modal-header"},[s("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Поиск роли"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),cs={class:"modal-body 0"},ms=s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-outline-secondary rounded-0 border-secondary","data-bs-dismiss":"modal"},"Закрыть ")],-1),us=["id"],hs={class:"modal-dialog modal-lg"},ps={class:"modal-content rounded-0 border-secondary"},_s=s("div",{class:"modal-header"},[s("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Поиск разрешения"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),fs={class:"modal-body 0"},bs=s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-outline-secondary rounded-0 border-secondary","data-bs-dismiss":"modal"},"Закрыть ")],-1),ys={props:["item","id"],data(){return{roleSearchModal:null,permissionSearchModal:null,messages:[],loading:!1,form:{id:null,email:null,name:null,password:null,roles:[],permissions:[]}}},computed:{preparedPermissions(){return this.form.permissions.map(t=>t.id)},needClearForm(){return this.form.id||this.form.email||this.form.name||this.form.password||this.form.roles.length>0||this.form.permissions.length>0}},mounted(){this.roleSearchModal=new bootstrap.Modal(document.getElementById(this.id+"-search-roles"),{}),this.permissionSearchModal=new bootstrap.Modal(document.getElementById(this.id+"-search-permissions"),{}),this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,email:this.item.email||null,name:this.item.name||null,roles:this.item.roles||[],permissions:this.item.permissions||[]}})},methods:{openRoleSearchModal(){this.roleSearchModal.show()},openPermissionsSearchModal(){this.permissionSearchModal.show()},alert(t){this.messages.push(t)},selectRole(t){this.form.roles=[],this.form.roles.push(t),this.roleSearchModal.hide()},removePermission(t){this.form.permissions.splice(t,1),this.$notify({title:"DoDoors",text:"Разрешение успешно удалено",type:"success"})},selectPermissions(t){let e=this.form.permissions.findIndex(o=>o.id===t.id);e===-1?(this.form.permissions.push(t),this.$notify({title:"DoDoors",text:"Разрешение успешно добавлено",type:"success"})):(this.form.permissions.splice(e,1),this.$notify({title:"DoDoors",text:"Разрешение успешно удалено",type:"success"}))},resetForm(){this.form.id=null,this.form.name=null,this.form.email=null,this.form.password=null,this.form.roles=[],this.form.permissions=[],this.$emit("callback")},removeMessage(t){this.messages.splice(t,1)},submit(){let t=new FormData;Object.keys(this.form).forEach(e=>{const o=this.form[e]||"";typeof o=="object"?t.append(e,JSON.stringify(o)):t.append(e,o)}),this.$store.dispatch("storeUser",{userForm:t}).then(e=>{this.$emit("callback"),this.resetForm()}).catch(e=>{})}}},$s=Object.assign(ys,{__name:"UserForm",setup(t){return(e,o)=>(i(),n(m,null,[s("form",{action:"",onSubmit:o[7]||(o[7]=y((...l)=>e.submit&&e.submit(...l),["prevent"]))},[s("div",w,[u(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=l=>e.form.name=l),class:"form-control",id:"user-name",required:""},null,512),[[h,e.form.name]]),M]),s("div",S,[u(s("input",{type:"email","onUpdate:modelValue":o[1]||(o[1]=l=>e.form.email=l),class:"form-control",id:"user-email",required:""},null,512),[[h,e.form.email]]),C]),s("div",U,[u(s("input",{type:"password","onUpdate:modelValue":o[2]||(o[2]=l=>e.form.password=l),class:"form-control",id:"user-password"},null,512),[[h,e.form.password]]),j]),s("div",P,[s("div",L,[s("div",F,[s("div",{class:"form-floating",onClick:o[3]||(o[3]=(...l)=>e.openRoleSearchModal&&e.openRoleSearchModal(...l))},[e.form.roles.length>0?(i(),n("p",I,c(e.form.roles[0].name),1)):(i(),n("p",D,"Не выбрана")),A]),e.form.roles.length>0?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary rounded-0",onClick:o[4]||(o[4]=l=>e.form.roles=[])},B)):a("",!0)])])]),s("div",O,[s("div",E,[s("button",{type:"button",onClick:o[5]||(o[5]=(...l)=>e.openPermissionsSearchModal&&e.openPermissionsSearchModal(...l)),class:"btn btn-dark rounded-0"},[N,r(" Добавить разрешение ")])]),(i(!0),n(m,null,_(e.form.permissions,(l,d)=>(i(),n("div",R,[s("div",T,[s("div",q,[e.form.permissions[d]?(i(),n("p",z,c(e.form.permissions[d].name),1)):(i(),n("p",G,"Не выбрана")),J]),e.form.permissions[d]?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary rounded-0",onClick:p=>e.removePermission(d)},Q,8,H)):a("",!0)])]))),256))]),s("div",W,[s("div",X,[e.messages.length>0?(i(!0),n(m,{key:0},_(e.messages,(l,d)=>(i(),n("div",Y,[Z,r(" "+c(l||"Ошибка")+" ",1),s("button",{type:"button",class:"btn-close",onClick:p=>e.removeMessage(d)},null,8,x)]))),256)):a("",!0)])]),s("div",ss,[s("div",es,[s("button",{disabled:!e.needClearForm,class:"btn btn-dark rounded-0"},[e.loading?(i(),n("span",is)):(i(),n("i",ts)),r(" Сохранить пользователя ")],8,os),e.needClearForm&&!e.loading?(i(),n("button",{key:0,type:"button",onClick:o[6]||(o[6]=(...l)=>e.resetForm&&e.resetForm(...l)),class:"btn btn-outline-secondary rounded-0 ml-2"},[ls,r(" Очистить форму ")])):a("",!0)])])],32),s("div",{class:"modal fade",id:t.id+"-search-roles",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[s("div",as,[s("div",rs,[ds,s("div",cs,[f(v,{"for-select":!0,onSelect:e.selectRole},null,8,["onSelect"])]),ms])])],8,ns),s("div",{style:{"z-index":"10000"},class:"modal fade",id:t.id+"-search-permissions",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[s("div",hs,[s("div",ps,[_s,s("div",fs,[f(k,{"for-select":!0,selected:e.preparedPermissions,onSelect:e.selectPermissions},null,8,["selected","onSelect"])]),bs])])],8,us)],64))}}),gs={class:"row"},vs={class:"col-12"},ks={class:"input-group mb-3"},ws={class:"form-floating"},Ms=s("label",{for:"search-users"},"Поиск пользователя",-1),Ss=s("i",{class:"fa-solid fa-magnifying-glass"},null,-1),Cs=[Ss],Us={key:0,class:"table"},js={key:0},Ps=s("i",{class:"fa-solid fa-caret-down"},null,-1),Ls=[Ps],Fs={key:1},Is=s("i",{class:"fa-solid fa-caret-up"},null,-1),Ds=[Is],As={key:0,scope:"col",class:"text-center"},Vs={key:0},Bs=s("i",{class:"fa-solid fa-caret-down"},null,-1),Os=[Bs],Es={key:1},Ns=s("i",{class:"fa-solid fa-caret-up"},null,-1),Rs=[Ns],Ts={key:0},qs=s("i",{class:"fa-solid fa-caret-down"},null,-1),zs=[qs],Gs={key:1},Js=s("i",{class:"fa-solid fa-caret-up"},null,-1),Hs=[Js],Ks={key:0},Qs=s("i",{class:"fa-solid fa-caret-down"},null,-1),Ws=[Qs],Xs={key:1},Ys=s("i",{class:"fa-solid fa-caret-up"},null,-1),Zs=[Ys],xs={scope:"row"},se={key:0,class:"text-center"},ee={class:"dropdown"},oe=s("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"fa-solid fa-bars"})],-1),te={class:"dropdown-menu"},ie=["onClick"],le=s("i",{class:"fa-solid fa-pen mr-2"},null,-1),ne=["onClick"],ae=s("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),re={class:"text-center"},de={class:"text-center"},ce={key:1,class:"text-center"},me={key:1,class:"alert alert-success",role:"alert"},ue=s("h4",{class:"alert-heading"},"Ручки",-1),he=s("p",null,"К сожалению, раздел ручек пуст. Вы еще не добавили ни одной ручки, которые можно отобразить на этой странице.",-1),pe=s("hr",null,null,-1),_e=s("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свою первую ручку",-1),fe=[ue,he,pe,_e],be={key:2,class:"row mb-3"},ye={class:"col-12"},$e={class:"modal fade",id:"user-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ge={class:"modal-dialog modal-xl"},ve={class:"modal-content rounded-0"},ke={class:"modal-body"},we={props:["forSelect"],data(){return{editor_modal:null,selected_item:null,sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...$(["getUsers","getUsersPaginateObject"])},mounted(){this.loadUsers(),this.editor_modal=new bootstrap.Modal(document.getElementById("user-editor-modal"),{})},methods:{sortAndLoad(t){this.sort.column=t,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadUsers(this.current_page)},loadUsers(t=0){this.current_page=t,this.$store.dispatch("loadUsers",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(e=>{this.items=this.getUsers,this.paginate_object=this.getUsersPaginateObject}).catch(()=>{this.loading=!1})},selectItem(t){if(t==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=t,this.editor_modal.show()})},duplicateItem(t){this.$store.dispatch("duplicateUser",{materialId:t}).then(()=>{this.sortAndLoad("id")})},removeItem(t){this.$store.dispatch("removeUser",{materialId:t}).then(()=>{this.sortAndLoad("id")})}}},je=Object.assign(we,{__name:"UserTable",setup(t){return(e,o)=>(i(),n(m,null,[s("form",gs,[s("div",vs,[s("div",ks,[s("div",ws,[u(s("input",{type:"search","onUpdate:modelValue":o[0]||(o[0]=l=>e.search=l),class:"form-control",id:"search-users"},null,512),[[h,e.search]]),Ms]),s("button",{type:"button",onClick:o[1]||(o[1]=l=>e.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},Cs)])])]),e.items.length>0?(i(),n("table",Us,[s("thead",null,[s("tr",null,[s("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=l=>e.sortAndLoad("id"))},[r("# "),e.sort.direction==="desc"&&e.sort.column==="id"?(i(),n("span",js,Ls)):a("",!0),e.sort.direction==="asc"&&e.sort.column==="id"?(i(),n("span",Fs,Ds)):a("",!0)]),t.forSelect?a("",!0):(i(),n("th",As,"Действие")),s("th",{scope:"col",class:"text-center cursor-pointer",onClick:o[3]||(o[3]=l=>e.sortAndLoad("email"))},[r("Почта "),e.sort.direction==="desc"&&e.sort.column==="email"?(i(),n("span",Vs,Os)):a("",!0),e.sort.direction==="asc"&&e.sort.column==="email"?(i(),n("span",Es,Rs)):a("",!0)]),s("th",{scope:"col",class:"text-center cursor-pointer",onClick:o[4]||(o[4]=l=>e.sortAndLoad("name"))},[r("Имя "),e.sort.direction==="desc"&&e.sort.column==="name"?(i(),n("span",Ts,zs)):a("",!0),e.sort.direction==="asc"&&e.sort.column==="name"?(i(),n("span",Gs,Hs)):a("",!0)]),t.forSelect?a("",!0):(i(),n("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:o[5]||(o[5]=l=>e.sortAndLoad("updated_at"))},[r(" Дата изменения "),e.sort.direction==="desc"&&e.sort.column==="updated_at"?(i(),n("span",Ks,Ws)):a("",!0),e.sort.direction==="asc"&&e.sort.column==="updated_at"?(i(),n("span",Xs,Zs)):a("",!0)]))])]),s("tbody",null,[(i(!0),n(m,null,_(e.items,(l,d)=>(i(),n("tr",null,[s("th",xs,c(l.id||d),1),t.forSelect?a("",!0):(i(),n("td",se,[s("div",ee,[oe,s("ul",te,[s("li",null,[s("a",{class:"dropdown-item",onClick:p=>e.selectItem(l),href:"javascript:void(0)"},[le,r("Редактировать")],8,ie)]),s("li",null,[s("a",{class:"dropdown-item text-danger",onClick:p=>e.removeItem(l.id),href:"javascript:void(0)"},[ae,r("Удалить")],8,ne)])])])])),s("td",re,c(l.email||"-"),1),s("td",de,c(l.name||0),1),t.forSelect?a("",!0):(i(),n("td",ce,c(l.updated_at||"-"),1))]))),256))])])):a("",!0),e.items.length===0?(i(),n("div",me,fe)):a("",!0),e.items.length>0?(i(),n("div",be,[s("div",ye,[e.paginate_object?(i(),b(g,{key:0,onPagination_page:e.loadUsers,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):a("",!0)])])):a("",!0),s("div",$e,[s("div",ge,[s("div",ve,[s("div",ke,[e.selected_item?(i(),b($s,{key:0,id:"user-form-2",item:e.selected_item,onCallback:o[6]||(o[6]=l=>e.selectItem(null))},null,8,["item"])):a("",!0)])])])])],64))}});export{je as _,$s as a};
