import{m as b,l as k,o as a,c as d,b as s,e as u,g as n,i as v,F as f,r as h,v as c,t as _,f as m,j as g,a as y,h as q}from"./app-B4-K4w0I.js";import{_ as U}from"./UserTable-D8s-nhFT.js";import{v as V}from"./vue-the-mask-BrpEz10W.js";const w={key:0,class:"row mb-3"},$={class:"col-md-6 col-12"},C={class:"row"},D={class:"col-md-6 col-12"},M={class:"form-floating"},B=s("option",{value:null},"Не выбрано",-1),S=["value"],F=s("label",{for:"status"},"Тип контрагента",-1),j={class:"col-md-6 col-12"},I={class:"form-floating mb-3"},R=s("label",{for:"client-title"},"Наименование компании",-1),T={class:"col-md-6 col-12"},E={class:"form-floating mb-3"},L=s("label",{for:"fio"},"ФИО представителя компании",-1),N={class:"col-6"},O={class:"form-floating mb-3"},A={class:"form-floating"},G=s("label",{for:"law_address"},"Юридический адрес",-1),J={class:"col-md-6 col-12"},z={class:"form-floating mb-3"},H=s("label",{for:"client-email"},"Электронная почта",-1),K={class:"col-md-6 col-12"},P={class:"form-floating mb-3"},Q=s("label",{for:"client-phone"},"Телефон",-1),W={class:"col-md-12 col-12"},X={class:"form-floating mb-3"},Y={class:"form-floating"},Z=s("label",{for:"comment"},"Комментарий",-1),x={class:"col-md-6 col-12 mb-3"},ss={class:"input-group"},os={class:"form-floating"},es=s("label",{for:"client-inn"},"ИНН",-1),ts=["disabled"],ls=s("i",{class:"fa-solid fa-magnifying-glass"},null,-1),is=[ls],ns=["href"],rs={class:"col-md-6 col-12"},as={class:"form-floating mb-3"},ds=s("label",{for:"client-kpp"},"КПП",-1),cs={class:"col-md-6 col-12"},us={class:"form-floating mb-3"},ms=s("label",{for:"client-ogrn"},"ОГРН",-1),fs={class:"col-md-6 col-12"},hs={class:"form-floating mb-3"},_s=s("label",{for:"client-okpo"},"ОКПО",-1),ps={class:"col-md-6 col-12 mb-3"},bs={class:"input-group"},ks={key:0,class:"form-control rounded-0 border-secondary"},vs={key:1,class:"form-control rounded-0 border-secondary"},gs=s("label",{for:"client-user_id"},"Пользователь",-1),ys=s("i",{class:"fa-solid fa-ban"},null,-1),qs=[ys],Us={class:"row"},Vs={class:"col-12 my-2"},ws=s("i",{class:"fa-solid fa-plus mr-1"},null,-1),$s={class:"col-md-6 col-12 mb-3"},Cs={class:"card rounded-0 border-secondary"},Ds={class:"card-header d-flex justify-between align-items-center border-secondary"},Ms={class:"form-check form-switch"},Bs=["onChange","onUpdate:modelValue","id"],Ss=["for"],Fs=["onClick"],js=s("i",{class:"fa-solid fa-xmark mr-2"},null,-1),Is={class:"card-body"},Rs={class:"row"},Ts={class:"col-md-6 col-12"},Es={class:"input-group mb-3"},Ls={class:"form-floating"},Ns=["onUpdate:modelValue","id"],Os=["for"],As=["disabled","onClick"],Gs=s("i",{class:"fa-solid fa-magnifying-glass"},null,-1),Js=[Gs],zs={class:"col-md-6 col-12"},Hs={class:"form-floating mb-3"},Ks=["onUpdate:modelValue","id"],Ps=["for"],Qs={class:"col-md-12 col-12"},Ws={class:"form-floating mb-3"},Xs=["onUpdate:modelValue","id"],Ys=["for"],Zs={class:"col-md-6 col-12"},xs={class:"form-floating mb-3"},so=["onUpdate:modelValue","id"],oo=["for"],eo={class:"col-md-6 col-12"},to={class:"form-floating"},lo=["onUpdate:modelValue","id"],io=["for"],no={class:"row"},ro={class:"col-12"},ao={class:"alert alert-danger alert-dismissible fade show",role:"alert"},co=s("strong",null,"Внимание!",-1),uo=["onClick"],mo={class:"row mt-5"},fo={class:"col-12 d-flex justify-content-center"},ho={class:"btn btn-dark rounded-0"},_o={key:0,class:"fa-regular fa-floppy-disk mr-1"},po={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},bo=s("i",{class:"fa-solid fa-xmark mr-1"},null,-1),ko={class:"modal fade",id:"search-users",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},vo={class:"modal-dialog modal-lg"},go={class:"modal-content rounded-0 border-secondary"},yo=s("div",{class:"modal-header"},[s("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Поиск пользователя"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),qo={class:"modal-body 0"},Uo=s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-outline-secondary rounded-0 border-secondary","data-bs-dismiss":"modal"},"Закрыть ")],-1),Vo={components:{},directives:{mask:V.mask},props:["item","editing"],data(){return{messages:[],userSearchModal:null,loading:!1,link_for_document:null,statuses:[],form:{id:null,status:null,phone:null,email:null,fact_address:null,comment:null,user:null,user_id:null,title:null,fio:null,law_address:null,inn:null,kpp:null,ogrn:null,okpo:null,requisites:[]}}},computed:{...b(["getDictionary"])},mounted(){this.statuses=this.getDictionary.statuses||[],this.userSearchModal=new bootstrap.Modal(document.getElementById("search-users"),{}),this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,status:this.item.status||null,phone:this.item.phone||null,email:this.item.email||null,fact_address:this.item.fact_address||null,comment:this.item.comment||null,user_id:this.item.user_id||null,user:this.item.user||null,title:this.item.title||null,fio:this.item.fio||null,law_address:this.item.law_address||null,inn:this.item.inn||null,kpp:this.item.kpp||null,ogrn:this.item.ogrn||null,okpo:this.item.okpo||null,requisites:this.item.requisites||[]}})},methods:{openUserSearchModal(){this.userSearchModal.show()},requestByBik(l){this.$notify({title:"DoDoors",text:"Ищем по БИК..."}),this.$store.dispatch("requestByBik",{bik:this.form.requisites[l].bik}).then(o=>{this.form.requisites[l].bank=(o.name||"").replaceAll("&quot;","'"),this.form.requisites[l].address=o.address?(o.index||"")+", "+(o.city||"")+", "+(o.address||""):null,this.form.requisites[l].correspondent_account=o.ks||null,this.$notify({title:"DoDoors",text:"Отлично! Данные найдены",type:"success"})}).catch(o=>{this.$notify({title:"DoDoors",text:"Данные не найдено",type:"error"})})},requestByInn(){this.link_for_document=null,this.$notify({title:"DoDoors",text:"Ищем по ИНН..."}),this.$store.dispatch("requestByInn",{inn:this.form.inn}).then(l=>{this.form.title=l[0].c||null,this.form.kpp=l[0].p||null,this.form.ogrn=l[0].o||null;let o=new Date;this.link_for_document=(l[0].t||null)+`?r=${o.getTime()}&_=${o.getTime()}`,this.$notify({title:"DoDoors",text:"Отлично! Данные найдены",type:"success"})}).catch(l=>{this.$notify({title:"DoDoors",text:"Данные не найдено",type:"error"})})},changeRequisitesMain(l){this.form.requisites.forEach(o=>o.is_main=!1),this.form.requisites[l].is_main=!0},alert(l){this.messages.push(l)},removeRequisite(l){this.form.requisites.splice(l,1)},addRequisites(){this.form.requisites.push({bik:null,bank:null,address:null,correspondent_account:null,checking_account:null,is_main:!1})},selectUserId(l){this.form.user_id=l.id,this.form.user=l,this.userSearchModal.hide()},resetForm(){const l={id:null,status:null,phone:null,email:null,fact_address:null,comment:null,user_id:null,title:null,fio:null,law_address:null,inn:null,kpp:null,ogrn:null,okpo:null,requisites:[]};this.form=l,this.$emit("callback")},removeMessage(l){this.messages.splice(l,1)},submit(){let l=new FormData;Object.keys(this.form).forEach(o=>{const e=this.form[o]||"";typeof e=="object"?l.append(o,JSON.stringify(e)):l.append(o,e)}),this.$store.dispatch("storeClient",{clientForm:l}).then(o=>{this.$emit("callback"),this.resetForm()}).catch(o=>{})}}},Do=Object.assign(Vo,{__name:"ClientForm",setup(l){return(o,e)=>{const p=k("mask");return a(),d(f,null,[l.editing?u("",!0):(a(),d("div",w,[s("div",$,[s("button",{type:"button",class:"btn btn-dark rounded-0",onClick:e[0]||(e[0]=(...t)=>o.resetForm&&o.resetForm(...t))},"Очистить форму ")])])),s("form",{action:"",onSubmit:e[17]||(e[17]=g((...t)=>o.submit&&o.submit(...t),["prevent"]))},[s("div",C,[s("div",D,[s("div",M,[n(s("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=t=>o.form.status=t),id:"status","aria-label":"Floating label select example"},[B,(a(!0),d(f,null,h(o.statuses,t=>(a(),d("option",{value:t.value},_(t.title||"Не указано"),9,S))),256))],512),[[v,o.form.status]]),F])]),s("div",j,[s("div",I,[n(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>o.form.title=t),class:"form-control",id:"client-title",required:""},null,512),[[c,o.form.title]]),R])]),s("div",T,[s("div",E,[n(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>o.form.fio=t),class:"form-control",id:"client-title"},null,512),[[c,o.form.fio]]),L])]),s("div",N,[s("div",O,[s("div",A,[n(s("textarea",{class:"form-control rounded-0 border-secondary","onUpdate:modelValue":e[4]||(e[4]=t=>o.form.law_address=t),placeholder:"Leave a comment here",id:"law_address"},null,512),[[c,o.form.law_address]]),G])])]),s("div",J,[s("div",z,[n(s("input",{type:"email","onUpdate:modelValue":e[5]||(e[5]=t=>o.form.email=t),class:"form-control",id:"client-email"},null,512),[[c,o.form.email]]),H])]),s("div",K,[s("div",P,[n(s("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=t=>o.form.phone=t),class:"form-control",id:"client-phone"},null,512),[[c,o.form.phone],[p,"+7(###)###-##-##"]]),Q])]),s("div",W,[s("div",X,[s("div",Y,[n(s("textarea",{class:"form-control rounded-0 border-secondary","onUpdate:modelValue":e[7]||(e[7]=t=>o.form.comment=t),placeholder:"Leave a comment here",id:"comment"},null,512),[[c,o.form.comment]]),Z])])]),s("div",x,[s("div",ss,[s("div",os,[n(s("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=t=>o.form.inn=t),maxlength:"12",class:"form-control",id:"client-inn",required:""},null,512),[[c,o.form.inn]]),es]),s("button",{type:"button",disabled:!o.form.inn,onClick:e[9]||(e[9]=(...t)=>o.requestByInn&&o.requestByInn(...t)),class:"btn btn-outline-secondary rounded-0"},is,8,ts)]),o.link_for_document?(a(),d("a",{key:0,href:"https://egrul.nalog.ru/vyp-download/"+o.link_for_document,target:"_blank",class:"btn btn-link my-0 py-0 px-0",style:{color:"red"}},"Скачать выписку",8,ns)):u("",!0)]),s("div",rs,[s("div",as,[n(s("input",{type:"text",maxlength:"9","onUpdate:modelValue":e[10]||(e[10]=t=>o.form.kpp=t),class:"form-control",id:"client-kpp"},null,512),[[c,o.form.kpp]]),ds])]),s("div",cs,[s("div",us,[n(s("input",{type:"text",maxlength:"15","onUpdate:modelValue":e[11]||(e[11]=t=>o.form.ogrn=t),class:"form-control",id:"client-ogrn"},null,512),[[c,o.form.ogrn]]),ms])]),s("div",fs,[s("div",hs,[n(s("input",{type:"text","onUpdate:modelValue":e[12]||(e[12]=t=>o.form.okpo=t),maxlength:"10",class:"form-control",id:"client-okpo"},null,512),[[c,o.form.okpo]]),_s])]),s("div",ps,[s("div",bs,[s("div",{class:"form-floating",onClick:e[13]||(e[13]=(...t)=>o.openUserSearchModal&&o.openUserSearchModal(...t))},[o.form.user?(a(),d("p",ks,_(o.form.user.email),1)):(a(),d("p",vs,"Не выбран")),gs]),o.form.user?(a(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary rounded-0",onClick:e[14]||(e[14]=t=>o.form.user=null)},qs)):u("",!0)])])]),s("div",Us,[s("div",Vs,[s("button",{type:"button",onClick:e[15]||(e[15]=(...t)=>o.addRequisites&&o.addRequisites(...t)),class:"btn btn-dark rounded-0"},[ws,m("Добавить расчётный счёт ")])]),(a(!0),d(f,null,h(o.form.requisites,(t,i)=>(a(),d("div",$s,[s("div",Cs,[s("div",Ds,[s("div",Ms,[n(s("input",{class:"form-check-input",onChange:r=>o.changeRequisitesMain(i),"onUpdate:modelValue":r=>o.form.requisites[i].is_main=r,type:"checkbox",role:"switch",id:"form-requisites-checking_account"+i,checked:""},null,40,Bs),[[q,o.form.requisites[i].is_main]]),s("label",{class:"form-check-label",for:"form-requisites-checking_account"+i}," Основной расчетный счёт ",8,Ss)]),s("a",{href:"javascript:void(0)",class:"btn btn-outline-secondary rounded-0",onClick:r=>o.removeRequisite(i)},[js,m(" Удалить")],8,Fs)]),s("div",Is,[s("div",Rs,[s("div",Ts,[s("div",Es,[s("div",Ls,[n(s("input",{type:"text",maxlength:"11","onUpdate:modelValue":r=>o.form.requisites[i].bik=r,class:"form-control",id:"form-requisites-bik"+i,required:""},null,8,Ns),[[c,o.form.requisites[i].bik]]),s("label",{for:"form-requisites-bik"+i},"БИК",8,Os)]),s("button",{type:"button",disabled:!o.form.requisites[i].bik,onClick:r=>o.requestByBik(i),class:"btn btn-outline-secondary rounded-0"},Js,8,As)])]),s("div",zs,[s("div",Hs,[n(s("input",{type:"text","onUpdate:modelValue":r=>o.form.requisites[i].bank=r,class:"form-control",id:"form-requisites-bank"+i},null,8,Ks),[[c,o.form.requisites[i].bank]]),s("label",{for:"form-requisites-bank"+i},"Банк",8,Ps)])]),s("div",Qs,[s("div",Ws,[n(s("input",{type:"text","onUpdate:modelValue":r=>o.form.requisites[i].address=r,class:"form-control",id:"form-requisites-address"+i},null,8,Xs),[[c,o.form.requisites[i].address]]),s("label",{for:"form-requisites-address"+i},"Адрес",8,Ys)])]),s("div",Zs,[s("div",xs,[n(s("input",{type:"text",maxlength:"20","onUpdate:modelValue":r=>o.form.requisites[i].correspondent_account=r,class:"form-control",id:"form-requisites-correspondent_account"+i},null,8,so),[[c,o.form.requisites[i].correspondent_account]]),s("label",{for:"form-requisites-correspondent_account"+i},"Кор.счёт",8,oo)])]),s("div",eo,[s("div",to,[n(s("input",{type:"text","onUpdate:modelValue":r=>o.form.requisites[i].checking_account=r,maxlength:"20",class:"form-control",id:"form-requisites-checking_account"+i,required:""},null,8,lo),[[c,o.form.requisites[i].checking_account]]),s("label",{for:"form-requisites-checking_account"+i},"Расчетный счет",8,io)])])])])])]))),256))]),s("div",no,[s("div",ro,[o.messages.length>0?(a(!0),d(f,{key:0},h(o.messages,(t,i)=>(a(),d("div",ao,[co,m(" "+_(t||"Ошибка")+" ",1),s("button",{type:"button",class:"btn-close",onClick:r=>o.removeMessage(i)},null,8,uo)]))),256)):u("",!0)])]),s("div",mo,[s("div",fo,[s("button",ho,[o.loading?(a(),d("span",po)):(a(),d("i",_o)),m(" Сохранить клиента ")]),!o.loading&&!l.editing?(a(),d("button",{key:0,type:"button",onClick:e[16]||(e[16]=(...t)=>o.resetForm&&o.resetForm(...t)),class:"btn btn-outline-secondary rounded-0 ml-2"},[bo,m(" Очистить клиента ")])):u("",!0)])])],32),s("div",ko,[s("div",vo,[s("div",go,[yo,s("div",qo,[y(U,{"for-select":!0,onSelect:o.selectUserId},null,8,["onSelect"])]),Uo])])])],64)}}});export{Do as _};
