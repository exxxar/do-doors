import{_ as A}from"./AuthenticatedLayout-C8yA_DUM.js";import{m as C,o,c as l,b as t,g as m,v as O,f as a,e as d,F as _,r as f,t as r,d as p,q as I,a as b,w as k,u as D,s as w,p as T,h as E,Z as M}from"./app-O5Q0GFN0.js";import{P as j}from"./Pagination-1togWoqE.js";import{_ as V}from"./CalcPreview-BoC7opJ2.js";import{D as B}from"./DownloadDocumentForm-m2Ch3Z-d.js";import{_ as P}from"./ClientForm-C7Huzqfd.js";import{E as L}from"./main-DpMMOfVs.js";import"./ApplicationLogo-nRanF_iW.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IndividualDataForm-ujEXQDpl.js";import"./vue-the-mask-B735Myrw.js";import"./DoorItemEditor-Bim17LhK.js";import"./RalColorSelector--hcxjGF2.js";import"./HandleDetail-CPNxDnt8.js";import"./UserTable--Won4wHb.js";import"./RoleTable-HfskJAu9.js";import"./PermissionTable-CdCK4hUR.js";const z={class:"row"},F={class:"col-12"},S={class:"input-group mb-3"},U={class:"form-floating"},N=t("label",{for:"search-orderDetails"},"Поиск по деталям заказа",-1),R=t("i",{class:"fa-solid fa-magnifying-glass"},null,-1),q=[R],K={class:"d-flex scrollable-area"},G={key:0,class:"table"},Z={key:0},H=t("i",{class:"fa-solid fa-caret-down"},null,-1),J=[H],Q={key:1},W=t("i",{class:"fa-solid fa-caret-up"},null,-1),X=[W],Y={key:0},x=t("i",{class:"fa-solid fa-caret-down"},null,-1),ee=[x],te={key:1},se=t("i",{class:"fa-solid fa-caret-up"},null,-1),oe=[se],ne={key:0},le=t("i",{class:"fa-solid fa-caret-down"},null,-1),de=[le],ie={key:1},ae=t("i",{class:"fa-solid fa-caret-up"},null,-1),re=[ae],ce={key:0},ue=t("i",{class:"fa-solid fa-caret-down"},null,-1),_e=[ue],he={key:1},pe=t("i",{class:"fa-solid fa-caret-up"},null,-1),me=[pe],fe={key:0},be=t("i",{class:"fa-solid fa-caret-down"},null,-1),ke=[be],ve={key:1},ge=t("i",{class:"fa-solid fa-caret-up"},null,-1),$e=[ge],ye={key:0},we=t("i",{class:"fa-solid fa-caret-down"},null,-1),Ce=[we],Oe={key:1},De=t("i",{class:"fa-solid fa-caret-up"},null,-1),je=[De],Le={key:0},Ae=t("i",{class:"fa-solid fa-caret-down"},null,-1),Ie=[Ae],Te={key:1},Ee=t("i",{class:"fa-solid fa-caret-up"},null,-1),Me=[Ee],Ve={key:0},Be=t("i",{class:"fa-solid fa-caret-down"},null,-1),Pe=[Be],ze={key:1},Fe=t("i",{class:"fa-solid fa-caret-up"},null,-1),Se=[Fe],Ue=t("th",{scope:"col",class:"text-center"},"Действие",-1),Ne={scope:"row"},Re=["onClick"],qe={class:"text-center"},Ke={class:"text-center"},Ge={class:"text-center"},Ze={class:"text-center"},He={class:"text-center"},Je={class:"text-center"},Qe={class:"text-center"},We={class:"dropdown"},Xe=t("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-bars"})],-1),Ye={class:"dropdown-menu"},xe=["onClick"],et=t("i",{class:"fa-solid fa-pen mr-2"},null,-1),tt=["onClick"],st=t("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),ot={key:0,class:"alert alert-success",role:"alert"},nt=t("h4",{class:"alert-heading"},"Детали заказа",-1),lt=t("p",null,"К сожалению,в данном заказе нет деталей заказа",-1),dt=[nt,lt],it={key:1,class:"row mb-3"},at={class:"col-12"},rt={props:["orderId"],data(){return{sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...C(["getOrderDetails","getOrderDetailsPaginateObject"])},mounted(){this.loadOrderDetails()},methods:{sortAndLoad(i){this.sort.column=i,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadOrderDetails(this.current_page)},loadOrderDetails(i=0){this.current_page=i,this.$store.dispatch("loadOrderDetails",{dataObject:{order_id:this.orderId,search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(e=>{this.items=this.getOrderDetails,this.paginate_object=this.getOrderDetailsPaginateObject}).catch(()=>{this.loading=!1})},selectItem(i){this.$emit("select",i)},duplicateItem(i){this.$store.dispatch("duplicateOrderDetail",{orderDetailId:i}).then(()=>{this.sortAndLoad("id")})},removeItem(i){this.$store.dispatch("removeOrderDetail",{orderDetailId:i}).then(()=>{this.sortAndLoad("id")})}}},ct=Object.assign(rt,{__name:"OrderDetailTable",setup(i){return(e,n)=>(o(),l(_,null,[t("form",z,[t("div",F,[t("div",S,[t("div",U,[m(t("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=s=>e.search=s),class:"form-control",id:"search-orderDetails"},null,512),[[O,e.search]]),N]),t("button",{type:"button",onClick:n[1]||(n[1]=s=>e.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},q)])])]),t("div",K,[e.items.length>0?(o(),l("table",G,[t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"cursor-pointer",onClick:n[2]||(n[2]=s=>e.sortAndLoad("id"))},[a("# "),e.sort.direction==="desc"&&e.sort.column==="id"?(o(),l("span",Z,J)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="id"?(o(),l("span",Q,X)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[3]||(n[3]=s=>e.sortAndLoad("door_type"))},[a("Тип двери "),e.sort.direction==="desc"&&e.sort.column==="door_type"?(o(),l("span",Y,ee)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="door_type"?(o(),l("span",te,oe)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[4]||(n[4]=s=>e.sortAndLoad("count"))},[a("Кол-во "),e.sort.direction==="desc"&&e.sort.column==="count"?(o(),l("span",ne,de)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="count"?(o(),l("span",ie,re)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[5]||(n[5]=s=>e.sortAndLoad("price"))},[a("Цена "),e.sort.direction==="desc"&&e.sort.column==="price"?(o(),l("span",ce,_e)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="price"?(o(),l("span",he,me)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[6]||(n[6]=s=>e.sortAndLoad("comment"))},[a("Комментарий "),e.sort.direction==="desc"&&e.sort.column==="comment"?(o(),l("span",fe,ke)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="comment"?(o(),l("span",ve,$e)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[7]||(n[7]=s=>e.sortAndLoad("purpose"))},[a("Назначение двери "),e.sort.direction==="desc"&&e.sort.column==="purpose"?(o(),l("span",ye,Ce)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="purpose"?(o(),l("span",Oe,je)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[8]||(n[8]=s=>e.sortAndLoad("door"))},[a("Параметры двери "),e.sort.direction==="desc"&&e.sort.column==="door"?(o(),l("span",Le,Ie)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="door"?(o(),l("span",Te,Me)):d("",!0)]),t("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[9]||(n[9]=s=>e.sortAndLoad("updated_at"))},[a(" Дата изменения "),e.sort.direction==="desc"&&e.sort.column==="updated_at"?(o(),l("span",Ve,Pe)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="updated_at"?(o(),l("span",ze,Se)):d("",!0)]),Ue])]),t("tbody",null,[(o(!0),l(_,null,f(e.items,(s,c)=>(o(),l("tr",null,[t("th",Ne,r(s.id||c),1),t("td",{class:"text-center",onClick:h=>e.selectItem(s)},r(s.door_type||"-"),9,Re),t("td",qe,r(s.count||0),1),t("td",Ke,r(s.price||0),1),t("td",Ge,r(s.comment||"-"),1),t("td",Ze,r(s.purpose||"-"),1),t("td",He,r(s.door||"-"),1),t("td",Je,r(s.updated_at||"-"),1),t("td",Qe,[t("div",We,[Xe,t("ul",Ye,[t("li",null,[t("a",{class:"dropdown-item",onClick:h=>e.selectItem(s),href:"javascript:void(0)"},[et,a("Редактировать")],8,xe)]),t("li",null,[t("a",{class:"dropdown-item text-danger",onClick:h=>e.removeItem(s.id),href:"javascript:void(0)"},[st,a("Удалить")],8,tt)])])])])]))),256))])])):d("",!0)]),e.items.length===0?(o(),l("div",ot,dt)):d("",!0),e.items.length>0?(o(),l("div",it,[t("div",at,[e.paginate_object?(o(),p(j,{key:0,onPagination_page:e.loadOrderDetails,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0)],64))}}),ut={class:"row"},_t={class:"col-12"},ht={class:"input-group mb-3"},pt={class:"form-floating"},mt=t("label",{for:"search-orders"},"Поиск по заказам",-1),ft={class:"dropdown"},bt=t("button",{class:"btn btn-outline-secondary rounded-0 h-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-up-right-and-down-left-from-center"})],-1),kt={class:"dropdown-menu"},vt=t("i",{class:"fa-solid fa-magnifying-glass"},null,-1),gt=t("i",{class:"fa-regular fa-file-excel"},null,-1),$t={class:"col-12"},yt={class:"action-row"},wt=["onClick"],Ct=["onClick"],Ot={class:"col-12 mb-2"},Dt=["onClick"],jt=t("i",{class:"fa-solid fa-retweet"},null,-1),Lt=[jt],At=t("i",{class:"fa-solid fa-xmark"},null,-1),It=[At],Tt={class:"col-12"},Et={class:"my-3"},Mt=["onClick"],Vt=t("i",{class:"fa-solid fa-xmark"},null,-1),Bt=[Vt],Pt={class:"d-flex flex-wrap"},zt={key:1,class:"my-2 small italic"},Ft={class:"d-flex scrollable-area"},St={key:0,class:"table"},Ut={key:0},Nt=t("i",{class:"fa-solid fa-caret-down"},null,-1),Rt=[Nt],qt={key:1},Kt=t("i",{class:"fa-solid fa-caret-up"},null,-1),Gt=[Kt],Zt=t("th",{scope:"col",class:"text-center"},"Действие",-1),Ht={key:0},Jt=t("i",{class:"fa-solid fa-caret-down"},null,-1),Qt=[Jt],Wt={key:1},Xt=t("i",{class:"fa-solid fa-caret-up"},null,-1),Yt=[Xt],xt={key:0},es=t("i",{class:"fa-solid fa-caret-down"},null,-1),ts=[es],ss={key:1},os=t("i",{class:"fa-solid fa-caret-up"},null,-1),ns=[os],ls={key:0},ds=t("i",{class:"fa-solid fa-caret-down"},null,-1),is=[ds],as={key:1},rs=t("i",{class:"fa-solid fa-caret-up"},null,-1),cs=[rs],us={key:0},_s=t("i",{class:"fa-solid fa-caret-down"},null,-1),hs=[_s],ps={key:1},ms=t("i",{class:"fa-solid fa-caret-up"},null,-1),fs=[ms],bs={key:0},ks=t("i",{class:"fa-solid fa-caret-down"},null,-1),vs=[ks],gs={key:1},$s=t("i",{class:"fa-solid fa-caret-up"},null,-1),ys=[$s],ws={key:0},Cs=t("i",{class:"fa-solid fa-caret-down"},null,-1),Os=[Cs],Ds={key:1},js=t("i",{class:"fa-solid fa-caret-up"},null,-1),Ls=[js],As={key:0},Is=t("i",{class:"fa-solid fa-caret-down"},null,-1),Ts=[Is],Es={key:1},Ms=t("i",{class:"fa-solid fa-caret-up"},null,-1),Vs=[Ms],Bs={key:0},Ps=t("i",{class:"fa-solid fa-caret-down"},null,-1),zs=[Ps],Fs={key:1},Ss=t("i",{class:"fa-solid fa-caret-up"},null,-1),Us=[Ss],Ns={key:0},Rs=t("i",{class:"fa-solid fa-caret-down"},null,-1),qs=[Rs],Ks={key:1},Gs=t("i",{class:"fa-solid fa-caret-up"},null,-1),Zs=[Gs],Hs={key:0},Js=t("i",{class:"fa-solid fa-caret-down"},null,-1),Qs=[Js],Ws={key:1},Xs=t("i",{class:"fa-solid fa-caret-up"},null,-1),Ys=[Xs],xs={key:0},eo=t("i",{class:"fa-solid fa-caret-down"},null,-1),to=[eo],so={key:1},oo=t("i",{class:"fa-solid fa-caret-up"},null,-1),no=[oo],lo={key:0},io=t("i",{class:"fa-solid fa-caret-down"},null,-1),ao=[io],ro={key:1},co=t("i",{class:"fa-solid fa-caret-up"},null,-1),uo=[co],_o={key:0},ho=t("i",{class:"fa-solid fa-caret-down"},null,-1),po=[ho],mo={key:1},fo=t("i",{class:"fa-solid fa-caret-up"},null,-1),bo=[fo],ko={scope:"row"},vo={class:"form-check"},go=["value","id"],$o=["for"],yo={class:"text-center"},wo={class:"dropdown"},Co=t("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-bars"})],-1),Oo={class:"dropdown-menu"},Do=["onClick"],jo=t("i",{class:"fa-solid fa-pen mr-2"},null,-1),Lo=t("li",null,[t("hr",{class:"dropdown-divider"})],-1),Ao=["onClick"],Io=t("i",{class:"fa-solid fa-paper-plane mr-2"},null,-1),To=["onClick"],Eo=t("i",{class:"fa-solid fa-square-arrow-up-right mr-2"},null,-1),Mo=["onClick"],Vo=t("i",{class:"fa-solid fa-envelope mr-2"},null,-1),Bo=t("li",null,[t("hr",{class:"dropdown-divider"})],-1),Po=["href"],zo=t("i",{class:"fa-regular fa-file-excel mr-2"},null,-1),Fo=["onClick"],So=t("i",{class:"fa-solid fa-file-signature mr-2"},null,-1),Uo=t("li",null,[t("hr",{class:"dropdown-divider"})],-1),No=["onClick"],Ro=t("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),qo=["onClick"],Ko=["onClick"],Go={key:2,class:"text-center"},Zo={key:3,class:"text-center"},Ho=["onClick"],Jo={key:0},Qo={key:4,class:"text-center"},Wo={key:0},Xo={key:1},Yo={key:5,class:"text-center"},xo={key:6,class:"text-center"},en={key:7,class:"text-center"},tn={key:8,class:"text-center"},sn={key:9,class:"text-center"},on={key:10,class:"text-center"},nn={key:11,class:"text-center"},ln={key:12,class:"text-center"},dn={key:2,class:"alert alert-success rounded-0",role:"alert"},an=t("h4",{class:"alert-heading"},"Заказы",-1),rn=t("p",null,"К сожалению, раздел заказов пуст.",-1),cn=[an,rn],un={key:3,class:"row mb-3"},_n={class:"col-12"},hn={class:"modal fade",id:"client-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},pn={class:"modal-dialog modal-lg"},mn={class:"modal-content rounded-0"},fn={class:"modal-body"},bn={class:"modal fade",id:"order-details",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},kn={class:"modal-dialog modal-fullscreen"},vn={class:"modal-content"},gn=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Детали заказа"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},[t("i",{class:"fa-solid fa-xmark"})])],-1),$n={class:"modal-body"},yn=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary rounded-0","data-bs-dismiss":"modal"},"Закрыть ")],-1),wn={class:"modal fade",id:"confirm-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Cn={class:"modal-dialog modal-dialog-centered"},On={class:"modal-content rounded-0"},Dn={class:"modal-body"},jn=t("div",{class:"d-flex justify-center p-3"},[t("img",{src:"/images/logo.png",style:{width:"100px"},alt:""})],-1),Ln={class:"font-bold text-center py-3"},An={class:"text-center pb-3"},In={class:"row mb-3"},Tn={class:"col-md-6 d-flex justify-center"},En={class:"form-check"},Mn=t("label",{class:"form-check-label",for:"work-with-nds"}," Работаю с НДС ",-1),Vn={class:"col-md-6 d-flex justify-center"},Bn={class:"form-check"},Pn=t("label",{class:"form-check-label",for:"work-without-nds"}," Работаю без НДС ",-1),zn={class:"row"},Fn={class:"col-6"},Sn={class:"col-6"},Un={class:"modal fade",id:"order-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Nn={class:"modal-dialog modal-xl"},Rn={class:"modal-content rounded-0"},qn={class:"modal-body"},Kn={components:{VueDatePicker:L},data(){return{selected_client_item:null,editor_modal:null,selected_orders:[],selected_item:null,organization_forms:{individual:"ИП",legal_entity:"ООО",phys:"ФЛ"},table:{contract_number:{title:"Номер договора",value:!0},contract_date:{title:"Дата договора",value:!0},completion_at:{title:"Дата закрытия",value:!0},client_id:{title:"Идентификатор клиента",value:!0},status:{title:"Статус",value:!0},source:{title:"Источник",value:!0},contact_person:{title:"Контактное лицо",value:!0},phone:{title:"Номер телефона",value:!0},organizational_form:{title:"Организационная форма",value:!0},contract_amount:{title:"Сумма договора",value:!0},paid:{title:"Оплачено",value:!0},debt:{title:"Остаток",value:!0},profit:{title:"Доход",value:!0}},sort:{column:null,date:null,direction:"desc"},selected_order:null,order_detail_modal:null,order_status:["Новый заказ","В работе","Завершен"],search:null,current_page:0,paginate_object:null,loading:!1,confirm_modal:null,confirm:{title:null,message:null,work_with_nds:1,item:null},items:[{id:null,contract_number:null,contract_date:null,completion_at:null,client_id:null,status:null,source:null,contact_person:null,phone:null,organizational_form:null,contract_amount:null,paid:null,debt:null,profit:null}]}},computed:{...C(["getOrders","getOrdersPaginateObject"])},mounted(){this.loadOrders(),this.order_detail_modal=new bootstrap.Modal(document.getElementById("order-details"),{}),this.confirm_modal=new bootstrap.Modal(document.getElementById("confirm-modal"),{}),this.editor_modal=new bootstrap.Modal(document.getElementById("order-editor-modal"),{}),this.client_editor_modal=new bootstrap.Modal(document.getElementById("client-editor-modal"),{})},methods:{selectClient(i){if(i==null){this.selected_client_item=null,this.client_editor_modal.hide();return}this.selected_client_item=null,this.$nextTick(()=>{this.selected_client_item=i,this.client_editor_modal.show()})},getStatusByOrgForm(i){let e=this.organization_forms[i]||!1;return e||"Новый клиент"},selectOrder(i){let e=this.selected_orders.findIndex(n=>n===i);e===-1?this.selected_orders.push(i):this.selected_orders.splice(e,1)},resetColumns(){Object.keys(this.table).forEach(i=>{this.table[i].value=!0})},changeColumns(i){i?this.table[i].value=!this.table[i].value:Object.keys(this.table).forEach(e=>{this.table[e].value=!this.table[e].value})},openConfirmModal(i,e,n){this.confirm.title=i||null,this.confirm.message=e||null,this.confirm.item=n||null,this.confirm_modal.show()},sortAndLoad(i){this.sort.column=i,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadOrders(this.current_page)},downloadSelectedOrders(){let i=this.sort,e=(i.date||[]).length>0?new Date(i.date[0]).getTime():null,n=(i.date||[]).length>1?new Date(i.date[1]).getTime():null,s=`/orders/download-filtered-orders?order=id&ids=${this.selected_orders.join(",")}&type=multiply`;e&&n&&(s+=`&df=${e}&dt=${n}`),this.search&&(s+=`&search=${this.search||null}`),window.open(s,"_blank").focus()},filteredDownload(){let i=this.sort,e=(i.date||[]).length>0?new Date(i.date[0]).getTime():null,n=(i.date||[]).length>1?new Date(i.date[1]).getTime():null,s="/orders/download-filtered-orders?order=id";e&&n&&(s+=`&df=${e}&dt=${n}`),this.search&&(s+=`&search=${this.search||null}`),window.open(s,"_blank").focus()},sendOrder(i,e=!1,n=!1,s=!1){this.$store.dispatch("sendOrderToBitrix",{order_id:i.id,send_to_telegram:n,send_to_email:e,send_to_bitrix:s}).then(()=>{this.$notify({title:"DoDoors",text:"Информация успешно отправлена в Битрикс",type:"success"})}).catch(()=>{this.$notify({title:"DoDoors",text:"Ошибка отправки информации в Битрикс",type:"error"})})},sendToBitrix(i){this.sendOrder(i,!1,!1,!0)},sendToTelegram(i){this.sendOrder(i,!1,!0,!1)},sendToEmail(i){this.sendOrder(i,!0,!1,!1)},downloadDocument(i){window.open(`/orders/download-contract?id=${i.id}`,"_blank").focus()},loadOrders(i=0){this.current_page=i;let e=this.sort,n=(e.date||[]).length>0?e.date[0]:null,s=(e.date||[]).length>1?e.date[1]:null;this.$store.dispatch("loadOrders",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction,df:n||null,dt:s||null},page:this.current_page}).then(c=>{this.items=this.getOrders,this.paginate_object=this.getOrdersPaginateObject}).catch(()=>{this.loading=!1})},selectItemForEdit(i){window.open("/link/"+i.id,"_blank")},selectItem(i){this.loading=!0,this.selected_order=i,this.$nextTick(()=>{this.loading=!1,this.order_detail_modal.show()})},duplicateItem(i){this.$store.dispatch("duplicateOrder",{materialId:i}).then(()=>{this.sortAndLoad("id")})},removeItem(i){this.$store.dispatch("removeOrder",{orderId:i}).then(()=>{this.sortAndLoad("id")})}}},Gn=Object.assign(Kn,{__name:"OrderTable",setup(i){return(e,n)=>(o(),l(_,null,[t("div",ut,[t("div",_t,[t("div",ht,[t("div",pt,[m(t("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=s=>e.search=s),onKeydown:n[1]||(n[1]=I(s=>e.sortAndLoad("id"),["enter"])),class:"form-control",id:"search-orders"},null,544),[[O,e.search]]),mt]),t("div",ft,[bt,t("ul",kt,[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:n[2]||(n[2]=s=>e.sortAndLoad("id"))},[vt,a(" Искать")])]),t("li",null,[t("a",{class:"dropdown-item",onClick:n[3]||(n[3]=(...s)=>e.filteredDownload&&e.filteredDownload(...s)),href:"javascript:void(0)"},[gt,a(" Скачать в Excel ")])])])])])]),t("div",$t,[b(D(L),{class:"rounded-0",locale:"ru",range:"","multi-calendars":"",modelValue:e.sort.date,"onUpdate:modelValue":n[4]||(n[4]=s=>e.sort.date=s)},{"action-row":k(({internalModelValue:s,selectDate:c,closePicker:h})=>[t("div",yt,[t("button",{class:"btn btn-dark rounded-0 mr-2",onClick:c},"Выбрать",8,wt),t("button",{class:"btn btn-outline-secondary rounded-0",onClick:h},"Закрыть",8,Ct)])]),_:1},8,["modelValue"])]),t("div",Ot,[(o(!0),l(_,null,f(Object.keys(e.table),s=>(o(),l("span",{class:T(["badge mr-1 rounded-0 cursor-pointer",{"bg-dark":e.table[s].value===!0,"bg-secondary":e.table[s].value===!1}]),onClick:c=>e.changeColumns(s)},r(e.table[s].title||"-"),11,Dt))),256)),t("span",{onClick:n[5]||(n[5]=s=>e.changeColumns(null)),class:"badge mr-1 bg-danger rounded-0 cursor-pointer"},Lt),t("span",{onClick:n[6]||(n[6]=(...s)=>e.resetColumns&&e.resetColumns(...s)),class:"badge mr-1 bg-secondary rounded-0 cursor-pointer"},It)]),t("div",Tt,[b(B,null,{name:k(()=>[a(" Скачать договор по номеру заказа ")]),_:1})])]),e.selected_orders.length>0?(o(),l(_,{key:0},[t("p",Et,[a("Выбрано "),t("span",null,"("+r(e.selected_orders.length)+")",1),a(" элементов: "),(o(!0),l(_,null,f(e.selected_orders,s=>(o(),l("span",{onClick:c=>e.selectOrder(s),class:"badge mr-1 bg-dark rounded-0 cursor-pointer"},r(s),9,Mt))),256)),t("span",{onClick:n[7]||(n[7]=s=>e.selected_orders=[]),class:"badge mr-1 bg-secondary rounded-0 cursor-pointer"},Bt)]),t("div",Pt,[t("button",{onClick:n[8]||(n[8]=(...s)=>e.downloadSelectedOrders&&e.downloadSelectedOrders(...s)),type:"button",class:"btn btn-dark rounded-0 mr-2"},"Скачать эксель ")])],64)):d("",!0),e.paginate_object?(o(),l("p",zt,[a("Найдено результатов "),t("strong",null,r(e.paginate_object.meta.total),1)])):d("",!0),t("div",Ft,[e.items.length>0?(o(),l("table",St,[t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"cursor-pointer",onClick:n[9]||(n[9]=s=>e.sortAndLoad("id"))},[a("# "),e.sort.direction==="desc"&&e.sort.column==="id"?(o(),l("span",Ut,Rt)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="id"?(o(),l("span",qt,Gt)):d("",!0)]),Zt,e.table.contract_number.value?(o(),l("th",{key:0,scope:"col",class:"text-center cursor-pointer",onClick:n[10]||(n[10]=s=>e.sortAndLoad("contract_number"))},[a("Номер договора "),e.sort.direction==="desc"&&e.sort.column==="contract_number"?(o(),l("span",Ht,Qt)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contract_number"?(o(),l("span",Wt,Yt)):d("",!0)])):d("",!0),e.table.contract_date.value?(o(),l("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:n[11]||(n[11]=s=>e.sortAndLoad("contract_date"))},[a("Дата договора "),e.sort.direction==="desc"&&e.sort.column==="contract_date"?(o(),l("span",xt,ts)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contract_date"?(o(),l("span",ss,ns)):d("",!0)])):d("",!0),e.table.completion_at.value?(o(),l("th",{key:2,scope:"col",class:"text-center cursor-pointer",onClick:n[12]||(n[12]=s=>e.sortAndLoad("completion_at"))},[a("Дата закрытия "),e.sort.direction==="desc"&&e.sort.column==="completion_at"?(o(),l("span",ls,is)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="completion_at"?(o(),l("span",as,cs)):d("",!0)])):d("",!0),e.table.client_id.value?(o(),l("th",{key:3,scope:"col",class:"text-center cursor-pointer",onClick:n[13]||(n[13]=s=>e.sortAndLoad("client_id"))},[a("Клиент "),e.sort.direction==="desc"&&e.sort.column==="client_id"?(o(),l("span",us,hs)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="client_id"?(o(),l("span",ps,fs)):d("",!0)])):d("",!0),e.table.status.value?(o(),l("th",{key:4,scope:"col",class:"text-center cursor-pointer",onClick:n[14]||(n[14]=s=>e.sortAndLoad("status"))},[a("Статус заказа "),e.sort.direction==="desc"&&e.sort.column==="status"?(o(),l("span",bs,vs)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="status"?(o(),l("span",gs,ys)):d("",!0)])):d("",!0),e.table.source.value?(o(),l("th",{key:5,scope:"col",class:"text-center cursor-pointer",onClick:n[15]||(n[15]=s=>e.sortAndLoad("source"))},[a("Источник "),e.sort.direction==="desc"&&e.sort.column==="source"?(o(),l("span",ws,Os)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="source"?(o(),l("span",Ds,Ls)):d("",!0)])):d("",!0),e.table.contact_person.value?(o(),l("th",{key:6,scope:"col",class:"text-center cursor-pointer",onClick:n[16]||(n[16]=s=>e.sortAndLoad("contact_person"))},[a("Контактное лицо "),e.sort.direction==="desc"&&e.sort.column==="contact_person"?(o(),l("span",As,Ts)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contact_person"?(o(),l("span",Es,Vs)):d("",!0)])):d("",!0),e.table.phone.value?(o(),l("th",{key:7,scope:"col",class:"text-center cursor-pointer",onClick:n[17]||(n[17]=s=>e.sortAndLoad("phone"))},[a("Телефон "),e.sort.direction==="desc"&&e.sort.column==="phone"?(o(),l("span",Bs,zs)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="phone"?(o(),l("span",Fs,Us)):d("",!0)])):d("",!0),e.table.organizational_form.value?(o(),l("th",{key:8,scope:"col",class:"text-center cursor-pointer",onClick:n[18]||(n[18]=s=>e.sortAndLoad("organizational_form"))},[a("На ип\\ооо "),e.sort.direction==="desc"&&e.sort.column==="organizational_form"?(o(),l("span",Ns,qs)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="organizational_form"?(o(),l("span",Ks,Zs)):d("",!0)])):d("",!0),e.table.contract_amount.value?(o(),l("th",{key:9,scope:"col",class:"text-center cursor-pointer",onClick:n[19]||(n[19]=s=>e.sortAndLoad("contract_amount"))},[a("Сумма договора "),e.sort.direction==="desc"&&e.sort.column==="contract_amount"?(o(),l("span",Hs,Qs)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="contract_amount"?(o(),l("span",Ws,Ys)):d("",!0)])):d("",!0),e.table.paid.value?(o(),l("th",{key:10,scope:"col",class:"text-center cursor-pointer",onClick:n[20]||(n[20]=s=>e.sortAndLoad("paid"))},[a("Оплачено "),e.sort.direction==="desc"&&e.sort.column==="paid"?(o(),l("span",xs,to)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="paid"?(o(),l("span",so,no)):d("",!0)])):d("",!0),e.table.debt.value?(o(),l("th",{key:11,scope:"col",class:"text-center cursor-pointer",onClick:n[21]||(n[21]=s=>e.sortAndLoad("debt"))},[a("Задолженность "),e.sort.direction==="desc"&&e.sort.column==="debt"?(o(),l("span",lo,ao)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="debt"?(o(),l("span",ro,uo)):d("",!0)])):d("",!0),e.table.profit.value?(o(),l("th",{key:12,scope:"col",class:"text-center cursor-pointer",onClick:n[22]||(n[22]=s=>e.sortAndLoad("profit"))},[a("Прибыль "),e.sort.direction==="desc"&&e.sort.column==="profit"?(o(),l("span",_o,po)):d("",!0),e.sort.direction==="asc"&&e.sort.column==="profit"?(o(),l("span",mo,bo)):d("",!0)])):d("",!0)])]),t("tbody",null,[(o(!0),l(_,null,f(e.items,(s,c)=>{var h,v,g,$,y;return o(),l("tr",null,[t("th",ko,[t("div",vo,[m(t("input",{value:s.id,"onUpdate:modelValue":n[23]||(n[23]=u=>e.selected_orders=u),class:"form-check-input",type:"checkbox",id:"order-check-"+c},null,8,go),[[E,e.selected_orders]]),t("label",{class:"form-check-label",for:"order-check-"+c},r(s.id||c),9,$o)])]),t("td",yo,[t("div",wo,[Co,t("ul",Oo,[t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.selectItemForEdit(s),href:"javascript:void(0)"},[jo,a("Редактор заказа [дверей в заказе "+r(((h=s.details)==null?void 0:h.length)||0)+" ед.] ",1)],8,Do)]),Lo,t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.sendToTelegram(s),href:"javascript:void(0)"},[Io,a(" Отправить в телеграм ")],8,Ao)]),t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.sendToBitrix(s),href:"javascript:void(0)"},[Eo,a(" Отправить в Битрикс ")],8,To)]),t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.sendToEmail(s),href:"javascript:void(0)"},[Vo,a(" Отправить на почту клиента ")],8,Mo)]),Bo,t("li",null,[t("a",{class:"dropdown-item",target:"_blank",href:"/orders/download-order-excel/"+s.id},[zo,a("Скачать Excel-документ по заказу")],8,Po)]),t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.downloadDocument(s),href:"javascript:void(0)"},[So,a("Скачать договор")],8,Fo)]),Uo,t("li",null,[t("a",{class:"dropdown-item text-danger",onClick:u=>e.removeItem(s.id),href:"javascript:void(0)"},[Ro,a("Удалить")],8,No)])])])]),e.table.contract_number.value?(o(),l("td",{key:0,class:"text-center",onClick:u=>e.selectItem(s)},r(s.contract_number||"-"),9,qo)):d("",!0),e.table.contract_date.value?(o(),l("td",{key:1,class:"text-center",onClick:u=>e.selectItem(s)},r(s.contract_date||"-"),9,Ko)):d("",!0),e.table.completion_at.value?(o(),l("td",Go,r(s.completion_at||"-"),1)):d("",!0),e.table.client_id.value?(o(),l("td",Zo,[t("a",{class:"btn btn-link",onClick:u=>e.selectClient(s.client),href:"javascript:void(0)"},[a(r(((v=s.client)==null?void 0:v.title)||"-")+" ",1),((g=s.client)==null?void 0:g.title)!==(($=s.client)==null?void 0:$.fio)?(o(),l("span",Jo," ( "+r(((y=s.client)==null?void 0:y.fio)||"-")+") ",1)):d("",!0)],8,Ho)])):d("",!0),e.table.status.value?(o(),l("td",Qo,[(s.status||0)<=2?(o(),l("span",Wo,r(e.order_status[s.status]),1)):(o(),l("span",Xo,"Не указан"))])):d("",!0),e.table.source.value?(o(),l("td",Yo,r(s.source||"-"),1)):d("",!0),e.table.contact_person.value?(o(),l("td",xo,r(s.contact_person||"-"),1)):d("",!0),e.table.phone.value?(o(),l("td",en,r(s.phone||"-"),1)):d("",!0),e.table.organizational_form.value?(o(),l("td",tn,r(e.getStatusByOrgForm(s.organizational_form||"-")),1)):d("",!0),e.table.contract_amount.value?(o(),l("td",sn,r(s.contract_amount||0),1)):d("",!0),e.table.paid.value?(o(),l("td",on,r(s.paid||0),1)):d("",!0),e.table.debt.value?(o(),l("td",nn,r(s.debt||0),1)):d("",!0),e.table.profit.value?(o(),l("td",ln,r(s.profit||0),1)):d("",!0)])}),256))])])):d("",!0)]),e.items.length===0?(o(),l("div",dn,cn)):d("",!0),e.items.length>0?(o(),l("div",un,[t("div",_n,[e.paginate_object?(o(),p(j,{key:0,onPagination_page:e.loadOrders,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0),t("div",hn,[t("div",pn,[t("div",mn,[t("div",fn,[e.selected_client_item?(o(),p(P,{key:0,item:e.selected_client_item,onCallback:n[24]||(n[24]=s=>e.selectClient(null))},null,8,["item"])):d("",!0)])])])]),t("div",bn,[t("div",kn,[t("div",vn,[gn,t("div",$n,[e.selected_order&&!e.loading?(o(),p(ct,{key:0,"order-id":e.selected_order.id},null,8,["order-id"])):d("",!0)]),yn])])]),t("div",wn,[t("div",Cn,[t("div",On,[t("div",Dn,[jn,t("h3",Ln,r(e.confirm.title||"-"),1),t("p",An,r(e.confirm.message||"-"),1),t("div",In,[t("div",Tn,[t("div",En,[m(t("input",{class:"form-check-input",type:"radio",value:"1","onUpdate:modelValue":n[25]||(n[25]=s=>e.confirm.work_with_nds=s),name:"flexRadioDefault",id:"work-with-nds"},null,512),[[w,e.confirm.work_with_nds]]),Mn])]),t("div",Vn,[t("div",Bn,[m(t("input",{class:"form-check-input",type:"radio",value:"0",name:"flexRadioDefault","onUpdate:modelValue":n[26]||(n[26]=s=>e.confirm.work_with_nds=s),id:"work-without-nds"},null,512),[[w,e.confirm.work_with_nds]]),Pn])])]),t("div",zn,[t("div",Fn,[t("button",{class:"btn btn-dark rounded-0 w-100",type:"button",onClick:n[27]||(n[27]=(...s)=>e.downloadDocument&&e.downloadDocument(...s))},"Скачать договор ")]),t("div",Sn,[t("button",{class:"btn btn-outline-secondary rounded-0 w-100",onClick:n[28]||(n[28]=s=>e.confirm_modal.hide())}," Закрыть ")])])])])])]),t("div",Un,[t("div",Nn,[t("div",Rn,[t("div",qn,[e.selected_item?(o(),p(V,{key:0,"can-edit":!0,doors:e.selected_item.details,order:e.selected_item},null,8,["doors","order"])):d("",!0)])])])])],64))}}),Zn=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Заказы",-1),Hn={class:"py-12"},Jn={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Qn={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Wn={class:"p-6 text-gray-900"},Xn={data(){return{loading:!1,selectedOrder:null}},methods:{selectOrder(i){this.selectedOrder=i,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackOrderForm(){this.loading=!0,this.selectedOrder=null,this.$nextTick(()=>{this.loading=!1})}}},ml=Object.assign(Xn,{__name:"OrdersPage",setup(i){return(e,n)=>(o(),l(_,null,[b(D(M),{title:"Заказы"}),b(A,null,{header:k(()=>[Zn]),default:k(()=>[t("div",Hn,[t("div",Jn,[t("div",Qn,[t("div",Wn,[e.loading?d("",!0):(o(),p(Gn,{key:0,onSelect:e.selectOrder},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{ml as default};
