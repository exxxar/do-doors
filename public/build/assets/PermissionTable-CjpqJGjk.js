import{o as t,c as i,b as s,g as m,v as h,F as _,r as f,e as r,f as a,j as g,t as d,m as b,d as p}from"./app-DTYMgNlX.js";import{P as k}from"./Pagination-Bf_DsY1E.js";import"./RalColorSelector-DKoYYQlo.js";const y={class:"form-floating mb-3"},v=s("label",{for:"permission-code"},"Название разрешения",-1),$={class:"form-floating mb-3"},w=s("label",{for:"permission-code"},"Программный идентификатор разрешения",-1),P={class:"row"},C={class:"col-12"},j={class:"alert alert-danger alert-dismissible fade show",role:"alert"},F=s("strong",null,"Внимание!",-1),I=["onClick"],L={class:"row mt-5"},A={class:"col-12 d-flex justify-content-center"},S=["disabled"],D={key:0,class:"fa-regular fa-floppy-disk mr-1"},M={key:1,class:"spinner-border spinner-border-sm text-success"},O=s("i",{class:"fa-solid fa-xmark mr-1"},null,-1),V={props:["item"],data(){return{messages:[],loading:!1,form:{id:null,name:null,slug:null}}},computed:{needClearForm(){return this.form.id||this.form.name||this.form.slug}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,slug:this.item.slug||null,name:this.item.name||null}})},methods:{alert(n){this.messages.push(n)},resetForm(){this.form.id=null,this.form.name=null,this.form.slug=0,this.$emit("callback")},removeMessage(n){this.messages.splice(n,1)},submit(){this.$store.dispatch("storePermission",{permissionForm:this.form}).then(n=>{this.$notify({title:"DoDoors",text:"Роль успешно добавлена",type:"success"}),this.$emit("callback"),this.resetForm()}).catch(n=>{this.$notify({title:"DoDoors",text:"Ошибка добавления роли",type:"error"})})}}},B=Object.assign(V,{__name:"PermissionForm",setup(n){return(e,l)=>(t(),i("form",{action:"",onSubmit:l[3]||(l[3]=g((...o)=>e.submit&&e.submit(...o),["prevent"]))},[s("div",y,[m(s("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=o=>e.form.name=o),class:"form-control",id:"permission-name",required:""},null,512),[[h,e.form.name]]),v]),s("div",$,[m(s("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=o=>e.form.slug=o),class:"form-control",id:"permission-slug",required:""},null,512),[[h,e.form.slug]]),w]),s("div",P,[s("div",C,[e.messages.length>0?(t(!0),i(_,{key:0},f(e.messages,(o,c)=>(t(),i("div",j,[F,a(" "+d(o||"Ошибка")+" ",1),s("button",{type:"button",class:"btn-close",onClick:u=>e.removeMessage(c)},null,8,I)]))),256)):r("",!0)])]),s("div",L,[s("div",A,[s("button",{disabled:!e.needClearForm,class:"btn btn-dark rounded-0"},[e.loading?(t(),i("span",M)):(t(),i("i",D)),a(" Сохранить разрешения ")],8,S),e.needClearForm&&!e.loading?(t(),i("button",{key:0,type:"button",onClick:l[2]||(l[2]=(...o)=>e.resetForm&&e.resetForm(...o)),class:"btn btn-outline-secondary rounded-0 ml-2"},[O,a(" Очистить форму ")])):r("",!0)])])],32))}}),T={class:"row"},N={class:"col-12"},U={class:"input-group mb-3"},q={class:"form-floating"},E=s("label",{for:"search-permissions"},"Поиск по разрешениям",-1),G=s("i",{class:"fa-solid fa-magnifying-glass"},null,-1),z=[G],H={style:{"overflow-y":"auto"}},J={key:0,class:"table"},K={key:0},Q=s("i",{class:"fa-solid fa-caret-down"},null,-1),R=[Q],W={key:1},X=s("i",{class:"fa-solid fa-caret-up"},null,-1),Y=[X],Z={key:0,scope:"col",class:"text-center"},x={key:0},ss=s("i",{class:"fa-solid fa-caret-down"},null,-1),es=[ss],ts={key:1},os=s("i",{class:"fa-solid fa-caret-up"},null,-1),is=[os],ns={key:0},ls=s("i",{class:"fa-solid fa-caret-down"},null,-1),rs=[ls],as={key:1},ds=s("i",{class:"fa-solid fa-caret-up"},null,-1),cs=[ds],us={key:0},ms=s("i",{class:"fa-solid fa-caret-down"},null,-1),hs=[ms],_s={key:1},ps=s("i",{class:"fa-solid fa-caret-up"},null,-1),fs=[ps],gs={scope:"row"},bs={key:0,class:"text-center"},ks={class:"dropdown"},ys=s("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"fa-solid fa-bars"})],-1),vs={class:"dropdown-menu"},$s=["onClick"],ws=s("i",{class:"fa-solid fa-pen mr-2"},null,-1),Ps=["onClick"],Cs=s("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),js=["onClick"],Fs={key:0,class:"fa-solid fa-lock mr-2 color-danger"},Is={class:"text-center"},Ls={key:1,class:"text-center"},As={key:0,class:"alert alert-success rounded-0",role:"alert"},Ss=s("h4",{class:"alert-heading"},"Разрешения пользователей",-1),Ds=s("p",null,"К сожалению, раздел ролей пуст. Вы еще не добавили ни одной роли, которые можно отобразить на этой странице.",-1),Ms=s("hr",null,null,-1),Os=s("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свою первую роль",-1),Vs=[Ss,Ds,Ms,Os],Bs={key:1,class:"row mb-3"},Ts={class:"col-12"},Ns={class:"modal fade",id:"permission-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Us={class:"modal-dialog modal-lg"},qs={class:"modal-content rounded-0"},Es={class:"modal-body"},Gs={props:["forSelect","selected"],data(){return{sort:{column:null,direction:"desc"},search:null,editor_modal:null,selected_item:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...b(["getPermissions","getPermissionsPaginateObject"])},mounted(){this.loadPermissions(),this.editor_modal=new bootstrap.Modal(document.getElementById("permission-editor-modal"),{})},methods:{sortAndLoad(n){this.sort.column=n,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadPermissions(this.current_page)},loadPermissions(n=0){this.current_page=n,this.$store.dispatch("loadPermissions",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(e=>{this.items=this.getPermissions,this.paginate_object=this.getPermissionsPaginateObject}).catch(()=>{this.loading=!1})},selectItem(n){if(n==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=n,this.editor_modal.show()})},duplicateItem(n){this.$store.dispatch("duplicatePermission",{permissionId:n}).then(()=>{this.sortAndLoad("id")})},removeItem(n){this.$store.dispatch("removePermission",{permissionId:n}).then(()=>{this.sortAndLoad("id")})}}},Ks=Object.assign(Gs,{__name:"PermissionTable",setup(n){return(e,l)=>(t(),i(_,null,[s("form",T,[s("div",N,[s("div",U,[s("div",q,[m(s("input",{type:"search","onUpdate:modelValue":l[0]||(l[0]=o=>e.search=o),class:"form-control",id:"search-permissions"},null,512),[[h,e.search]]),E]),s("button",{type:"button",onClick:l[1]||(l[1]=o=>e.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},z)])])]),s("div",H,[e.items.length>0?(t(),i("table",J,[s("thead",null,[s("tr",null,[s("th",{scope:"col",class:"cursor-pointer",onClick:l[2]||(l[2]=o=>e.sortAndLoad("id"))},[a("# "),e.sort.direction==="desc"&&e.sort.column==="id"?(t(),i("span",K,R)):r("",!0),e.sort.direction==="asc"&&e.sort.column==="id"?(t(),i("span",W,Y)):r("",!0)]),n.forSelect?r("",!0):(t(),i("th",Z,"Действие")),s("th",{scope:"col",class:"text-center cursor-pointer",onClick:l[3]||(l[3]=o=>e.sortAndLoad("name"))},[a("Название "),e.sort.direction==="desc"&&e.sort.column==="name"?(t(),i("span",x,es)):r("",!0),e.sort.direction==="asc"&&e.sort.column==="name"?(t(),i("span",ts,is)):r("",!0)]),s("th",{scope:"col",class:"text-center cursor-pointer",onClick:l[4]||(l[4]=o=>e.sortAndLoad("slug"))},[a("Идентификатор "),e.sort.direction==="desc"&&e.sort.column==="slug"?(t(),i("span",ns,rs)):r("",!0),e.sort.direction==="asc"&&e.sort.column==="slug"?(t(),i("span",as,cs)):r("",!0)]),n.forSelect?r("",!0):(t(),i("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:l[5]||(l[5]=o=>e.sortAndLoad("updated_at"))},[a(" Дата изменения "),e.sort.direction==="desc"&&e.sort.column==="updated_at"?(t(),i("span",us,hs)):r("",!0),e.sort.direction==="asc"&&e.sort.column==="updated_at"?(t(),i("span",_s,fs)):r("",!0)]))])]),s("tbody",null,[(t(!0),i(_,null,f(e.items,(o,c)=>(t(),i("tr",null,[s("th",gs,d(o.id||c),1),n.forSelect?r("",!0):(t(),i("td",bs,[s("div",ks,[ys,s("ul",vs,[s("li",null,[s("a",{class:"dropdown-item",onClick:u=>e.selectItem(o),href:"javascript:void(0)"},[ws,a("Редактировать")],8,$s)]),s("li",null,[s("a",{class:"dropdown-item text-danger",onClick:u=>e.removeItem(o.id),href:"javascript:void(0)"},[Cs,a("Удалить")],8,Ps)])])])])),s("td",{class:"text-center cursor-pointer",onClick:u=>e.selectItem(o)},[(n.selected||[]).indexOf(o.id)!==-1?(t(),i("i",Fs)):r("",!0),a(" "+d(o.name||"-"),1)],8,js),s("td",Is,d(o.slug||"-"),1),n.forSelect?r("",!0):(t(),i("td",Ls,d(o.updated_at||"-"),1))]))),256))])])):r("",!0)]),e.items.length===0?(t(),i("div",As,Vs)):r("",!0),e.items.length>0?(t(),i("div",Bs,[s("div",Ts,[e.paginate_object?(t(),p(k,{key:0,onPagination_page:e.loadPermissions,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):r("",!0),s("div",Ns,[s("div",Us,[s("div",qs,[s("div",Es,[e.selected_item?(t(),p(B,{key:0,item:e.selected_item,onCallback:l[6]||(l[6]=o=>e.selectItem(null))},null,8,["item"])):r("",!0)])])])])],64))}});export{B as _,Ks as a};
